# C2 사용자 입력 검증

## 제어 목표

사용자 입력에 대한 강력한 검증은 AI 시스템에 대한 가장 치명적인 공격 중 일부에 대한 1차 방어선입니다. 프롬프트 인젝션 공격은 시스템 지침을 무시하거나, 민감한 데이터를 유출하거나, 모델을 허용되지 않은 행동으로 유도할 수 있습니다. 전용 필터 및 기타 검증이 없으면, 연구에 따르면 컨텍스트 윈도우를 악용한 탈옥 공격은 계속해서 효과적일 것입니다.

---

## C2.1 프롬프트 인젝션 방어

프롬프트 인젝션은 AI 시스템에서 가장 큰 위험 중 하나입니다. 이를 방어하기 위해 패턴 필터, 데이터 분류기, 명령 계층 구조 강제 적용의 조합이 사용됩니다.

|   #   | 설명                                                                                                                                                                                                                                           | 레벨  | 역할  |
| :---: | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-: | :-: |
| 2.1.1 | 행동을 유도할 수 있는 모든 외부 또는 파생 입력(사용자 프롬프트, RAG 결과, 플러그인 또는 MCP 출력, 에이전트 간 메시지, API 또는 웹훅 응답, 구성 또는 정책 파일, 메모리 읽기 및 쓰기 포함)이 신뢰되지 않는 것으로 처리되고, 인용 또는 태그와 활성 콘텐츠 제거를 통해 비활성화되며, 프롬프트에 결합하거나 동작 실행 전에 유지 관리되는 프롬프트 인젝션 탐지 규칙 세트 또는 서비스로 선별되는지 확인하십시오. |  1  | D/V |
| 2.1.2 | 시스템이 사용자 지침 처리 이후에도 시스템 및 개발자 메시지가 사용자 지침 및 기타 신뢰할 수 없는 입력을 우선하는 명령 계층 구조를 강제하는지 확인하십시오.                                                                                                                                                     |  1  | D/V |
| 2.1.3 | 서드파티 콘텐츠(웹 페이지, PDF, 이메일)에서 생성된 프롬프트가 메인 프롬프트에 연결되기 전에 별도로 정제되는지 확인하십시오(예: 지시형 명령어 제거 및 HTML, Markdown, 스크립트 콘텐츠 중립화).                                                                                                                       |  2  |  D  |

---

## C2.2 적대적 예제 저항성

자연어 처리(NLP) 모델은 인간이 종종 놓치는 미묘한 문자 또는 단어 수준의 변형에 여전히 취약하며, 모델은 이를 잘못 분류하는 경향이 있습니다.

|   #   | 설명                                                                                                                                                 | 레벨  | 역할  |
| :---: | -------------------------------------------------------------------------------------------------------------------------------------------------- | :-: | :-: |
| 2.2.1 | 토큰화 또는 임베딩 전에, 그리고 도구나 MCP 인수로 파싱하기 전에 기본 입력 정규화 단계(Unicode NFC, 동형문자 매핑, 공백 제거, 제어 및 보이지 않는 Unicode 문자 제거)가 실행되는지 확인하십시오.                         |  1  |  D  |
| 2.2.2 | 통계적 이상 탐지가 언어 기준과 비교하여 편집 거리가 비정상적으로 높거나 임베딩 거리가 비정상적인 입력을 감지하는지 확인하고, 감지된 입력이 프롬프트에 연결되거나 동작이 실행되기 전에 차단되는지 검증하십시오.                               |  2  | D/V |
| 2.2.3 | 추론 파이프라인이 고위험 엔드포인트에 대해 적대적 학습으로 강화된 모델 변형 또는 방어 계층(예: 무작위화, 방어적 증류, 정렬 검사)을 지원하는지 확인하십시오.                                                         |  2  |  D  |
| 2.2.4 | 의심되는 적대적 입력이 격리되고 전체 페이로드 및 추적 메타데이터(출처, 도구 또는 MCP 서버, 에이전트 ID, 세션)와 함께 기록되었는지 확인하십시오.                                                             |  2  |  V  |
| 2.2.5 | 입력 및 출력 모두에서 인코딩 및 표현 스머글링(예: 보이지 않는 유니코드/제어 문자, 동형 글자 교체 또는 혼합 방향 텍스트)이 감지되고 완화되는지 확인합니다. 승인된 완화 방법에는 정규화, 엄격한 스키마 검증, 정책 기반 거부 또는 명시적 표시가 포함됩니다. |  2  | D/V |

---

## C2.3 프롬프트 문자 집합

비즈니스 요구사항에 필요한 문자만 허용하도록 사용자 입력의 문자 집합을 제한하는 것은 다양한 유형의 공격을 방지하는 데 도움이 될 수 있습니다.

|   #   | 설명                                                                                    | 레벨  | 역할  |
| :---: | ------------------------------------------------------------------------------------- | :-: | :-: |
| 2.3.1 | 시스템이 사용자 입력에 대해 문자 집합 제한을 구현하여 비즈니스 목적상 명시적으로 필요한 문자만 허용하는지 검증하십시오.                   |  1  |  D  |
| 2.3.2 | 허용되는 문자 집합을 정의하기 위해 허용 목록 방식을 사용했는지 확인하십시오.                                           |  1  |  D  |
| 2.3.3 | 허용된 집합 외의 문자를 포함하는 입력이 거부되고 추적 메타데이터(출처, 도구 또는 MCP 서버, 에이전트 ID, 세션)와 함께 기록되는지 확인하십시오. |  1  | D/V |

---

## C2.4 스키마, 유형 및 길이 검증

형태가 잘못되었거나 너무 큰 입력을 특징으로 하는 AI 공격은 구문 분석 오류, 필드 간 프롬프트 누출 및 자원 고갈을 일으킬 수 있습니다. 엄격한 스키마 적용은 결정론적 도구 호출을 수행할 때도 필수 조건입니다.

|   #   | 설명                                                                                                                                                                           | 레벨  | 역할  |
| :---: | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-: | :-: |
| 2.4.1 | 모든 API, 도구 또는 MCP 엔드포인트가 명시적인 입력 스키마(JSON Schema, Protobuf 또는 다중 모달 동등체)를 정의하고, 추가적이거나 알 수 없는 필드를 거부하며, 암묵적인 타입 강제 변환을 허용하지 않고, 프롬프트 조립 또는 도구 실행 전에 서버 측에서 입력을 검증하는지 확인하십시오. |  1  |  D  |
| 2.4.2 | 입력이 최대 토큰 또는 바이트 제한을 초과하는 경우 안전한 오류로 거부되고 절대 조용히 잘리지 않는지 확인하세요.                                                                                                              |  1  | D/V |
| 2.4.3 | 툴 또는 MCP 인수에 대해서도 포함하여 타입 검사(예: 숫자 범위, 열거형 값, 이미지/오디오의 MIME 유형)가 서버 측에서 강제되는지 확인하십시오.                                                                                        |  2  | D/V |
| 2.4.4 | NLP 입력을 이해하는 의미 검증기가 일정한 시간 안에 실행되고 알고리즘적 서비스 거부(DoS)를 방지하기 위해 외부 네트워크 호출을 피하는지 확인하세요.                                                                                       |  2  |  D  |
| 2.4.5 | 유효성 검사 실패가 페이로드 일부를 마스킹하여 기록되고 명확한 오류 코드와 함께 추적 메타데이터(출처, 도구 또는 MCP 서버, 에이전트 ID, 세션)를 포함하여 보안 분석에 도움이 되는지 확인하십시오.                                                            |  3  |  V  |

---

## C2.5 콘텐츠 및 정책 심사

개발자는 허용되지 않은 콘텐츠(예: 불법 지침, 증오 발언 및/또는 저작권이 있는 텍스트)를 요청하는 구문적으로 올바른 프롬프트를 감지하고, 이들이 확산되는 것을 방지할 수 있어야 합니다.

|   #   | 설명                                                                                                                                       | 레벨  | 역할  |
| :---: | ---------------------------------------------------------------------------------------------------------------------------------------- | :-: | :-: |
| 2.5.1 | 컨텐츠 분류기(제로샷 또는 미세 조정된)가 모든 입력과 출력을 폭력, 자해, 증오, 성적 내용 및 불법 요청에 대해 점수화하며, 임계값을 구성할 수 있는지 확인하십시오.                                           |  1  |  D  |
| 2.5.2 | 정책을 위반하는 입력은 차단되어 하류의 LLM 또는 도구/MCP 호출로 전달되지 않도록 해야 합니다.                                                                                 |  1  | D/V |
| 2.5.3 | 요청 시점에 해결되는 에이전트 역할 속성을 포함한 속성 기반 규칙을 통해 사용자별 정책(연령, 지역 법적 제약)을 준수하는지 검증합니다.                                                             |  2  |  D  |
| 2.5.4 | 스크리닝 로그에 분류기 신뢰도 점수와 정책 카테고리 태그가 적용된 단계(프리-프롬프트 또는 포스트-응답) 및 추적 메타데이터(출처, 도구 또는 MCP 서버, 에이전트 ID, 세션)를 포함하여 SOC 상관관계 및 향후 레드팀 재현을 검증하십시오. |  3  |  V  |

---

## C2.6 입력 속도 제한 및 남용 방지

개발자는 입력 속도를 제한하고 이상 사용 패턴을 감지하여 AI 시스템에 대한 남용, 자원 고갈 및 자동화된 공격을 방지해야 합니다.

|   #   | 설명                                                                                                                | 레벨  | 역할  |
| :---: | ----------------------------------------------------------------------------------------------------------------- | :-: | :-: |
| 2.6.1 | 모든 입력 및 툴/MCP 엔드포인트에 대해 사용자별, IP별, API 키별, 에이전트별, 세션/작업별 속도 제한이 적용되는지 확인하십시오.                                     |  1  | D/V |
| 2.6.2 | DoS 및 무차별 대입 공격을 방지하도록 burst 및 지속 속도 제한이 조정되었는지 확인하고, 에이전트 계획 루프에 대해 작업별 예산(예: 토큰, 도구/MCP 호출 및 비용)이 시행되는지 확인하십시오. |  2  | D/V |
| 2.6.3 | 비정상적인 사용 패턴(예: 연속 요청, 입력 과다, 반복적으로 실패하는 도구/MCP 호출 또는 재귀적 에이전트 루프)이 자동 차단 또는 문제 발생 대응 조치를 유발하는지 확인하십시오.            |  2  | D/V |
| 2.6.4 | 악용 방지 로그가 보존되고 신흥 공격 패턴을 위해 검토되는지, 추적 메타데이터(출처, 도구 또는 MCP 서버, 에이전트 ID, 세션)와 함께 확인하십시오.                            |  3  |  V  |

---

## C2.7 다중 모달 입력 유효성 검사

AI 시스템은 주입, 회피 또는 자원 남용을 방지하기 위해 비텍스트 입력(이미지, 오디오, 파일)에 대해 강력한 검증을 포함해야 합니다.

|   #   | 설명                                                                                                                                                                          | 레벨  | 역할  |
| :---: | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-: | :-: |
| 2.7.1 | 모든 비텍스트 입력(이미지, 오디오, 파일)이 처리 전에 유형, 크기 및 형식에 대해 검증되었는지 확인하고, 추출된 텍스트(이미지-텍스트 변환 또는 음성-텍스트 변환)와 숨겨지거나 내장된 지시사항(메타데이터, 레이어, 대체 텍스트, 댓글)을 2.1.1에 따라 신뢰할 수 없는 것으로 처리하는지 확인하십시오. |  1  |  D  |
| 2.7.2 | 파일이 수집되기 전에 악성코드 및 스테가노그래픽 페이로드에 대해 스캔되는지 확인하고, 활성 콘텐츠(스크립트나 매크로 등)는 제거되거나 파일이 격리되는지 확인하십시오.                                                                                |  2  | D/V |
| 2.7.3 | 이미지/오디오 입력이 적대적 교란 또는 알려진 공격 패턴에 대해 검사되었는지 확인하고, 감지가 이루어지면 모델 사용 전에 게이팅(기능 차단 또는 성능 저하)이 실행되도록 하십시오.                                                                        |  2  | D/V |
| 2.7.4 | 다중 모드 입력 검증 실패가 기록되고 조사 경고를 유발하며, 추적 메타데이터(출처, 도구 또는 MCP 서버, 에이전트 ID, 세션)를 포함하는지 확인하십시오.                                                                                    |  3  |  V  |
| 2.7.5 | 교차 모달 공격 탐지가 여러 입력 유형에 걸친 협력 공격(예: 이미지 내의 스테가노그래피 페이로드와 텍스트 내의 프롬프트 인젝션 결합)을 상관 규칙과 경고 생성을 통해 식별하며, 확인된 탐지는 차단되거나 HITL(휴먼 인 더 루프) 승인을 요구하는지 검증합니다.                          |  2  | D/V |
| 2.7.6 | 다중 모달 검증 실패가 모든 입력 모달리티, 검증 결과 및 위협 점수, 추적 메타데이터(출처, 도구 또는 MCP 서버, 에이전트 ID, 세션)를 포함한 상세 로그를 트리거하는지 확인하십시오.                                                                  |  3  | D/V |
---

## C2.8 실시간 적응형 위협 탐지

개발자들은 새로운 공격 패턴에 적응하고 컴파일된 패턴 매칭을 통해 실시간 보호를 제공하는 AI용 고급 위협 탐지 시스템을 사용해야 합니다.

|   #   | 설명                                                                                                               | 레벨  | 역할  |
| :---: | ---------------------------------------------------------------------------------------------------------------- | :-: | :-: |
| 2.8.1 | 패턴 매칭(예: 컴파일된 정규식)이 모든 입력 및 출력(도구/MCP 표면 포함)에 대해 최소한의 지연 시간 영향으로 실행되는지 확인합니다.                                    |  1  | D/V |
| 2.8.3 | 적응형 탐지 모델이 최근 공격 활동에 따라 민감도를 조정하고 새로운 패턴을 실시간으로 업데이트하며, 위험 적응형 대응(예: 도구 비활성화, 컨텍스트 축소, HITL 승인 요구)을 유발하는지 확인하세요. |  2  | D/V |
| 2.8.4 | 사용자 이력, 출처, 세션 행동 및 추적 메타데이터(출처, 도구 또는 MCP 서버, 에이전트 ID, 세션)를 포함한 문맥 분석을 통해 탐지 정확도가 향상되었는지 확인하십시오.                |  3  | D/V |
| 2.8.5 | 탐지 성능 지표(탐지율, 오탐률, 처리 지연 시간)가 지속적으로 모니터링되고 최적화되도록 하며, 차단 시간 및 단계(프롬프트 전/응답 후)를 포함하여 확인합니다.                       |  3  | D/V |

## 참고 문헌

* [OWASP LLM01:2025 Prompt Injection](https://genai.owasp.org/llmrisk/llm01-prompt-injection/)
* [LLM Prompt Injection Prevention Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/LLM_Prompt_Injection_Prevention_Cheat_Sheet.html)
* [MITRE ATLAS : Adversarial Input Detection](https://atlas.mitre.org/mitigations/AML.M00150)
* [Mitigate jailbreaks and prompt injections](https://docs.anthropic.com/en/docs/test-and-evaluate/strengthen-guardrails/mitigate-jailbreaks)

