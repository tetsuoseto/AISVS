# 付録D：AI支援による安全なコーディングのガバナンスと検証

## 目的

この章では、ソフトウェア開発中にAI支援コード作成ツールを安全かつ効果的に使用するための基本的な組織的管理策を定義し、SDLC全体でのセキュリティとトレーサビリティを確保します。

---

## AD.1 AI支援のセキュアコーディングワークフロー

既存のセキュリティゲートを弱めることなく、組織のセキュアソフトウェア開発ライフサイクル（SSDLC）にAIツールを統合する。

|   #    | 説明                                                                       | レベル | 役割  |
| :----: | ------------------------------------------------------------------------ | :-: | :-: |
| AD.1.1 | 文書化されたワークフローが、AIツールがコードを生成、リファクタリング、またはレビューするタイミングと方法を説明していることを確認してください。 |  1  | D/V |
| AD.1.2 | ワークフローが各SSDLCフェーズ（設計、実装、コードレビュー、テスト、デプロイメント）に対応していることを確認してください。          |  2  |  D  |
| AD.1.3 | AI生成コードに対してメトリクス（例：脆弱性密度、検出までの平均時間）が収集され、人間のみのベースラインと比較されていることを確認してください。 |  3  | D/V |

---

## AD.2 AIツールの資格認定と脅威モデリング

AIコーディングツールは採用前に、セキュリティ機能、リスク、およびサプライチェーンへの影響について評価を行うことを確実にしてください。

|   #    | 説明                                                                              | レベル | 役割  |
| :----: | ------------------------------------------------------------------------------- | :-: | :-: |
| AD.2.1 | 各AIツールの脅威モデルが、不正使用、モデル反転、データ漏洩、および依存チェーンのリスクを特定していることを確認してください。                 |  1  | D/V |
| AD.2.2 | ツール評価には、ローカルコンポーネントの静的/動的解析およびSaaSエンドポイント（TLS、認証/認可、ログ記録）の評価が含まれていることを確認してください。 |  2  |  D  |
| AD.2.3 | 評価が認識されたフレームワークに従っていることを確認し、主要なバージョン変更後に再実施されることを確認してください。                      |  3  | D/V |

---

## AD.3 セキュアプロンプト＆コンテキスト管理

AIモデルのプロンプトやコンテキストを構築する際に、秘密情報、専有コード、および個人データの漏洩を防止してください。

|   #    | 説明                                                                          | レベル | 役割  |
| :----: | --------------------------------------------------------------------------- | :-: | :-: |
| AD.3.1 | 書面による指導で、プロンプトに秘密情報、認証情報、または機密データを送信することを禁止していることを確認してください。                 |  1  | D/V |
| AD.3.2 | 技術的な制御（クライアント側の編集、承認済みのコンテキストフィルター）が自動的に機密情報を除去することを検証してください。               |  2  |  D  |
| AD.3.3 | プロンプトと応答がトークン化され、送信中および保存中に暗号化されていること、ならびに保持期間がデータ分類ポリシーに準拠していることを確認してください。 |  3  | D/V |

---

## AD.4 AI生成コードの検証

コードがマージまたはデプロイされる前に、AI出力によって導入された脆弱性を検出して修正します。

|   #    | 説明                                                                                     | レベル | 役割  |
| :----: | -------------------------------------------------------------------------------------- | :-: | :-: |
| AD.4.1 | AI生成コードは常に人間によるコードレビューを受けることを確認してください。                                                 |  1  | D/V |
| AD.4.2 | 自動スキャナー（SAST/IAST/DAST）がAI生成コードを含むすべてのプルリクエストで実行され、重大な検出結果がある場合はマージをブロックすることを確認してください。 |  2  |  D  |
| AD.4.3 | 差分ファズテストまたはプロパティベーステストがセキュリティクリティカルな動作（例：入力検証、認可ロジック）を証明することを確認してください。                 |  3  | D/V |

---

## AD.5 コード提案の説明可能性とトレーサビリティ

監査人と開発者に対して、なぜ提案がなされたのか、そしてそれがどのように進化したのかについての洞察を提供します。

|   #    | 説明                                                                                           | レベル | 役割  |
| :----: | -------------------------------------------------------------------------------------------- | :-: | :-: |
| AD.5.1 | プロンプト/レスポンスのペアがコミットIDとともに記録されていることを確認してください。                                                 |  1  | D/V |
| AD.5.2 | 開発者が提案をサポートするモデルの引用（トレーニングスニペット、ドキュメント）を表示できることを確認してください。                                    |  2  |  D  |
| AD.5.3 | 説明可能性レポートが設計成果物とともに保存され、セキュリティレビューで参照されていることを確認し、ISO/IEC 42001のトレーサビリティ原則を満たしていることを検証してください。 |  3  | D/V |

---

## AD.6 継続的なフィードバックとモデルのファインチューニング

モデルのセキュリティパフォーマンスを時間とともに向上させつつ、ネガティブドリフトを防止する。

|   #    | 説明                                                                                                   | レベル | 役割  |
| :----: | ---------------------------------------------------------------------------------------------------- | :-: | :-: |
| AD.6.1 | 開発者が安全でない、または準拠していない提案にフラグを立てることができ、そのフラグが追跡されていることを確認してください。                                        |  1  | D/V |
| AD.6.2 | 集約されたフィードバックが、検証済みのセキュアコーディングコーパス（例：OWASP チートシート）を用いた定期的なファインチューニングまたはリトリーバル拡張生成に反映されていることを検証してください。 |  2  |  D  |
| AD.6.3 | 閉ループ評価ハーネスが各ファインチューニング後に回帰テストを実行することを確認してください。セキュリティメトリクスは、展開前に以前のベースラインを満たすかそれを上回っている必要があります。       |  3  | D/V |

---

### 参考文献

* [NIST AI Risk Management Framework 1.0](https://nvlpubs.nist.gov/nistpubs/ai/nist.ai.100-1.pdf)
* [ISO/IEC 42001:2023 — AI Management Systems Requirements](https://www.iso.org/standard/81230.html)
* [OWASP Secure Coding Practices — Quick Reference Guide](https://owasp.org/www-project-secure-coding-practices-quick-reference-guide/)

