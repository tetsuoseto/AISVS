# C2 ユーザー入力の検証

## 統制目標

ユーザー入力の堅牢な検証は、AIシステムに対する最も深刻な攻撃のいくつかに対する第一の防御線となる。プロンプトインジェクション攻撃は、システム指示を上書きしたり、機密データを漏洩させたり、モデルを許可されていない挙動へと誘導したりする可能性がある。専用のフィルターや指示階層が整備されていない限り、長大なコンテキストウィンドウを悪用する「マルチショット」ジャイルブレイク攻撃は有効になることが研究で示されている。さらに、同形文字の置換や leetspeak（leet表記）といった微妙な敵対的摂動攻撃は、モデルの判断を黙って変えることがある。

---

## C2.1 プロンプトインジェクション対策

プロンプトインジェクションは、AIシステムにおける主要なリスクの一つです。 この手法に対する防御は、静的パターンフィルタ、動的分類器、および指示階層の遵守の組み合わせを用いて実施されます。

|   #   | 説明                                                                                                                          | レベル | 役割  |
| :---: | --------------------------------------------------------------------------------------------------------------------------- | :-: | :-: |
| 2.1.1 | ユーザー入力が、継続的に更新される既知のプロンプト注入パターンのライブラリに対して検査・スクリーニングされていることを検証する（ジャイルブレイクキーワード、"ignore previous"、ロールプレイチェーン、間接的なHTML/URL攻撃）。 |  1  | D/V |
| 2.1.2 | システムが、システムメッセージまたは開発者メッセージがユーザーの指示を上書きする指示階層を厳格に適用し、コンテキストウィンドウの拡張後もそれが維持されることを検証する。                                        |  1  | D/V |
| 2.1.3 | すべてのモデルまたはプロンプトテンプレートのリリース前に、敵対的評価テスト（例：レッドチームによる「many-shot」プロンプト）を実行し、成功率の閾値および回帰を自動的にブロックする仕組みを備えていることを確認する。              |  2  | D/V |
| 2.1.4 | 第三者コンテンツ（ウェブページ、PDF、メール）由来のプロンプトが、メインのプロンプトへ結合される前に、分離された解析コンテキストでサニタイズされていることを検証します。                                       |  2  |  D  |
| 2.1.5 | すべてのプロンプトフィルター規則の更新、分類器モデルのバージョン、およびブロックリストの変更がバージョン管理され、監査可能であることを検証する。                                                    |  3  | D/V |

---

## C2.2 敵対的-サンプル耐性

自然言語処理（NLP）モデルは、まだ人間には気づかれにくい微妙な文字レベルおよび単語レベルの摂動に対して脆弱であり、そうした摂動が原因でモデルは誤分類しがちです。

|   #   | 説明                                                                                      | レベル | 役割  |
| :---: | --------------------------------------------------------------------------------------- | :-: | :-: |
| 2.2.1 | 基本的な入力正規化手順（Unicode NFC 形式、同形字マッピング、空白のトリミング）がトークン化の前に実行されることを検証する。                     |  1  |  D  |
| 2.2.2 | 統計的異常検知が、言語ノームに対して編集距離が異常に大きい入力、過度に繰り返されるトークン、または埋め込み距離が異常な入力をフラグ付けすることを検証する。           |  2  | D/V |
| 2.2.3 | 推論パイプラインが、高リスクのエンドポイントに対して、任意の敵対的訓練で堅牢化されたモデルバリアントや防御層（例：ランダム化、防御蒸留）をサポートすることを検証してください。 |  2  |  D  |
| 2.2.4 | 疑われる敵対的入力が隔離され、PII の伏字化後の完全なペイロードを含むログに記録されていることを検証する。                                  |  2  |  V  |
| 2.2.5 | 頑健性指標（既知の攻撃スイートの成功率）が時間の経過とともに追跡され、回帰がリリースブロッカーを引き起こすことを検証する。                           |  3  | D/V |

---

## C2.3 スキーマ、型と長さの検証

不正な形式または過大な入力を特徴とするAI攻撃は、解析エラーを引き起こし、フィールド間でプロンプト情報が漏洩し、リソースの枯渇を招くことがあります。  決定論的なツール呼び出しを行う際には、厳格なスキーマ適用も前提条件となります。

|   #   | 説明                                                                                                                 | レベル | 役割  |
| :---: | ------------------------------------------------------------------------------------------------------------------ | :-: | :-: |
| 2.3.1 | すべての API または関数呼び出しエンドポイントが、明示的な入力スキーマ（JSON Schema、Protobuf、またはマルチモーダル相当のもの）を定義し、入力がプロンプトの組み立て前に検証されていることを確認してください。 |  1  |  D  |
| 2.3.2 | 最大トークン数またはバイト数を超える入力は、黙って切り捨てられることなく、安全なエラーで拒否されることを検証してください。                                                      |  1  | D/V |
| 2.3.3 | サーバーサイドで型チェック（例：数値範囲、列挙値、画像/音声の MIME タイプ）が適用されていることを、クライアント側のコードだけでなく検証してください。                                     |  2  | D/V |
| 2.3.4 | セマンティック検証器（例：JSON Schema）が定数時間で実行されることを検証し、アルゴリズム的DoSを防ぎます。                                                        |  2  |  D  |
| 2.3.5 | 検証失敗が、機密情報を伏せたペイロードの断片と明確なエラーコードとともにログに記録され、セキュリティ対応のトリアージを支援することを確認する。                                            |  3  |  V  |

---

## C2.4 コンテンツとポリシーの審査

開発者は、構文的に有効だが禁止された内容を要求するプロンプトを検出し（例：違法な指示、ヘイトスピーチ、著作権で保護されたテキストなど）、それらが拡散するのを防ぐことができるべきです。

|   #   | 説明                                                                                                          | レベル | 役割  |
| :---: | ----------------------------------------------------------------------------------------------------------- | :-: | :-: |
| 2.4.1 | コンテンツ分類器（ゼロショットまたはファインチューニング済み）が、暴力、自傷行為、ヘイト表現、性的内容、違法リクエストの各カテゴリについて、設定可能な閾値を用いてすべての入力をスコア付けすることを検証してください。 |  1  |  D  |
| 2.4.2 | ポリシーに違反する入力が標準化された拒否または安全な応答を受け取ることを確認し、それらが下流の LLM 呼び出しへ伝播しないようにする。                                        |  1  | D/V |
| 2.4.3 | スクリーニングモデルまたはルールセットが少なくとも3か月ごとに再訓練/更新され、新たに観測されたジェイルブレイクまたはポリシー回避パターンを取り入れていることを検証する。                       |  2  |  D  |
| 2.4.4 | リクエスト時に解決される属性ベースのルールを用いて、年齢や地域の法的制約など、ユーザー固有のポリシーが遵守されていることを検証する。                                          |  2  |  D  |
| 2.4.5 | SOC 相関と将来のレッドチーム再現のために、スクリーニングログに分類器の信頼度スコアとポリシーカテゴリタグを含めることを確認してください。                                      |  3  |  V  |

---

## C2.5 入力レート制限と不正利用防止

開発者は、AIシステムに対する悪用、資源の枯渇、および自動化攻撃を防ぐために、入力レートを制限し、異常な使用パターンを検出すべきである。

|   #   | 説明                                                                   | レベル | 役割  |
| :---: | -------------------------------------------------------------------- | :-: | :-: |
| 2.5.1 | すべての入力エンドポイントにおいて、ユーザーごと、IPごと、APIキーごとに設定されたレート制限が適用されていることを確認してください。 |  1  | D/V |
| 2.5.2 | バーストと持続的なレート制限がDoS攻撃および総当たり攻撃を防ぐように適切に調整されていることを検証する。                |  2  | D/V |
| 2.5.3 | 異常な利用パターン（例：連続リクエスト、入力過多）が自動ブロックまたはエスカレーションを引き起こすことを検証する。            |  2  | D/V |
| 2.5.4 | 乱用防止ログが保持され、出現する攻撃パターンを監視・検討していることを確認してください。                         |  3  |  V  |

---

## C2.6 マルチ-モーダル入力検証

AIシステムは、画像・音声・ファイルなどの非テキスト入力に対して堅牢な検証を実施し、インジェクション攻撃、回避行為、リソースの乱用を防ぐべきです。

|   #   | 説明                                                                      | レベル | 役割  |
| :---: | ----------------------------------------------------------------------- | :-: | :-: |
| 2.6.1 | 処理を開始する前に、すべての非テキスト入力（画像、音声、ファイル）のタイプ、サイズ、およびフォーマットが検証されていることを確認してください。 |  1  |  D  |
| 2.6.2 | 取り込み前に、ファイルがマルウェアおよびステガノグラフィー・ペイロードのスキャンを受けていることを検証する。                  |  2  | D/V |
| 2.6.3 | 画像入力および音声入力が、敵対的摂動や既知の攻撃パターンに対して検査されていることを確認してください。                     |  2  | D/V |
| 2.6.4 | マルチモーダル入力検証の失敗がログに記録され、調査のためのアラートをトリガーすることを検証します。                       |  3  |  V  |

---

## C2.7 入力の来歴と帰属

AIシステムは、すべてのユーザー入力の出所を監視し、タグ付けすることによって、監査、乱用追跡、およびコンプライアンスを支援すべきである。

|   #   | 説明                                                                             | レベル | 役割  |
| :---: | ------------------------------------------------------------------------------ | :-: | :-: |
| 2.7.1 | 取り込み時に、すべてのユーザー入力がメタデータ（ユーザーID、セッション、ソース、タイムスタンプ、IPアドレス）でタグ付けされていることを検証してください。 |  1  | D/V |
| 2.7.2 | すべての処理済み入力について、出所メタデータが保持され、監査可能であることを検証する。                                    |  2  | D/V |
| 2.7.3 | 異常または信頼できない入力ソースを検出してフラグを立て、強化された審査またはブロックの対象とすることを検証します。                      |  2  | D/V |

---

## C2.8 リアルタイム適応型脅威検知

開発者は、AI用の高度な脅威検知システムを採用すべきであり、それは新たな攻撃パターンに適応し、コンパイル済みパターンマッチングによるリアルタイムの保護を提供します。

|   #   | 説明                                                                                       | レベル | 役割  |
| :---: | ---------------------------------------------------------------------------------------- | :-: | :-: |
| 2.8.1 | 脅威検知パターンが、遅延の影響を最小限に抑えた高性能なリアルタイムフィルタリングを実現するために、最適化された正規表現エンジンにコンパイルされていることを検証する。       |  1  | D/V |
| 2.8.2 | 脅威検知システムが、異なる脅威カテゴリごとに別々のパターンライブラリを維持していることを検証する（プロンプトインジェクション、有害なコンテンツ、機微データ、システムコマンド）。 |  1  | D/V |
| 2.8.3 | 適応型脅威検知が、攻撃頻度と成功率に基づいて脅威感度を更新する機械学習モデルを組み込んでいることを検証する。                                   |  2  | D/V |
| 2.8.4 | リアルタイムの脅威情報フィードが、新しい攻撃署名とIOCs（Indicators of Compromise）をパターンライブラリに自動的に更新することを検証してください。   |  2  | D/V |
| 2.8.5 | 脅威検出の偽陽性率が継続的に監視され、パターンの特異性が自動的に調整され、正当なユースケースへの干渉を最小化することを確認してください。                     |  3  | D/V |
| 2.8.6 | 文脈に基づく脅威分析が、入力元、ユーザーの行動パターン、およびセッション履歴を考慮して検知精度を向上させることを検証してください。                        |  3  | D/V |
| 2.8.7 | 脅威検知の性能指標（検出率、処理遅延、リソース利用率）がリアルタイムで監視・最適化されていることを確認してください。                               |  3  | D/V |

---

## C2.9 マルチ-モーダル セキュリティ検証パイプライン

開発者は、テキスト、画像、音声、およびその他のAI入力モダリティに対して、特定の種類の脅威検知とリソース分離を備えたセキュリティ検証を提供すべきです。

|   #   | 説明                                                                                                                                            | レベル | 役割  |
| :---: | --------------------------------------------------------------------------------------------------------------------------------------------- | :-: | :-: |
| 2.9.1 | 各入力モダリティが、文書化された脅威パターンを持つ専用のセキュリティ検証ツールを備え、検出閾値が設定されていることを確認してください（テキスト：プロンプト注入、画像：ステガノグラフィー、音声：スペクトログラム攻撃）。                                  |  1  | D/V |
| 2.9.2 | マルチモーダル入力が、各モダリティタイプに固有の定義済みリソース制限（メモリ、CPU、処理時間）を持つ分離されたサンドボックスで処理され、セキュリティポリシーに記載されていることを検証する。                                               |  2  | D/V |
| 2.9.3 | クロスモーダル攻撃検出が、複数の入力タイプにまたがる協調攻撃を、相関ルールとアラート生成を用いて識別することを検証する（例：画像内のステガノグラフィーによるペイロードと、テキストのプロンプト挿入を組み合わせたもの）。                                  |  2  | D/V |
| 2.9.4 | マルチモーダル検証の失敗が、すべての入力モダリティ、検証結果、脅威スコア、相関分析を含む詳細なログをトリガーし、SIEM統合のための構造化ログ形式で記録されることを検証する。                                                       |  3  | D/V |
| 2.9.5 | モダリティ別 コンテンツ分類器 が、 文書化 された スケジュール（ 最低でも 四半期ごと） に 従って 更新 され、 新しい 脅威 パターン、 敵対的 サンプル、 および 性能 ベンチマーク が ベースライン 閾値 を 上回る 状態 で 維持 されて いる こと を 検証 する。 |  3  | D/V |

---

## 参考文献

* [LLM01:2025 Prompt Injection – OWASP Top 10 for LLM & Generative AI Security](https://genai.owasp.org/llmrisk/llm01-prompt-injection/)
* [Generative AI's Biggest Security Flaw Is Not Easy to Fix](https://www.wired.com/story/generative-ai-prompt-injection-hacking)
* [Many-shot jailbreaking \ Anthropic](https://www.anthropic.com/research/many-shot-jailbreaking)
* [$PDF$ OpenAI GPT-4.5 System Card](https://cdn.openai.com/gpt-4-5-system-card-2272025.pdf)
* [Notebook for the CheckThat Lab at CLEF 2024](https://ceur-ws.org/Vol-3740/paper-53.pdf)
* [Mitigate jailbreaks and prompt injections – Anthropic](https://docs.anthropic.com/en/docs/test-and-evaluate/strengthen-guardrails/mitigate-jailbreaks)
* [Chapter 3 MITRE ATT\&CK – Adversarial Model Analysis](https://ama.drwhy.ai/mitre-attck.html)
* [OWASP Top 10 for LLM Applications 2025 – WorldTech IT](https://wtit.com/blog/2025/04/17/owasp-top-10-for-llm-applications-2025/)
* [OWASP Machine Learning Security Top Ten](https://owasp.org/www-project-machine-learning-security-top-10/)
* [Few words about AI Security – Jussi Metso](https://www.jussimetso.com/index.php/2024/09/28/few-words-about-ai-security/)
* [How To Ensure LLM Output Adheres to a JSON Schema | Modelmetry](https://modelmetry.com/blog/how-to-ensure-llm-output-adheres-to-a-json-schema)
* [Easily enforcing valid JSON schema following – API](https://community.openai.com/t/feature-request-function-calling-easily-enforcing-valid-json-schema-following/263515?utm_source)
* [AI Safety + Cybersecurity R\&D Tracker – Fairly AI](https://www.fairly.ai/blog/ai-cybersecurity-tracker)
* [Anthropic makes 'jailbreak' advance to stop AI models producing harmful results](https://www.ft.com/content/cf11ebd8-aa0b-4ed4-945b-a5d4401d186e)
* [Pattern matching filter rules - IBM](https://www.ibm.com/docs/ssw_aix_71/security/intrusion_pattern_matching_filter_rules.html)
* [Real-time Threat Detection](https://www.darktrace.com/cyber-ai-glossary/real-time-threat-detection)

