# C2 ユーザー入力検証

## 管理目標

ユーザー入力の堅牢な検証は、AIシステムに対する最も破壊的な攻撃に対する第一防衛線です。プロンプトインジェクション攻撃は、システムの指示を上書きしたり、機密データを漏洩させたり、モデルを許可されていない挙動へ誘導したりする可能性があります。専用のフィルターや指示階層が整備されていない限り、非常に長いコンテキストウィンドウを利用する「マルチショット」 jailbreak 攻撃が効果的であることが研究で示されています。また、ホモグリフ置換やリートスピークのような微妙な敵対的摂動攻撃は、モデルの判断を静かに変えてしまうことがあります。

---

## C2.1 プロンプトインジェクション防御

プロンプトインジェクションはAIシステムにおける最大のリスクの一つです。これに対する防御策は、静的パターンフィルター、動的分類器、および指示階層の強制を組み合わせて用います。

|   #   | 説明                                                                                                                       | レベル | 役割  |
| :---: | ------------------------------------------------------------------------------------------------------------------------ | :-: | :-: |
| 2.1.1 | ユーザーの入力が、既知のプロンプトインジェクションパターン（脱獄キーワード、「前回を無視」、ロールプレイチェーン、間接的なHTML/URL攻撃）で構成された継続的に更新されるライブラリに対してスクリーニングされていることを検証してください。 |  1  | D/V |
| 2.1.2 | システムまたは開発者のメッセージがユーザーの指示に優先して適用される、コンテキストウィンドウの拡張後でも指示の階層をシステムが強制していることを検証してください。                                        |  1  | D/V |
| 2.1.3 | 敵対的評価テスト（例：レッドチームの「多ショット」プロンプト）が、すべてのモデルまたはプロンプトテンプレートのリリース前に実行され、成功率の閾値および回帰の自動ブロッカーが設定されていることを確認してください。                |  2  | D/V |
| 2.1.4 | サードパーティのコンテンツ（ウェブページ、PDF、メール）からのプロンプトが、メインのプロンプトに連結される前に、分離されたパースコンテキストでサニタイズされていることを確認してください。                           |  2  |  D  |
| 2.1.5 | すべてのプロンプトフィルタールールの更新、分類器モデルのバージョン、およびブロックリストの変更がバージョン管理され、監査可能であることを確認してください。                                            |  3  | D/V |

---

## C2.2 敵対的事例耐性

自然言語処理（NLP）モデルは、しばしば人間が見逃す微妙な文字や単語レベルの摂動に対して依然として脆弱であり、モデルはそれを誤分類しやすいです。

|   #   | 説明                                                                                             | レベル | 役割  |
| :---: | ---------------------------------------------------------------------------------------------- | :-: | :-: |
| 2.2.1 | 基本的な入力正規化ステップ（Unicode NFC、ホモグリフマッピング、空白のトリミング）がトークン化の前に実行されることを確認してください。                       |  1  |  D  |
| 2.2.2 | 統計的な異常検知が、言語の規範から異常に高い編集距離を持つ入力、過剰に繰り返されるトークン、または異常な埋め込み距離を持つ入力を正しく検出することを確認してください。            |  2  | D/V |
| 2.2.3 | 推論パイプラインが、ハイリスクエンドポイント向けにオプションの敵対的トレーニングで強化されたモデルバリアントや防御層（例：ランダム化、防御的蒸留）をサポートしていることを検証してください。 |  2  |  D  |
| 2.2.4 | 疑わしい敵対的入力が隔離され、PII（個人識別情報）削除後の完全なペイロードとともに記録されていることを確認してください。                                  |  2  |  V  |
| 2.2.5 | 堅牢性メトリクス（既知の攻撃スイートの成功率）が時間経過とともに追跡され、回帰がリリースブロッカーを引き起こすことを確認してください。                            |  3  | D/V |

---

## C2.3 スキーマ、タイプおよび長さの検証

不正な形式や過大な入力を伴うAI攻撃は、パースエラー、フィールド間でのプロンプトの漏出、リソース枯渇を引き起こす可能性があります。決定的なツール呼び出しを行う際には、厳格なスキーマの強制適用も前提条件となります。

|   #   | 説明                                                                                                               | レベル | 役割  |
| :---: | ---------------------------------------------------------------------------------------------------------------- | :-: | :-: |
| 2.3.1 | すべてのAPIまたは関数呼び出しエンドポイントが明確な入力スキーマ（JSON Schema、Protobuf、またはマルチモーダルの同等物）を定義しており、プロンプトの組み立て前に入力が検証されていることを確認してください。 |  1  |  D  |
| 2.3.2 | 最大トークン数またはバイト数の制限を超える入力が、安全なエラーで拒否され、決して静かに切り捨てられないことを確認してください。                                                  |  1  | D/V |
| 2.3.3 | タイプチェック（例：数値範囲、列挙型の値、画像/音声のMIMEタイプなど）がクライアントコードだけでなく、サーバー側でも強制されていることを確認してください。                                  |  2  | D/V |
| 2.3.4 | 意味的バリデータ（例：JSON Schema）がアルゴリズム的DoSを防ぐために一定時間で動作することを検証してください。                                                    |  2  |  D  |
| 2.3.5 | 検証失敗が、セキュリティトリアージを支援するために、編集済みのペイロードスニペットと明確なエラーコードとともにログに記録されていることを確認してください。                                    |  3  |  V  |

---

## C2.4 コンテンツ＆ポリシースクリーニング

開発者は、不正な指示、ヘイトスピーチ、著作権で保護されたテキストなどの禁止されたコンテンツを要求する構文的に有効なプロンプトを検出し、それらが広まるのを防止できるようにするべきです。

|   #   | 説明                                                                                                 | レベル | 役割  |
| :---: | -------------------------------------------------------------------------------------------------- | :-: | :-: |
| 2.4.1 | コンテンツ分類器（ゼロショットまたはファインチューニング済み）が、暴力、自傷、ヘイト、性的コンテンツ、違法なリクエストについて、すべての入力をスコアリングし、閾値を設定可能であることを検証します。 |  1  |  D  |
| 2.4.2 | ポリシーに違反する入力が、下流のLLM呼び出しに伝播しないように、標準化された拒否または安全な完了を受け取ることを検証します。                                    |  1  | D/V |
| 2.4.3 | スクリーニングモデルまたはルールセットが少なくとも四半期ごとに再学習/更新され、新たに観測されたジャイルブレイクやポリシーバイパスのパターンが組み込まれていることを確認してください。        |  2  |  D  |
| 2.4.4 | リクエスト時に解決される属性ベースのルールを通じて、ユーザー固有のポリシー（年齢、地域の法的制約）を順守していることを確認します。                                  |  2  |  D  |
| 2.4.5 | スクリーニングログに、SOC相関および将来のレッドチーム再生用のための分類器の信頼度スコアとポリシーカテゴリタグが含まれていることを確認してください。                        |  3  |  V  |

---

## C2.5 入力レート制限および悪用防止

開発者は、入力レートを制限し、異常な使用パターンを検出することで、AIシステムに対する悪用、リソース枯渇、および自動化された攻撃を防止する必要があります。

|   #   | 説明                                                                       | レベル | 役割  |
| :---: | ------------------------------------------------------------------------ | :-: | :-: |
| 2.5.1 | すべての入力エンドポイントに対して、ユーザーごと、IPごと、およびAPIキーごとのレート制限が適用されていることを確認してください。       |  1  | D/V |
| 2.5.2 | DoS（サービス拒否）攻撃およびブルートフォース攻撃を防ぐために、バーストおよび持続的なレート制限が適切に調整されていることを確認してください。 |  2  | D/V |
| 2.5.3 | 異常な使用パターン（例：連続リクエスト、入力の過剰送信）が自動ブロックまたはエスカレーションを引き起こすことを確認してください。         |  2  | D/V |
| 2.5.4 | 悪用防止ログが保持され、新たな攻撃パターンの検出のためにレビューされていることを確認してください。                        |  3  |  V  |

---

## C2.6 マルチモーダル入力検証

AIシステムは、注入、回避、またはリソースの乱用を防ぐために、非テキスト入力（画像、音声、ファイル）に対して堅牢な検証を含めるべきです。

|   #   | 説明                                                                   | レベル | 役割  |
| :---: | -------------------------------------------------------------------- | :-: | :-: |
| 2.6.1 | すべての非テキスト入力（画像、音声、ファイル）が処理前にタイプ、サイズ、およびフォーマットについて検証されていることを確認してください。 |  1  |  D  |
| 2.6.2 | ファイルが取り込み前にマルウェアおよびステガノグラフィックペイロードのスキャンを受けていることを確認してください。            |  2  | D/V |
| 2.6.3 | 画像/音声入力が敵対的摂動や既知の攻撃パターンについて検査されていることを確認してください。                       |  2  | D/V |
| 2.6.4 | マルチモーダル入力検証の失敗がログに記録され、調査のためのアラートが発生することを確認してください。                   |  3  |  V  |

---

## C2.7 入力の発信元と帰属

AIシステムは、すべてのユーザー入力の起源を監視およびタグ付けすることで、監査、悪用追跡、およびコンプライアンスを支援すべきです。

|   #   | 説明                                                                            | レベル | 役割  |
| :---: | ----------------------------------------------------------------------------- | :-: | :-: |
| 2.7.1 | すべてのユーザー入力が取り込み時にメタデータ（ユーザーID、セッション、ソース、タイムスタンプ、IPアドレス）でタグ付けされていることを確認してください。 |  1  | D/V |
| 2.7.2 | 処理されたすべての入力に対して、出所のメタデータが保持され監査可能であることを検証してください。                              |  2  | D/V |
| 2.7.3 | 異常または信頼できない入力ソースがフラグ付けされ、強化された精査またはブロックの対象となることを確認してください。                     |  2  | D/V |

---

## C2.8 リアルタイム適応型脅威検出

開発者は、新しい攻撃パターンに適応し、コンパイルされたパターンマッチングによるリアルタイム保護を提供する、AI向けの高度な脅威検出システムを採用すべきです。

|   #   | 説明                                                                                          | レベル | 役割  |
| :---: | ------------------------------------------------------------------------------------------- | :-: | :-: |
| 2.8.1 | 脅威検出パターンが、レイテンシの影響を最小限に抑えつつ高性能なリアルタイムフィルタリングのために最適化された正規表現エンジンにコンパイルされていることを検証してください。       |  1  | D/V |
| 2.8.2 | 脅威検出システムが、異なる脅威カテゴリ（プロンプトインジェクション、有害コンテンツ、機微データ、システムコマンド）ごとに別々のパターンライブラリを保持していることを確認してください。 |  1  | D/V |
| 2.8.3 | 適応型脅威検知が、攻撃頻度と成功率に基づいて脅威感度を更新する機械学習モデルを組み込んでいることを確認してください。                                  |  2  | D/V |
| 2.8.4 | リアルタイムの脅威インテリジェンスフィードが、新しい攻撃シグネチャやIOC（侵害の指標）をパターンライブラリに自動的に更新することを確認してください。                 |  2  | D/V |
| 2.8.5 | 脅威検出の誤検知率が継続的に監視されていることを確認し、正当なユースケースへの影響を最小限に抑えるためにパターンの特異性が自動的に調整されていることを確認してください。        |  3  | D/V |
| 2.8.6 | コンテキスト脅威分析が、検出精度を向上させるために入力元、ユーザー行動パターン、およびセッション履歴を考慮していることを確認してください。                       |  3  | D/V |
| 2.8.7 | 脅威検出のパフォーマンス指標（検出率、処理遅延、リソース利用率）がリアルタイムで監視および最適化されていることを確認してください。                           |  3  | D/V |

---

## C2.9 マルチモーダルセキュリティ検証パイプライン

開発者は、特定の種類の脅威検出とリソース隔離を伴うテキスト、画像、音声、およびその他のAI入力モダリティに対してセキュリティ検証を提供する必要があります。

|   #   | 説明                                                                                                                    | レベル | 役割  |
| :---: | --------------------------------------------------------------------------------------------------------------------- | :-: | :-: |
| 2.9.1 | 各入力モダリティに対して、専用のセキュリティバリデータが存在し、脅威パターン（テキスト：プロンプトインジェクション、画像：ステガノグラフィー、音声：スペクトログラム攻撃）および検出閾値が文書化されていることを確認してください。     |  1  | D/V |
| 2.9.2 | マルチモーダル入力が、それぞれのモダリティタイプに特有のリソース制限（メモリ、CPU、処理時間）が設定された分離されたサンドボックス内で処理されていることを確認し、それらがセキュリティポリシーに文書化されていることを検証してください。 |  2  | D/V |
| 2.9.3 | クロスモーダル攻撃検出が、複数の入力タイプにまたがる協調攻撃（例：画像内のステガノグラフィックペイロードとテキスト内のプロンプトインジェクションの組み合わせ）を相関ルールとアラート生成によって識別することを検証する。          |  2  | D/V |
| 2.9.4 | マルチモーダル検証の失敗が、すべての入力モダリティ、検証結果、脅威スコア、および相関分析を含む詳細なログ記録をトリガーし、SIEM統合のための構造化ログ形式であることを確認してください。                         |  3  | D/V |
| 2.9.5 | モダリティ固有のコンテンツ分類器が、文書化されたスケジュール（最低でも四半期ごと）に従って、新しい脅威パターン、敵対的事例、およびベースライン閾値を上回る性能ベンチマークとともに更新されていることを検証する。              |  3  | D/V |

---

## 参考文献

* [LLM01:2025 Prompt Injection – OWASP Top 10 for LLM & Generative AI Security](https://genai.owasp.org/llmrisk/llm01-prompt-injection/)
* [Generative AI's Biggest Security Flaw Is Not Easy to Fix](https://www.wired.com/story/generative-ai-prompt-injection-hacking)
* [Many-shot jailbreaking \ Anthropic](https://www.anthropic.com/research/many-shot-jailbreaking)
* [$PDF$ OpenAI GPT-4.5 System Card](https://cdn.openai.com/gpt-4-5-system-card-2272025.pdf)
* [Notebook for the CheckThat Lab at CLEF 2024](https://ceur-ws.org/Vol-3740/paper-53.pdf)
* [Mitigate jailbreaks and prompt injections – Anthropic](https://docs.anthropic.com/en/docs/test-and-evaluate/strengthen-guardrails/mitigate-jailbreaks)
* [Chapter 3 MITRE ATT\&CK – Adversarial Model Analysis](https://ama.drwhy.ai/mitre-attck.html)
* [OWASP Top 10 for LLM Applications 2025 – WorldTech IT](https://wtit.com/blog/2025/04/17/owasp-top-10-for-llm-applications-2025/)
* [OWASP Machine Learning Security Top Ten](https://owasp.org/www-project-machine-learning-security-top-10/)
* [Few words about AI Security – Jussi Metso](https://www.jussimetso.com/index.php/2024/09/28/few-words-about-ai-security/)
* [How To Ensure LLM Output Adheres to a JSON Schema | Modelmetry](https://modelmetry.com/blog/how-to-ensure-llm-output-adheres-to-a-json-schema)
* [Easily enforcing valid JSON schema following – API](https://community.openai.com/t/feature-request-function-calling-easily-enforcing-valid-json-schema-following/263515?utm_source)
* [AI Safety + Cybersecurity R\&D Tracker – Fairly AI](https://www.fairly.ai/blog/ai-cybersecurity-tracker)
* [Anthropic makes 'jailbreak' advance to stop AI models producing harmful results](https://www.ft.com/content/cf11ebd8-aa0b-4ed4-945b-a5d4401d186e)
* [Pattern matching filter rules - IBM](https://www.ibm.com/docs/ssw_aix_71/security/intrusion_pattern_matching_filter_rules.html)
* [Real-time Threat Detection](https://www.darktrace.com/cyber-ai-glossary/real-time-threat-detection)

