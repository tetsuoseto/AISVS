# C2 ユーザー入力検証

## 制御目標

ユーザー入力の堅牢な検証は、AIシステムに対する最も破壊的な攻撃のいくつかに対する第一防衛線です。プロンプトインジェクション攻撃は、システムの指示を上書きしたり、機密データを漏洩させたり、モデルを許可されていない行動へ誘導したりする可能性があります。専用のフィルターや指示階層が整備されていない限り、研究によれば、非常に長いコンテキストウィンドウを悪用する「マルチショット」脱獄攻撃は効果的であることが示されています。また、ホモグリフの置換やリートスピークのような微妙な敵対的摂動攻撃によって、モデルの判断が静かに変えられることもあります。

---

## C2.1 プロンプトインジェクション防御

プロンプトインジェクションはAIシステムにとって最大のリスクの一つです。この手法に対する防御策は、静的パターンフィルター、動的分類器、および命令階層の強制を組み合わせて用います。

|   #   | 説明                                                                                                                     | レベル | 役割  |
| :---: | ---------------------------------------------------------------------------------------------------------------------- | :-: | :-: |
| 2.1.1 | ユーザー入力が、既知のプロンプトインジェクションパターン（脱獄キーワード、「前の指示を無視」、ロールプレイチェーン、間接的なHTML/URL攻撃）を含む継続的に更新されるライブラリに対して検査されていることを確認してください。      |  1  | D/V |
| 2.1.2 | システムまたは開発者のメッセージが、コンテキストウィンドウの拡大後でもユーザーの指示を上書きする命令階層をシステムが適用していることを確認してください。                                           |  1  | D/V |
| 2.1.3 | 敵対的評価テスト（例：レッドチームによる「多数ショット」プロンプト）が、すべてのモデルまたはプロンプトテンプレートのリリース前に実施されていることを確認し、成功率の閾値と回帰に対する自動ブロッカーが設定されていることを確認してください。 |  2  | D/V |
| 2.1.4 | サードパーティのコンテンツ（ウェブページ、PDF、電子メール）からのプロンプトが、メインプロンプトに連結される前に、隔離された解析コンテキストで適切にサニタイズされていることを確認してください。                      |  2  |  D  |
| 2.1.5 | すべてのプロンプトフィルタールールの更新、分類モデルのバージョン、およびブロックリストの変更がバージョン管理されており、監査可能であることを確認してください。                                        |  3  | D/V |

---

## C2.2 敵対的サンプル耐性

自然言語処理（NLP）モデルは、ヒトが見逃しがちな微細な文字や単語レベルの摂動に対して依然として脆弱であり、それが原因でモデルは誤分類しやすい。

|   #   | 説明                                                                                             | レベル | 役割  |
| :---: | ---------------------------------------------------------------------------------------------- | :-: | :-: |
| 2.2.1 | 基本的な入力正規化手順（Unicode NFC、ホモグリフマッピング、ホワイトスペースのトリミング）がトークナイゼーションの前に実行されることを確認してください。              |  1  |  D  |
| 2.2.2 | 統計的異常検出が、言語規範から異常に高い編集距離を持つ入力、過剰に繰り返されるトークン、または異常な埋め込み距離を持つ入力をフラグ付けすることを検証してください。              |  2  | D/V |
| 2.2.3 | 推論パイプラインが、オプションの敵対的訓練で強化されたモデルバリアントや防御層（例：ランダマイゼーション、防御的蒸留）を高リスクエンドポイント向けにサポートしていることを検証してください。 |  2  |  D  |
| 2.2.4 | 疑わしい敵対的入力が隔離され、PIIの編集後に完全なペイロードとともにログ記録されていることを確認してください。                                       |  2  |  V  |
| 2.2.5 | 堅牢性指標（既知の攻撃スイートの成功率）が時間経過で追跡され、回帰がリリースブロッカーを引き起こすことを確認してください。                                  |  3  | D/V |

---

## C2.3 スキーマ、タイプおよび長さの検証

不正な形式または過大な入力を特徴とするAI攻撃は、パースエラー、フィールド間でのプロンプトの漏れ、リソースの枯渇を引き起こす可能性があります。決定論的なツール呼び出しを行う際には、厳格なスキーマの適用も必須条件となります。

|   #   | 説明                                                                                                             | レベル | 役割  |
| :---: | -------------------------------------------------------------------------------------------------------------- | :-: | :-: |
| 2.3.1 | すべてのAPIまたは関数呼び出しエンドポイントが明示的な入力スキーマ（JSONスキーマ、Protobuf、またはマルチモーダルの同等物）を定義しており、入力がプロンプトの組み立て前に検証されていることを確認してください。 |  1  |  D  |
| 2.3.2 | 最大トークン数またはバイト数の制限を超える入力が、安全なエラーで拒否され、決して黙って切り捨てられないことを検証してください。                                                |  1  | D/V |
| 2.3.3 | タイプチェック（例えば、数値範囲、列挙型の値、画像/音声のMIMEタイプなど）がクライアントコードだけでなく、サーバーサイドでも確実に実施されていることを確認してください。                         |  2  | D/V |
| 2.3.4 | 意味論的バリデーター（例：JSON Schema）が定数時間で動作し、アルゴリズム的なDoS攻撃を防ぐことを検証してください。                                                |  2  |  D  |
| 2.3.5 | 検証失敗が、セキュリティ対応を支援するためにペイロードの断片を伏せ字にし、明確なエラーコードと共にログ記録されていることを確認してください。                                         |  3  |  V  |

---

## C2.4 コンテンツおよびポリシースクリーニング

開発者は、不正な指示、ヘイトスピーチ、著作権で保護されたテキストなどの許可されていないコンテンツを要求する構文的に有効なプロンプトを検出し、それらが拡散するのを防止できるようにする必要があります。

|   #   | 説明                                                                                             | レベル | 役割  |
| :---: | ---------------------------------------------------------------------------------------------- | :-: | :-: |
| 2.4.1 | コンテンツ分類器（ゼロショットまたは微調整済み）が、暴力、自傷、ヘイト、性的内容、違法な要求について、設定可能な閾値で全ての入力をスコアリングすることを検証してください。          |  1  |  D  |
| 2.4.2 | ポリシーに違反する入力が標準化された拒否または安全な完了を受け取り、それらが下流のLLM呼び出しに伝播しないことを検証してください。                             |  1  | D/V |
| 2.4.3 | スクリーニングモデルまたはルールセットが、少なくとも四半期ごとに再訓練または更新され、新たに観察されたジャイルブレイクやポリシーバイパスのパターンが組み込まれていることを確認してください。 |  2  |  D  |
| 2.4.4 | リクエスト時に解決される属性ベースのルールを通じて、ユーザー固有のポリシー（年齢、地域の法的制約）を遵守していることを検証してください。                           |  2  |  D  |
| 2.4.5 | スクリーニングログに、SOC相関および将来のレッドチーム再実行のための分類器の信頼度スコアとポリシーカテゴリタグが含まれていることを確認してください。                    |  3  |  V  |

---

## C2.5 入力レート制限と乱用防止

開発者は、入力レートを制限し、異常な使用パターンを検出することで、AIシステムに対する悪用、リソース枯渇、および自動化された攻撃を防止する必要があります。

|   #   | 説明                                                                   | レベル | 役割  |
| :---: | -------------------------------------------------------------------- | :-: | :-: |
| 2.5.1 | すべての入力エンドポイントに対して、ユーザーごと、IPごと、およびAPIキーごとのレートリミットが適用されていることを確認してください。 |  1  | D/V |
| 2.5.2 | DoS攻撃およびブルートフォース攻撃を防ぐために、バーストおよび持続的なレート制限が適切に調整されていることを確認してください。     |  2  | D/V |
| 2.5.3 | 異常な使用パターン（例：連続リクエスト、入力の過剰送信）が自動的なブロックまたはエスカレーションを引き起こすことを確認してください。   |  2  | D/V |
| 2.5.4 | 攻撃防止ログが保持され、新たに発生する攻撃パターンのためにレビューされていることを確認してください。                   |  3  |  V  |

---

## C2.6 マルチモーダル入力検証

AIシステムは、注入、回避、またはリソースの乱用を防ぐために、非テキスト入力（画像、音声、ファイル）に対する堅牢な検証を含めるべきです。

|   #   | 説明                                                                    | レベル | 役割  |
| :---: | --------------------------------------------------------------------- | :-: | :-: |
| 2.6.1 | 処理前に、すべての非テキスト入力（画像、音声、ファイル）がタイプ、サイズ、およびフォーマットについて検証されていることを確認してください。 |  1  |  D  |
| 2.6.2 | ファイルが取り込み前にマルウェアおよびステガノグラフィックペイロードのスキャンを受けていることを確認してください。             |  2  | D/V |
| 2.6.3 | 画像/音声入力が敵対的摂動や既知の攻撃パターンに対して検査されていることを確認してください。                        |  2  | D/V |
| 2.6.4 | マルチモーダル入力検証の失敗がログに記録され、調査のためのアラートがトリガーされることを確認してください。                 |  3  |  V  |

---

## C2.7 入力の由来と帰属

AIシステムは、すべてのユーザー入力の起源を監視およびタグ付けすることで、監査、悪用追跡、コンプライアンスを支援すべきです。

|   #   | 説明                                                                            | レベル | 役割  |
| :---: | ----------------------------------------------------------------------------- | :-: | :-: |
| 2.7.1 | すべてのユーザー入力が取り込み時にメタデータ（ユーザーID、セッション、ソース、タイムスタンプ、IPアドレス）でタグ付けされていることを確認してください。 |  1  | D/V |
| 2.7.2 | すべての処理された入力に対して、出所のメタデータが保持され、監査可能であることを確認してください。                             |  2  | D/V |
| 2.7.3 | 異常または信頼できない入力ソースがフラグ付けされ、強化された検査またはブロックの対象となることを確認してください。                     |  2  | D/V |

---

## C2.8 リアルタイム適応型脅威検知

開発者は、新しい攻撃パターンに適応し、コンパイルされたパターンマッチングによってリアルタイム保護を提供する高度な脅威検出システムをAIに対して導入すべきです。

|   #   | 説明                                                                                         | レベル | 役割  |
| :---: | ------------------------------------------------------------------------------------------ | :-: | :-: |
| 2.8.1 | 脅威検出パターンが、高性能なリアルタイムフィルタリングのために最適化された正規表現エンジンにコンパイルされ、レイテンシへの影響が最小限に抑えられていることを検証してください。    |  1  | D/V |
| 2.8.2 | 脅威検出システムが異なる脅威カテゴリ（プロンプトインジェクション、有害コンテンツ、機密データ、システムコマンド）ごとに別々のパターンライブラリを維持していることを確認してください。 |  1  | D/V |
| 2.8.3 | 適応型脅威検出が、攻撃の頻度と成功率に基づいて脅威感度を更新する機械学習モデルを組み込んでいることを検証してください。                                |  2  | D/V |
| 2.8.4 | リアルタイムの脅威インテリジェンスフィードが、新しい攻撃シグネチャおよびIOC（侵害の指標）を使ってパターンライブラリを自動的に更新することを確認してください。           |  2  | D/V |
| 2.8.5 | 脅威検出の誤検知率が継続的に監視されており、パターンの特異性が正当なユースケースへの干渉を最小限に抑えるよう自動的に調整されていることを確認してください。              |  3  | D/V |
| 2.8.6 | コンテキストベースの脅威分析が、入力ソース、ユーザーの行動パターン、およびセッション履歴を考慮して検出精度を向上させることを確認してください。                    |  3  | D/V |
| 2.8.7 | 脅威検知のパフォーマンス指標（検知率、処理遅延、リソース利用率）がリアルタイムで監視され、最適化されていることを確認してください。                          |  3  | D/V |

---

## C2.9 マルチモーダル セキュリティ検証パイプライン

開発者は、特定の脅威検出およびリソース分離を用いて、テキスト、画像、音声、その他のAI入力モダリティに対するセキュリティ検証を提供すべきです。

|   #   | 説明                                                                                                                | レベル | 役割  |
| :---: | ----------------------------------------------------------------------------------------------------------------- | :-: | :-: |
| 2.9.1 | 各入力モダリティが専用のセキュリティバリデータを備え、それぞれの脅威パターン（テキスト：プロンプトインジェクション、画像：ステガノグラフィ、音声：スペクトログラム攻撃）および検出閾値が文書化されていることを確認する。      |  1  | D/V |
| 2.9.2 | マルチモーダル入力が、それぞれのモダリティタイプに特有のリソース制限（メモリ、CPU、処理時間）を持つ独立したサンドボックス内で処理されていることを確認し、それがセキュリティポリシーに文書化されていることを検証してください。  |  2  | D/V |
| 2.9.3 | クロスモーダル攻撃検出が、相関ルールとアラート生成を用いて、複数の入力タイプにまたがる協調攻撃（例：画像内のステガノグラフィックペイロードとテキスト内のプロンプトインジェクションの組み合わせ）を識別することを検証してください。 |  2  | D/V |
| 2.9.4 | マルチモーダル検証の失敗が、すべての入力モダリティ、検証結果、脅威スコア、および構造化ログ形式での相関分析を含む詳細なログ記録をトリガーし、SIEM統合に対応していることを検証してください。                   |  3  | D/V |
| 2.9.5 | モダリティ固有のコンテンツ分類器が、文書化されたスケジュール（最低でも四半期ごと）に従って、新しい脅威パターン、敵対的サンプル、および基準値以上の性能ベンチマークで更新されていることを確認してください。             |  3  | D/V |

---

## 参考文献

* [LLM01:2025 Prompt Injection – OWASP Top 10 for LLM & Generative AI Security](https://genai.owasp.org/llmrisk/llm01-prompt-injection/)
* [Generative AI's Biggest Security Flaw Is Not Easy to Fix](https://www.wired.com/story/generative-ai-prompt-injection-hacking)
* [Many-shot jailbreaking \ Anthropic](https://www.anthropic.com/research/many-shot-jailbreaking)
* [$PDF$ OpenAI GPT-4.5 System Card](https://cdn.openai.com/gpt-4-5-system-card-2272025.pdf)
* [Notebook for the CheckThat Lab at CLEF 2024](https://ceur-ws.org/Vol-3740/paper-53.pdf)
* [Mitigate jailbreaks and prompt injections – Anthropic](https://docs.anthropic.com/en/docs/test-and-evaluate/strengthen-guardrails/mitigate-jailbreaks)
* [Chapter 3 MITRE ATT\&CK – Adversarial Model Analysis](https://ama.drwhy.ai/mitre-attck.html)
* [OWASP Top 10 for LLM Applications 2025 – WorldTech IT](https://wtit.com/blog/2025/04/17/owasp-top-10-for-llm-applications-2025/)
* [OWASP Machine Learning Security Top Ten](https://owasp.org/www-project-machine-learning-security-top-10/)
* [Few words about AI Security – Jussi Metso](https://www.jussimetso.com/index.php/2024/09/28/few-words-about-ai-security/)
* [How To Ensure LLM Output Adheres to a JSON Schema | Modelmetry](https://modelmetry.com/blog/how-to-ensure-llm-output-adheres-to-a-json-schema)
* [Easily enforcing valid JSON schema following – API](https://community.openai.com/t/feature-request-function-calling-easily-enforcing-valid-json-schema-following/263515?utm_source)
* [AI Safety + Cybersecurity R\&D Tracker – Fairly AI](https://www.fairly.ai/blog/ai-cybersecurity-tracker)
* [Anthropic makes 'jailbreak' advance to stop AI models producing harmful results](https://www.ft.com/content/cf11ebd8-aa0b-4ed4-945b-a5d4401d186e)
* [Pattern matching filter rules - IBM](https://www.ibm.com/docs/ssw_aix_71/security/intrusion_pattern_matching_filter_rules.html)
* [Real-time Threat Detection](https://www.darktrace.com/cyber-ai-glossary/real-time-threat-detection)

