# C2 Валидация ввода пользователя

## Контрольная цель

Надежная валидация входных данных пользователя — первая линия защиты от одних из самых разрушительных атак на системы ИИ. Атаки инъекции подсказок могут переопределять инструкции системы, раскрывать конфиденциальные данные или направлять модель к поведению, которое не допускается. Если не применяются специальные фильтры и иерархии инструкций, исследования показывают, что "multi-shot" джейлбрейки, эксплуатирующие очень длинные контекстные окна, будут эффективны. Также, тонкие адверсариальные возмущающие атаки--такие как замены гомоглифами или leetspeak—могут незаметно изменить решения модели.

---

## C2.1 Защита от инъекции подсказок

Инъекция подсказок — один из основных рисков для систем искусственного интеллекта. Защита от этой тактики включает сочетание статических фильтров по шаблонам, динамических классификаторов и обеспечения соблюдения иерархии инструкций.

|   #   | Описание                                                                                                                                                                                                                                                                    | Уровень | Роль |
| :---: | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 2.1.1 | Убедитесь, что входные данные пользователей проходят проверку в соответствии с постоянно обновляемой базой известных образцов инъекции подсказок (ключевые слова обхода ограничений, "игнорировать предыдущие", цепочки ролевых сценариев, косвенные атаки через HTML/URL). |    1    | D/V  |
| 2.1.2 | Проверьте, что система обеспечивает иерархию инструкций, в которой сообщения системы или разработчика имеют приоритет над инструкциями пользователя, даже после расширения окна контекста.                                                                                  |    1    | D/V  |
| 2.1.3 | Убедитесь, что адверсариальные оценочные тесты (например, подсказки Red Team с множеством примеров) проводятся перед каждым выпуском модели или шаблона подсказок, с порогами уровня успешности и автоматическими блокировщиками регрессий.                                 |    2    | D/V  |
| 2.1.4 | Убедитесь, что запросы, исходящие из контента третьих лиц (веб-страницы, PDF-документы, электронная почта), проходят очистку в изолированном контексте парсинга перед конкатенацией с основным запросом.                                                                    |    2    |  D   |
| 2.1.5 | Убедитесь, что все обновления правил фильтра подсказок, версии классификаторов и изменения в блок-листе находятся под версионным контролем и подлежат аудиту.                                                                                                               |    3    | D/V  |

---

## C2.2 Устойчивость к враждебным примерам

Модели обработки естественного языка (NLP) по-прежнему уязвимы к тонким возмущениям на уровне символов или слов, которые люди часто не замечают, но модели склонны к неправильной классификации.

|   #   | Описание                                                                                                                                                                                                                             | Уровень | Роль |
| :---: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :-----: | :--: |
| 2.2.1 | Убедитесь, что базовые шаги нормализации входных данных (Unicode NFC, отображение гомоглифов, обрезка пробелов) выполняются перед токенизацией.                                                                                      |    1    |  D   |
| 2.2.2 | Проверьте, что статистическое обнаружение аномалий помечает входные данные с необычно большим расстоянием редактирования по отношению к языковым нормам, чрезмерно повторяющимися токенами или аномальными расстояниями эмбеддингов. |    2    | D/V  |
| 2.2.3 | Проверьте, поддерживает ли пайплайн инференса опциональные варианты моделей, усиленные обучением против атак, или слои защиты (например, рандомизацию, защитную дистилляцию) для критических конечных точек.                         |    2    |  D   |
| 2.2.4 | Убедитесь, что подозрительные адверсариальные входные данные помещаются в карантин и регистрируются с полными полезными нагрузками (после редактирования личной идентифицируемой информации, PII).                                   |    2    |  V   |
| 2.2.5 | Убедитесь, что показатели устойчивости (уровень успешности известных наборов атак) отслеживаются со временем, и регрессии приводят к блокировке релиза.                                                                              |    3    | D/V  |

---

## C2.3 Валидация схемы, типа и длины

Атаки на ИИ, в которых используются некорректно сформированные или слишком крупные входные данные, могут вызывать ошибки парсинга, утечки подсказок между полями и истощение ресурсов.  Строгое соблюдение схемы также является предпосылкой при выполнении детерминированных вызовов инструментов.

|   #   | Описание                                                                                                                                                                                                                       | Уровень | Роль |
| :---: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :-----: | :--: |
| 2.3.1 | Убедитесь, что каждый конечный API-эндпойнт или вызов функции определяет явную схему входных данных (JSON Schema, Protobuf или эквивалент мультимодального формата) и что входные данные валидируются до формирования промпта. |    1    |  D   |
| 2.3.2 | Проверьте, что входные данные, превышающие максимальные пределы по токенам или байтам, отклоняются с безопасной ошибкой и никогда не обрезаются без уведомления.                                                               |    1    | D/V  |
| 2.3.3 | Убедитесь, что проверки типов (например, числовые диапазоны, значения перечисления, MIME-типы изображений и аудио) выполняются на стороне сервера, а не только в клиентском коде.                                              |    2    | D/V  |
| 2.3.4 | Убедитесь, что семантические валидаторы (например, JSON Schema) работают за константное время, чтобы предотвратить алгоритмическую DoS-атаку.                                                                                  |    2    |  D   |
| 2.3.5 | Убедитесь, что ошибки валидации журналируются с замаскированными фрагментами полезной нагрузки и однозначными кодами ошибок, чтобы облегчить обработку инцидентов безопасности.                                                |    3    |  V   |

---

## C2.4 Проверка контента и политики

Разработчики должны иметь возможность выявлять синтаксически корректные запросы, запрашивающие запрещённый контент (например, незаконные инструкции, речь ненависти и текст, охраняемый авторским правом), и затем предотвращать их распространение.

|   #   | Описание                                                                                                                                                                                                      | Уровень | Роль |
| :---: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 2.4.1 | Проверьте, что классификатор контента (zero-shot или fine-tuned) оценивает каждый ввод по насилию, самоповреждению, ненависти, сексуальному содержанию и незаконным запросам, с настраиваемыми порогами.      |    1    |  D   |
| 2.4.2 | Проверьте, что вводы, нарушающие правила, получают стандартизированные отказные ответы или безопасные завершения, чтобы они не попадали на последующие вызовы LLM.                                            |    1    | D/V  |
| 2.4.3 | Убедитесь, что модель фильтрации или набор правил переобучается или обновляется как минимум раз в квартал, включая недавно обнаруженные паттерны обхода ограничений или обхода политики.                      |    2    |  D   |
| 2.4.4 | Проверьте, что скрининг соблюдает политики, специфичные для пользователя (возраст, региональные юридические ограничения), с использованием правил на основе атрибутов, которые определяются во время запроса. |    2    |  D   |
| 2.4.5 | Убедитесь, что журналы скрининга содержат оценки уверенности классификатора и теги категорий политики, предназначенные для корреляции с SOC и будущего повторного прогона красной команды.                    |    3    |  V   |

---

## C2.5 Ограничение скорости входящих запросов и предотвращение злоупотреблений

Разработчики должны предотвращать злоупотребления, истощение ресурсов и автоматизированные атаки на системы ИИ, ограничивая скорость ввода и выявляя аномальные закономерности использования.

|   #   | Описание                                                                                                                                                                 | Уровень | Роль |
| :---: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :-----: | :--: |
| 2.5.1 | Проверьте, что ограничения скорости запросов по каждому пользователю, по каждому IP-адресу и по каждому API-ключу применяются для всех входных точек.                    |    1    | D/V  |
| 2.5.2 | Убедитесь, что пиковые и устойчивые ограничения скорости настроены таким образом, чтобы предотвращать DoS-атаки и переборы паролей.                                      |    2    | D/V  |
| 2.5.3 | Проверьте, что аномальные паттерны использования (например, частые последовательные запросы, потоки входных данных) приводят к автоматическим блокировкам или эскалации. |    2    | D/V  |
| 2.5.4 | Убедитесь, что журналы предотвращения злоупотреблений сохраняются и просматриваются для выявления возникающих схем атак.                                                 |    3    |  V   |

---

## C2.6 Мультимодальная валидация входных данных

Системы искусственного интеллекта должны включать надежную валидацию не-текстовых входных данных (изображения, аудио, файлы), чтобы предотвратить инъекции, обход или злоупотребление ресурсами.

|   #   | Описание                                                                                                                               | Уровень | Роль |
| :---: | -------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 2.6.1 | Убедитесь, что все не текстовые входные данные (изображения, аудио, файлы) проходят проверку типа, размера и формата перед обработкой. |    1    |  D   |
| 2.6.2 | Убедитесь, что файлы проходят сканирование на вредоносное ПО и стеганографические полезные нагрузки перед загрузкой.                   |    2    | D/V  |
| 2.6.3 | Проверьте, что входные данные изображений/аудио проверяются на наличие адверсариальных возмущений или известных паттернов атак.        |    2    | D/V  |
| 2.6.4 | Убедитесь, что сбои проверки мультимодальных входных данных регистрируются и вызывают оповещения для расследования.                    |    3    |  V   |

---

## C2.7 Происхождение входных данных и атрибуция

Системы ИИ должны поддерживать аудит, отслеживание злоупотреблений и соблюдение требований через мониторинг и маркировку происхождения всех входных данных пользователей.

|   #   | Описание                                                                                                                                                                     | Уровень | Роль |
| :---: | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 2.7.1 | Проверьте, что все вводимые пользователем данные помечены метаданными (идентификатор пользователя, сессия, источник, временная метка, IP-адрес) на этапе поступления данных. |    1    | D/V  |
| 2.7.2 | Проверьте, что метаданные происхождения сохраняются и подлежат аудиту для всех обработанных входных данных.                                                                  |    2    | D/V  |
| 2.7.3 | Проверьте, что аномальные или ненадежные источники входных данных помечаются и подлежат усиленному контролю или блокировке.                                                  |    2    | D/V  |

---

## C2.8 Адаптивное обнаружение угроз в реальном времени

Разработчики должны использовать передовые системы обнаружения угроз для ИИ, которые адаптируются к новым паттернам атак и обеспечивают защиту в реальном времени с помощью скомпилированного сопоставления паттернов.

|   #   | Описание                                                                                                                                                                                                              | Уровень | Роль |
| :---: | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 2.8.1 | Убедитесь, что паттерны обнаружения угроз компилируются в оптимизированные движки регулярных выражений для высокопроизводительной фильтрации в реальном времени с минимальным влиянием задержки.                      |    1    | D/V  |
| 2.8.2 | Проверьте, что системы обнаружения угроз поддерживают отдельные библиотеки шаблонов для различных категорий угроз (инъекция подсказок, вредоносный контент, чувствительные данные, системные команды).                |    1    | D/V  |
| 2.8.3 | Убедитесь, что адаптивное обнаружение угроз включает модели машинного обучения, которые обновляют чувствительность к угрозам на основе частоты атак и коэффициента их успешности.                                     |    2    | D/V  |
| 2.8.4 | Убедитесь, что потоки информации об угрозах в режиме реального времени автоматически обновляют библиотеки сигнатур новыми сигнатурами атак и IOCs (Indicators of Compromise).                                         |    2    | D/V  |
| 2.8.5 | Убедитесь, что уровни ложноположительных срабатываний обнаружения угроз постоянно отслеживаются, а специфику паттернов автоматически настраивается, чтобы минимизировать помехи для законных сценариев использования. |    3    | D/V  |
| 2.8.6 | Проверьте, что контекстуальный анализ угроз учитывает источник входных данных, модели поведения пользователя и историю сеансов, чтобы повысить точность обнаружения.                                                  |    3    | D/V  |
| 2.8.7 | Убедитесь, что показатели эффективности обнаружения угроз (скорость обнаружения, задержка обработки, использование ресурсов) мониторятся и оптимизируются в режиме реального времени.                                 |    3    | D/V  |

---

## C2.9 Мультимодальный конвейер валидации безопасности

Разработчики должны обеспечить проверку безопасности для текстовых, графических и аудио входных модальностей ИИ с использованием конкретных видов обнаружения угроз и изоляции ресурсов.

|   #   | Описание                                                                                                                                                                                                                                                                                              | Уровень | Роль |
| :---: | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 2.9.1 | Убедитесь, что для каждой модальности ввода существуют специализированные валидаторы безопасности с документированными моделями угроз (текст: инъекция подсказок, изображения: стеганография, аудио: атаки на спектрограммы) и порогами обнаружения.                                                  |    1    | D/V  |
| 2.9.2 | Проверьте, что мультимодальные входные данные обрабатываются в изолированных песочницах с установленными ограничениями ресурсов (память, ЦП, время обработки), специфичными для каждого типа модальности, и задокументированы в политиках безопасности.                                               |    2    | D/V  |
| 2.9.3 | Проверьте, что межмодальное обнаружение атак идентифицирует координированные атаки, охватывающие несколько типов входных данных (например, стеганографические полезные нагрузки в изображениях, объединённые с инъекцией подсказок в тексте) с правилами корреляции и генерацией оповещений.          |    2    | D/V  |
| 2.9.4 | Проверьте, что ошибки мультимодальной валидации инициируют детальное логирование, включая все входные модальности, результаты валидации, оценки угроз и анализ корреляции с использованием структурированных форматов логирования для интеграции с SIEM.                                              |    3    | D/V  |
| 2.9.5 | Убедитесь, что классификаторы контента, специфичные для модальностей, обновляются в соответствии с документированными графиками (как минимум раз в квартал) с новыми паттернами угроз, адверсариальными примерами и бенчмарками производительности, которые остаются выше базовых пороговых значений. |    3    | D/V  |

---

## Список литературы

* [LLM01:2025 Prompt Injection – OWASP Top 10 for LLM & Generative AI Security](https://genai.owasp.org/llmrisk/llm01-prompt-injection/)
* [Generative AI's Biggest Security Flaw Is Not Easy to Fix](https://www.wired.com/story/generative-ai-prompt-injection-hacking)
* [Many-shot jailbreaking \ Anthropic](https://www.anthropic.com/research/many-shot-jailbreaking)
* [$PDF$ OpenAI GPT-4.5 System Card](https://cdn.openai.com/gpt-4-5-system-card-2272025.pdf)
* [Notebook for the CheckThat Lab at CLEF 2024](https://ceur-ws.org/Vol-3740/paper-53.pdf)
* [Mitigate jailbreaks and prompt injections – Anthropic](https://docs.anthropic.com/en/docs/test-and-evaluate/strengthen-guardrails/mitigate-jailbreaks)
* [Chapter 3 MITRE ATT\&CK – Adversarial Model Analysis](https://ama.drwhy.ai/mitre-attck.html)
* [OWASP Top 10 for LLM Applications 2025 – WorldTech IT](https://wtit.com/blog/2025/04/17/owasp-top-10-for-llm-applications-2025/)
* [OWASP Machine Learning Security Top Ten](https://owasp.org/www-project-machine-learning-security-top-10/)
* [Few words about AI Security – Jussi Metso](https://www.jussimetso.com/index.php/2024/09/28/few-words-about-ai-security/)
* [How To Ensure LLM Output Adheres to a JSON Schema | Modelmetry](https://modelmetry.com/blog/how-to-ensure-llm-output-adheres-to-a-json-schema)
* [Easily enforcing valid JSON schema following – API](https://community.openai.com/t/feature-request-function-calling-easily-enforcing-valid-json-schema-following/263515?utm_source)
* [AI Safety + Cybersecurity R\&D Tracker – Fairly AI](https://www.fairly.ai/blog/ai-cybersecurity-tracker)
* [Anthropic makes 'jailbreak' advance to stop AI models producing harmful results](https://www.ft.com/content/cf11ebd8-aa0b-4ed4-945b-a5d4401d186e)
* [Pattern matching filter rules - IBM](https://www.ibm.com/docs/ssw_aix_71/security/intrusion_pattern_matching_filter_rules.html)
* [Real-time Threat Detection](https://www.darktrace.com/cyber-ai-glossary/real-time-threat-detection)

