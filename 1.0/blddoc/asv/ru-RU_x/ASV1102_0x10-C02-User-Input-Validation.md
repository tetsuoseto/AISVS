# Валидация ввода пользователя C2

## Цель контроля

Надежная проверка пользовательского ввода является первой линией защиты от некоторых из самых разрушительных атак на системы искусственного интеллекта. Атаки с внедрением подсказок (prompt injection) могут отменять инструкции системы, раскрывать конфиденциальные данные или направлять модель к недопустимому поведению. Если не применяются специальные фильтры и иерархии инструкций, исследования показывают, что "многошаговые" jailbreak-атаки, использующие очень длинные контекстные окна, будут эффективными. Также тонкие атаки с помощью адверсариальных возмущений — такие как замены гомоглифов или использование лейтспика (leetspeak) — могут незаметно изменять решения модели.

---

## C2.1 Защита от внедрения подсказок

Инъекция подсказок является одним из главных рисков для ИИ-систем. Защита от этой тактики использует комбинацию статических фильтров шаблонов, динамических классификаторов и применения иерархии инструкций.

|   #   | Описание                                                                                                                                                                                                                                             | Уровень | Роль |
| :---: | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 2.1.1 | Проверьте, что пользовательские вводы проверяются с помощью постоянно обновляемой библиотеки известных шаблонов инъекций запросов (ключевые слова для обхода ограничений, «игнорировать предыдущие», цепочки ролевой игры, непрямые HTML/URL-атаки). |    1    | D/V  |
| 2.1.2 | Проверьте, что система соблюдает иерархию инструкций, при которой сообщения системы или разработчика имеют приоритет над инструкциями пользователя, даже после расширения окна контекста.                                                            |    1    | D/V  |
| 2.1.3 | Проверьте, что тесты противодействующей оценки (например, "many-shot" запросы Красной команды) проводятся перед каждым выпуском модели или шаблона запроса, с порогами успешности и автоматическими блокировщиками для регрессий.                    |    2    | D/V  |
| 2.1.4 | Проверьте, что подсказки, исходящие из стороннего контента (веб-страницы, PDF, электронные письма), очищаются в изолированном контексте разбора перед объединением в основную подсказку.                                                             |    2    |  D   |
| 2.1.5 | Убедитесь, что все обновления правил фильтрации запросов, версии моделей классификаторов и изменения в блок-листе находятся под управлением версий и подлежат аудиту.                                                                                |    3    | D/V  |

---

## C2.2 Сопротивление кодовым примером

Модели обработки естественного языка (NLP) по-прежнему уязвимы к тонким возмущениям на уровне символов или слов, которые люди часто не замечают, но которые модели склонны неправильно классифицировать.

|   #   | Описание                                                                                                                                                                                                                                             | Уровень | Роль |
| :---: | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 2.2.1 | Убедитесь, что базовые шаги нормализации ввода (Unicode NFC, отображение гомоглифов, обрезка пробелов) выполняются до токенизации.                                                                                                                   |    1    |  D   |
| 2.2.2 | Проверьте, что обнаружение статистических аномалий выявляет входные данные с необычно большим расстоянием редактирования по отношению к языковым нормам, чрезмерно повторяющиеся токены или аномальные расстояния между встраиваниями.               |    2    | D/V  |
| 2.2.3 | Проверьте, что конвейер инференса поддерживает опциональные варианты моделей, укрепленных с помощью тренировки с противодействием атакам, или защитные слои (например, рандомизация, защитное дистиллирование) для высокорискованных конечных точек. |    2    |  D   |
| 2.2.4 | Убедитесь, что подозрительные враждебные входные данные помещаются в карантин, регистрируются с полными полезными нагрузками (после удаления персональных данных).                                                                                   |    2    |  V   |
| 2.2.5 | Проверьте, что метрики устойчивости (процент успешных известных наборов атак) отслеживаются с течением времени, и регрессии вызывают блокирующее выпуск меры.                                                                                        |    3    | D/V  |

---

## C2.3 Схема, Тип и Проверка Длины

Атаки на ИИ с использованием искажённых или слишком больших входных данных могут вызывать ошибки разборки, утечку подсказок между полями и исчерпание ресурсов. Строгое соблюдение схемы также является обязательным при выполнении детерминированных вызовов инструментов.

|   #   | Описание                                                                                                                                                                                                                     | Уровень | Роль |
| :---: | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 2.3.1 | Убедитесь, что каждая конечная точка вызова API или функции определяет явную схему входных данных (JSON Schema, Protobuf или мультимодальный эквивалент) и что входные данные проходят проверку перед формированием запроса. |    1    |  D   |
| 2.3.2 | Проверьте, что входные данные, превышающие максимальные лимиты токенов или байтов, отклоняются с безопасной ошибкой и никогда не обрезаются без уведомления.                                                                 |    1    | D/V  |
| 2.3.3 | Убедитесь, что проверки типов (например, числовые диапазоны, значения перечислений, MIME-типы для изображений/аудио) выполняются на стороне сервера, а не только в клиентском коде.                                          |    2    | D/V  |
| 2.3.4 | Проверьте, что семантические валидаторы (например, JSON Schema) работают за постоянное время, чтобы предотвратить алгоритмические атаки типа DoS.                                                                            |    2    |  D   |
| 2.3.5 | Проверьте, что ошибки валидации регистрируются с редактированными фрагментами полезной нагрузки и однозначными кодами ошибок для облегчения обработки инцидентов безопасности.                                               |    3    |  V   |

---

## C2.4 Проверка содержимого и соответствия политике

Разработчики должны иметь возможность распознавать синтаксически корректные запросы, в которых содержится запрещённый контент (например, незаконные инструкции, экстремистские высказывания и защищённый авторским правом текст), и предотвращать их дальнейшее распространение.

|   #   | Описание                                                                                                                                                                                                            | Уровень | Роль |
| :---: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 2.4.1 | Проверьте, что классификатор контента (zero shot или дообученный) оценивает каждый вход по параметрам насилия, самоповреждения, ненависти, сексуального содержания и незаконных запросов с настраиваемыми порогами. |    1    |  D   |
| 2.4.2 | Проверьте, что входные данные, нарушающие политики, будут получать стандартизированные отказы или безопасные завершения, чтобы они не передавались на последующие вызовы LLM.                                       |    1    | D/V  |
| 2.4.3 | Убедитесь, что модель скрининга или набор правил переобучаются/обновляются как минимум ежеквартально с учетом недавно обнаруженных шаблонов обхода ограничений или обхода политики.                                 |    2    |  D   |
| 2.4.4 | Проверять, что скрининг соответствует политикам, специфичным для пользователя (возрастным, региональным юридическим ограничениям), с помощью правил на основе атрибутов, разрешаемых во время запроса.              |    2    |  D   |
| 2.4.5 | Убедитесь, что журналы скрининга содержат оценки уверенности классификатора и теги категорий политики для корреляции SOC и последующего воспроизведения красной командой.                                           |    3    |  V   |

---

## C2.5 Ограничение входящего трафика и предотвращение злоупотреблений

Разработчикам следует предотвращать злоупотребления, исчерпание ресурсов и автоматизированные атаки на системы ИИ путем ограничения скорости ввода и выявления аномальных моделей использования.

|   #   | Описание                                                                                                                                                                    | Уровень | Роль |
| :---: | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 2.5.1 | Проверьте, что ограничения скорости по пользователю, по IP и по ключу API применяются для всех входных эндпоинтов.                                                          |    1    | D/V  |
| 2.5.2 | Убедитесь, что предельные значения для пиковой и постоянной скорости настроены таким образом, чтобы предотвращать DoS- и переборные атаки.                                  |    2    | D/V  |
| 2.5.3 | Проверьте, что аномальные шаблоны использования (например, быстрые последовательные запросы, перегрузка входными данными) вызывают автоматические блокировки или эскалации. |    2    | D/V  |
| 2.5.4 | Проверьте, что журналы предотвращения злоупотреблений сохраняются и просматриваются для выявления новых схем атак.                                                          |    3    |  V   |

---

## C2.6 Мультимодальная проверка входных данных

Системы ИИ должны включать надежную валидацию нетекстовых входных данных (изображений, аудио, файлов) для предотвращения инъекций, обхода или злоупотребления ресурсами.

|   #   | Описание                                                                                                                               | Уровень | Роль |
| :---: | -------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 2.6.1 | Убедитесь, что все нетекстовые входные данные (изображения, аудио, файлы) проверяются на тип, размер и формат перед обработкой.        |    1    |  D   |
| 2.6.2 | Убедитесь, что файлы проверяются на наличие вредоносного ПО и стеганографических нагрузок перед загрузкой.                             |    2    | D/V  |
| 2.6.3 | Проверьте, что изображение/аудиовходы проверяются на наличие враждебных возмущений или известных шаблонов атак.                        |    2    | D/V  |
| 2.6.4 | Убедитесь, что ошибки проверки входных данных мультимодального типа регистрируются и вызывают оповещения для проведения расследования. |    3    |  V   |

---

## C2.7 Происхождение входных данных и атрибуция

Системы искусственного интеллекта должны поддерживать аудит, отслеживание злоупотреблений и соблюдение требований путем мониторинга и маркировки источников всех пользовательских входных данных.

|   #   | Описание                                                                                                                                         | Уровень | Роль |
| :---: | ------------------------------------------------------------------------------------------------------------------------------------------------ | :-----: | :--: |
| 2.7.1 | Проверьте, что все пользовательские вводы помечены метаданными (ID пользователя, сессия, источник, временная метка, IP-адрес) при приеме данных. |    1    | D/V  |
| 2.7.2 | Проверьте, что метаданные происхождения сохраняются и являются проверяемыми для всех обработанных входных данных.                                |    2    | D/V  |
| 2.7.3 | Проверьте, что аномальные или ненадежные источники входных данных отмечены и подвергаются усиленному контролю или блокировке.                    |    2    | D/V  |

---

## C2.8 Адаптивное обнаружение угроз в реальном времени

Разработчики должны использовать передовые системы обнаружения угроз для ИИ, которые адаптируются к новым моделям атак и обеспечивают защиту в реальном времени с помощью скомпилированного сопоставления шаблонов.

|   #   | Описание                                                                                                                                                                                               | Уровень | Роль |
| :---: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :-----: | :--: |
| 2.8.1 | Убедитесь, что шаблоны обнаружения угроз скомпилированы в оптимизированные движки регулярных выражений для высокопроизводительной фильтрации в реальном времени с минимальным влиянием на задержку.    |    1    | D/V  |
| 2.8.2 | Проверьте, что системы обнаружения угроз поддерживают отдельные библиотеки шаблонов для разных категорий угроз (внедрение подсказок, вредоносный контент, конфиденциальные данные, системные команды). |    1    | D/V  |
| 2.8.3 | Убедитесь, что адаптивное обнаружение угроз включает модели машинного обучения, которые обновляют чувствительность к угрозам на основе частоты атак и уровней их успешности.                           |    2    | D/V  |
| 2.8.4 | Проверьте, что в режиме реального времени ленты информации об угрозах автоматически обновляют библиотеки шаблонов новыми сигнатурами атак и IOC (Indicators of Compromise – индикаторы компрометации). |    2    | D/V  |
| 2.8.5 | Убедитесь, что показатели ложных срабатываний обнаружения угроз постоянно контролируются, а специфичность шаблонов автоматически настраивается для минимизации помех законным сценариям использования. |    3    | D/V  |
| 2.8.6 | Проверьте, что контекстный анализ угроз учитывает источник ввода, модели поведения пользователя и историю сессии для повышения точности обнаружения.                                                   |    3    | D/V  |
| 2.8.7 | Проверьте, что метрики производительности обнаружения угроз (уровень обнаружения, задержка обработки, использование ресурсов) контролируются и оптимизируются в реальном времени.                      |    3    | D/V  |

---

## C2.9 Многофункциональный конвейер проверки безопасности

Разработчики должны обеспечивать проверку безопасности для текстовых, графических, аудио и других входных модальностей ИИ с использованием конкретных типов обнаружения угроз и изоляции ресурсов.

|   #   | Описание                                                                                                                                                                                                                                                                                            | Уровень | Роль |
| :---: | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 2.9.1 | Убедитесь, что для каждого входного режима существуют выделенные средства проверки безопасности с документированными шаблонами угроз (текст: инъекция подсказок, изображения: стеганография, аудио: атаки на спектрограмму) и пороговыми значениями обнаружения.                                    |    1    | D/V  |
| 2.9.2 | Убедитесь, что мультимодальные входные данные обрабатываются в изолированных песочницах с заданными ограничениями ресурсов (память, ЦП, время обработки), специфичными для каждого типа модальности и задокументированными в политиках безопасности.                                                |    2    | D/V  |
| 2.9.3 | Проверьте, что обнаружение атак сквозь модальности выявляет скоординированные атаки, охватывающие несколько типов входных данных (например, стеганографические полезные нагрузки в изображениях, комбинированные с внедрением запросов в текст) с помощью правил корреляции и генерации оповещений. |    2    | D/V  |
| 2.9.4 | Проверьте, что сбои мультимодальной валидации вызывают подробное ведение логов, включая все входные модальности, результаты валидации, оценки угроз и корреляционный анализ с использованием структурированных форматов логов для интеграции с SIEM.                                                |    3    | D/V  |
| 2.9.5 | Убедитесь, что классификаторы контента, специфичные для каждой модальности, обновляются в соответствии с задокументированными графиками (минимум раз в квартал) новыми угрозами, примерами атак и эталонными показателями производительности, поддерживаемыми выше пороговых значений.              |    3    | D/V  |

---

## Ссылки

* [LLM01:2025 Prompt Injection – OWASP Top 10 for LLM & Generative AI Security](https://genai.owasp.org/llmrisk/llm01-prompt-injection/)
* [Generative AI's Biggest Security Flaw Is Not Easy to Fix](https://www.wired.com/story/generative-ai-prompt-injection-hacking)
* [Many-shot jailbreaking \ Anthropic](https://www.anthropic.com/research/many-shot-jailbreaking)
* [$PDF$ OpenAI GPT-4.5 System Card](https://cdn.openai.com/gpt-4-5-system-card-2272025.pdf)
* [Notebook for the CheckThat Lab at CLEF 2024](https://ceur-ws.org/Vol-3740/paper-53.pdf)
* [Mitigate jailbreaks and prompt injections – Anthropic](https://docs.anthropic.com/en/docs/test-and-evaluate/strengthen-guardrails/mitigate-jailbreaks)
* [Chapter 3 MITRE ATT\&CK – Adversarial Model Analysis](https://ama.drwhy.ai/mitre-attck.html)
* [OWASP Top 10 for LLM Applications 2025 – WorldTech IT](https://wtit.com/blog/2025/04/17/owasp-top-10-for-llm-applications-2025/)
* [OWASP Machine Learning Security Top Ten](https://owasp.org/www-project-machine-learning-security-top-10/)
* [Few words about AI Security – Jussi Metso](https://www.jussimetso.com/index.php/2024/09/28/few-words-about-ai-security/)
* [How To Ensure LLM Output Adheres to a JSON Schema | Modelmetry](https://modelmetry.com/blog/how-to-ensure-llm-output-adheres-to-a-json-schema)
* [Easily enforcing valid JSON schema following – API](https://community.openai.com/t/feature-request-function-calling-easily-enforcing-valid-json-schema-following/263515?utm_source)
* [AI Safety + Cybersecurity R\&D Tracker – Fairly AI](https://www.fairly.ai/blog/ai-cybersecurity-tracker)
* [Anthropic makes 'jailbreak' advance to stop AI models producing harmful results](https://www.ft.com/content/cf11ebd8-aa0b-4ed4-945b-a5d4401d186e)
* [Pattern matching filter rules - IBM](https://www.ibm.com/docs/ssw_aix_71/security/intrusion_pattern_matching_filter_rules.html)
* [Real-time Threat Detection](https://www.darktrace.com/cyber-ai-glossary/real-time-threat-detection)

