# Безопасность памяти C8, эмбеддингов и векторных баз данных

## Цель контроля

Эмбеддинги и векторные хранилища выступают в роли «живой памяти» современных ИИ-систем, постоянно принимая данные, предоставляемые пользователями, и возвращая их в контекст модели через Retrieval-Augmented Generation (RAG). Если эта память не управляется должным образом, она может утекать PII, нарушать согласие или быть использована для восстановления исходного текста. Цель этого семейства контролей — укрепить каналы памяти и векторные базы данных так, чтобы доступ был минимально необходимым, эмбеддинги обеспечивали конфиденциальность, хранящиеся векторы имели срок действия или могли быть отозваны по запросу, а память каждого пользователя не загрязняла подсказки или результаты другого пользователя.

---

## C8.1 Контроль доступа к памяти и индексам RAG

Применяйте детализированные меры контроля доступа к каждой коллекции векторов.

|   #   | Описание                                                                                                                                                                         | Уровень | Роль |
| :---: | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 8.1.1 | Проверьте, что правила контроля доступа на уровне строк/пространств имен ограничивают операции вставки, удаления и запроса для каждого арендатора, коллекции или тега документа. |    1    | D/V  |
| 8.1.2 | Проверьте, что API-ключи или JWT содержат ограниченные права доступа (например, идентификаторы коллекций, глаголы действий) и обновляются не реже одного раза в квартал.         |    1    | D/V  |
| 8.1.3 | Убедитесь, что попытки повышения привилегий (например, запросы на сходство между пространствами имен) обнаруживаются и фиксируются в SIEM в течение 5 минут.                     |    2    | D/V  |
| 8.1.4 | Проверьте, что в журнале аудита векторной базы данных фиксируются идентификатор субъекта, операция, ID/пространство имен вектора, порог схожести и количество результатов.       |    2    | D/V  |
| 8.1.5 | Проверьте, что решения об доступе тестируются на наличие уязвимостей обхода всякий раз, когда обновляются движки или изменяются правила шардирования индексов.                   |    3    |  V   |

---

## C8.2 Обработка и проверка встраиваемых данных

Предварительно проверяйте текст на наличие персональных данных (PII), редактируйте или псевдонимизируйте их перед векторизацией, а также при необходимости выполняйте постобработку эмбеддингов для удаления оставшихся сигналов.

|   #   | Описание                                                                                                                                                                                                                              | Уровень | Роль |
| :---: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 8.2.1 | Проверьте, что персональные данные (PII) и регулируемые данные обнаруживаются с помощью автоматизированных классификаторов и маскируются, токенизируются или удаляются до этапа встраивания.                                          |    1    | D/V  |
| 8.2.2 | Проверьте, что конвейеры встраивания отклоняют или помещают в карантин входные данные, содержащие выполняемый код или артефакты не в формате UTF-8, которые могут заражать индекс.                                                    |    1    |  D   |
| 8.2.3 | Проверьте, что к векторным представлениям предложений, расстояние которых до любого известного токена с личной информацией (PII) ниже настраиваемого порога, применяется локальная или метрическая дифференциально-приватная санация. |    2    | D/V  |
| 8.2.4 | Проверяйте эффективность очистки (например, полноту удаления персональных данных, семантическое отклонение) не реже одного раза в полгода с помощью эталонных корпусов.                                                               |    2    |  V   |
| 8.2.5 | Проверьте, что конфигурации санации находятся под управлением версий, и изменения проходят проверку коллегами.                                                                                                                        |    3    | D/V  |

---

## C8.3 Истечение срока действия памяти, отзыв и удаление

Законы, такие как GDPR с правом на «забвение» и аналогичные, требуют своевременного удаления данных; поэтому хранилища векторов должны поддерживать время жизни (TTL), жесткое удаление и применение tomb-stoning, чтобы отозванные векторы не могли быть восстановлены или заново проиндексированы.

|   #   | Описание                                                                                                                                                                         | Уровень | Роль |
| :---: | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 8.3.1 | Проверьте, что каждая векторная и метаданные запись содержит TTL или явную метку хранения, соблюдаемую автоматическими задачами очистки.                                         |    1    | D/V  |
| 8.3.2 | Проверьте, что запросы на удаление, инициированные пользователем, очищают векторы, метаданные, копии кеша и производные индексы в течение 30 дней.                               |    1    | D/V  |
| 8.3.3 | Проверьте, что логическое удаление сопровождается криптографическим уничтожением блоков хранения, если оборудование это поддерживает, или уничтожением ключа в хранилище ключей. |    2    |  D   |
| 8.3.4 | Проверьте, что устаревшие векторы исключаются из результатов поиска ближайших соседей менее чем за 500 мс после истечения срока их действия.                                     |    3    | D/V  |

---

## C8.4 Предотвращение обратного преобразования и утечки внедрений

Недавние методы защиты — наложение шума, проекционные сети, возмущение нейронов конфиденциальности и шифрование на уровне приложений — могут снизить уровень инверсии на уровне токенов ниже 5%.

|   #   | Описание                                                                                                                                                                    | Уровень | Роль |
| :---: | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 8.4.1 | Убедитесь, что существует формальная модель угроз, охватывающая атаки инверсии, определения членства и вывода атрибутов, и что она пересматривается ежегодно.               |    1    |  V   |
| 8.4.2 | Проверьте, что шифрование на уровне прикладного слоя или поисковое шифрование защищает векторы от прямого чтения администраторами инфраструктуры или сотрудниками облака.   |    2    | D/V  |
| 8.4.3 | Проверьте, что параметры защиты (ε для DP, шум σ, ранг проекции k) обеспечивают баланс между конфиденциальностью ≥ 99 % защиты токенов и полезностью ≤ 3 % потери точности. |    3    |  V   |
| 8.4.4 | Проверьте, что метрики устойчивости к инверсии являются частью контрольных точек релиза для обновлений модели, с определенными бюджетами регрессии.                         |    3    | D/V  |

---

## C8.5 Применение ограничений области действия для пользовательской памяти

Перекрестные утечки между арендаторами остаются одной из главных рисков RAG: неправильно отфильтрованные запросы на поиск сходств могут выявить приватные документы другого клиента.

|   #   | Описание                                                                                                                                                                           | Уровень | Роль |
| :---: | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 8.5.1 | Проверьте, что каждый запрос на выборку данных проходит постфильтрацию по идентификатору арендатора/пользователя перед передачей в запрос к LLM.                                   |    1    | D/V  |
| 8.5.2 | Проверьте, что имена коллекций или идентификаторы с пространствами имён имеют соль для каждого пользователя или арендатора, чтобы векторы не пересекались между разными областями. |    1    |  D   |
| 8.5.3 | Подтвердите, что результаты сходства выше настраиваемого порогового расстояния, но вне области вызова, отбрасываются и вызывают предупреждения безопасности.                       |    2    | D/V  |
| 8.5.4 | Проверьте, что многопользовательские стресс-тесты моделируют враждебные запросы, пытающиеся получить документы за пределами области доступа, и демонстрируют отсутствие утечек.    |    2    |  V   |
| 8.5.5 | Проверьте, что ключи шифрования сегрегированы по каждому арендатору, обеспечивая криптографическую изоляцию даже при совместном использовании физического хранилища.               |    3    | D/V  |

---

## C8.6 Продвинутая безопасность системы памяти

Средства безопасности для сложных архитектур памяти, включая эпизодическую, семантическую и оперативную память, с конкретными требованиями к изоляции и проверке.

|   #   | Описание                                                                                                                                                                                                                                                      | Уровень | Роль |
| :---: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 8.6.1 | Проверьте, что различные типы памяти (эпизодическая, семантическая, рабочая) имеют изолированные контексты безопасности с ролевым управлением доступом, отдельными ключами шифрования и задокументированными шаблонами доступа для каждого типа памяти.       |    1    | D/V  |
| 8.6.2 | Проверьте, что процессы консолидации памяти включают проверку безопасности для предотвращения внедрения вредоносных воспоминаний посредством очистки контента, проверки источников и проверки целостности перед хранением.                                    |    2    | D/V  |
| 8.6.3 | Убедитесь, что запросы на извлечение данных из памяти проходят проверку и очистку для предотвращения извлечения несанкционированной информации посредством анализа шаблонов запросов, применения контроля доступа и фильтрации результатов.                   |    2    | D/V  |
| 8.6.4 | Проверьте, что механизмы забывания памяти безопасно удаляют конфиденциальную информацию с криптографическими гарантиями стирания, используя удаление ключей, многократное перезаписывание или аппаратное безопасное удаление с подтверждающими сертификатами. |    3    | D/V  |
| 8.6.5 | Убедитесь, что целостность системы памяти постоянно контролируется на предмет несанкционированных изменений или повреждений с помощью контрольных сумм, журналов аудита и автоматических оповещений при изменении содержимого памяти вне нормальных операций. |    3    | D/V  |

---

## Ссылки

* [Vector database security: Pinecone – IronCore Labs](https://ironcorelabs.com/vectordbs/pinecone-security/)
* [Securing the Backbone of AI: Safeguarding Vector Databases and Embeddings – Privacera](https://privacera.com/blog/securing-the-backbone-of-ai-safeguarding-vector-databases-and-embeddings/)
* [Enhancing Data Security with RBAC of Qdrant Vector Database – AI Advances](https://ai.gopubby.com/enhancing-data-security-with-role-based-access-control-of-qdrant-vector-database-3878769bec83)
* [Mitigating Privacy Risks in LLM Embeddings from Embedding Inversion – arXiv](https://arxiv.org/html/2411.05034v1)
* [DPPN: Detecting and Perturbing Privacy-Sensitive Neurons – OpenReview](https://openreview.net/forum?id=DF5TVzpTW0)
* [Art. 17 GDPR – Right to Erasure](https://gdpr-info.eu/art-17-gdpr/)
* [Sensitive Data in Text Embeddings Is Recoverable – Tonic.ai](https://www.tonic.ai/blog/sensitive-data-in-text-embeddings-is-recoverable)
* [PII Identification and Removal – NVIDIA NeMo Docs](https://docs.nvidia.com/nemo-framework/user-guide/latest/datacuration/personalidentifiableinformationidentificationandremoval.html)
* [De-identifying Sensitive Data – Google Cloud DLP](https://cloud.google.com/sensitive-data-protection/docs/deidentify-sensitive-data)
* [Remove PII from Conversations Using Sensitive Information Filters – AWS Bedrock Guardrails](https://docs.aws.amazon.com/bedrock/latest/userguide/guardrails-sensitive-filters.html)
* [Think Your RAG Is Secure? Think Again – Medium](https://medium.com/%40vijay.poudel1/think-your-rag-is-secure-think-again-heres-how-to-actually-lock-it-down-c4c30e3864e7)
* [Design a Secure Multitenant RAG Inferencing Solution – Microsoft Learn](https://learn.microsoft.com/en-us/azure/architecture/ai-ml/guide/secure-multitenant-rag)
* [Best Practices for Multi-Tenancy RAG with Milvus – Milvus Blog](https://milvus.io/blog/build-multi-tenancy-rag-with-milvus-best-practices-part-one.md)

