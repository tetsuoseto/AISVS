# C8 Memory, эмбеддинги и безопасность векторной базы данных

## Контрольная цель

Эмбеддинги и векторные хранилища выступают в роли «живой памяти» современных систем искусственного интеллекта, постоянно принимая данные, предоставляемые пользователями, и возвращая их в контекст модели через генерацию с извлечением (RAG). Если этой памяти позволят работать без надлежащего управления, она может приводить к утечке PII (личные идентифицируемые данные), нарушать согласие или быть использована для обратной реконструкции исходного текста. Цель этого семейства средств контроля — усилить устойчивость конвейеров памяти и векторных баз данных так, чтобы доступ осуществлялся по принципу минимальных привилегий, эмбеддинги обеспечивали сохранение конфиденциальности, хранимые векторы истекали по сроку хранения или могли быть отозваны по требованию, и память каждого пользователя никогда не влияла на запросы или ответы другого пользователя.

---

## C8.1 Контроль доступа к памяти и индексам RAG

Обеспечьте тонко настроенный контроль доступа для каждой коллекции векторов.

|   #   | Описание                                                                                                                                                                                       | Уровень | Роль |
| :---: | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 8.1.1 | Проверьте, что правила контроля доступа на уровне строк и на уровне пространства имён ограничивают операции вставки, удаления и запросов для каждого арендатора, коллекции или тега документа. |    1    | D/V  |
| 8.1.2 | Убедитесь, что ключи API или JWT (JSON Web Token) содержат ограниченные по области утверждения (например, идентификаторы коллекций, глаголы действий) и обновляются как минимум раз в квартал. |    1    | D/V  |
| 8.1.3 | Проверьте, что попытки повышения привилегий (например, запросы на сходство между пространствами имен) обнаруживаются и регистрируются в SIEM в течение 5 минут.                                |    2    | D/V  |
| 8.1.4 | Проверьте, что журнал аудита векторной БД регистрирует идентификатор субъекта, операцию, идентификатор вектора/пространство имён, порог сходства и количество результатов.                     |    2    | D/V  |
| 8.1.5 | Проверьте, что решения об доступе тестируются на предмет обходных уязвимостей каждый раз, когда обновляются движки или изменяются правила шардинга индексов.                                   |    3    |  V   |

---

## C8.2 Очистка и валидация эмбеддингов

Предварительно проверить текст на наличие PII (личная идентифицируемая информация), маскировать или псевдонимировать перед векторизацией, и при желании постобрабатывать эмбеддинги, чтобы удалить остаточные сигналы.

|   #   | Описание                                                                                                                                                                                                     | Уровень | Роль |
| :---: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :-----: | :--: |
| 8.2.1 | Проверьте, что PII и регулируемые данные обнаруживаются с помощью автоматизированных классификаторов и маскируются, токенизируются или исключаются до этапа формирования эмбеддингов.                        |    1    | D/V  |
| 8.2.2 | Проверьте, что пайплайны эмбеддингов отклоняют или помещают в карантин входные данные, содержащие исполняемый код или артефакты, не кодированные в UTF-8, которые могут повредить индекс.                    |    1    |  D   |
| 8.2.3 | Проверить, что к векторным представлениям предложений применяется локальная или метрическая дифференциальная приватность, если расстояние до любого известного токена PII оказывается ниже заданного порога. |    2    | D/V  |
| 8.2.4 | Убедитесь, что эффективность очистки данных (например, полнота маскирования PII, семантический дрейф) подтверждается как минимум два раза в год на эталонных корпусах.                                       |    2    |  V   |
| 8.2.5 | Убедитесь, что конфигурации очистки данных находятся под версионным контролем, и изменения проходят рецензирование коллегами.                                                                                |    3    | D/V  |

---

## C8.3 Истечение срока хранения памяти, отзыв и удаление

GDPR «право быть забытым» и аналогичные законы требуют своевременного удаления; хранилища векторов, следовательно, должны поддерживать TTL (время жизни), жесткие удаления и могильные записи, чтобы аннулированные векторы не могли быть восстановлены или повторно индексированы.

|   #   | Описание                                                                                                                                                                       | Уровень | Роль |
| :---: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :-----: | :--: |
| 8.3.1 | Убедитесь, что у каждого вектора и каждой записи метаданных есть TTL или явная метка срока хранения, которыми руководствуются автоматизированные задачи очистки.               |    1    | D/V  |
| 8.3.2 | Убедитесь, что запросы на удаление, инициируемые пользователем, удаляют векторы, метаданные, копии кэша и производные индексы в течение 30 дней.                               |    1    | D/V  |
| 8.3.3 | Убедитесь, что логическое удаление сопровождается криптографическим стиранием блоков хранения данных, если оборудование поддерживает это, или уничтожением ключей в Key Vault. |    2    |  D   |
| 8.3.4 | Проверьте, что просроченные векторы исключаются из результатов поиска ближайших соседей в течение менее чем 500 мс после истечения срока действия.                             |    3    | D/V  |

---

## C8.4 Предотвращение инвертирования эмбеддингов и утечки

Недавние защиты—наложение шума, проекционные сети, privacy-neuron perturbation и шифрование на уровне приложения—могут снизить частоту инверсий на уровне токенов ниже 5%.

|   #   | Описание                                                                                                                                                                       | Уровень | Роль |
| :---: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :-----: | :--: |
| 8.4.1 | Убедитесь, что существует формальная модель угроз, охватывающая атаки инверсии, атаки на принадлежность и атаки по выводу атрибутов, и что она пересматривается ежегодно.      |    1    |  V   |
| 8.4.2 | Проверьте, что шифрование на уровне приложения или поисковое шифрование защищает векторы от прямого чтения администраторами инфраструктуры или сотрудниками облачных сервисов. |    2    | D/V  |
| 8.4.3 | Проверьте, что параметры защиты (ε для DP, шум σ, ранг проекции k) обеспечивают баланс между защитой приватности ≥ 99 % и потерей точности ≤ 3 %.                              |    3    |  V   |
| 8.4.4 | Убедитесь, что метрики устойчивости к инверсии входят в пороги выпуска для обновлений моделей, и что заданы бюджеты регрессий.                                                 |    3    | D/V  |

---

## C8.5 Контроль области памяти, специфичной для пользователя

Утечки между арендаторами остаются одним из основных рисков RAG: некорректно отфильтрованные запросы на схожесть могут раскрыть приватные документы другого клиента.

|   #   | Описание                                                                                                                                                                                 | Уровень | Роль |
| :---: | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 8.5.1 | Убедитесь, что каждый запрос на извлечение подвергается постфильтрации по идентификатору арендатора/пользователя перед передачей в подсказку языковой модели (LLM).                      |    1    | D/V  |
| 8.5.2 | Убедитесь, что имена коллекций или идентификаторы с пространством имён используют уникальную соль для каждого пользователя или арендатора, чтобы векторы не пересекались между скоупами. |    1    |  D   |
| 8.5.3 | Убедитесь, что результаты сходства, превышающие настраиваемый порог расстояния, но выходящие за пределы области вызова, отбрасываются и инициируют оповещения о безопасности.            |    2    | D/V  |
| 8.5.4 | Проверьте, что мультитенантные стресс-тесты моделируют злоумышленнические запросы, пытающиеся получить документы за пределами области доступа, и демонстрируют нулевую утечку данных.    |    2    |  V   |
| 8.5.5 | Убедитесь, что ключи шифрования разделены по арендаторам, обеспечивая криптографическую изоляцию даже при совместном использовании физического хранения.                                 |    3    | D/V  |

---

## C8.6 Продвинутая безопасность системы памяти

Механизмы обеспечения безопасности для сложных архитектур памяти, включая эпизодическую, семантическую и рабочую память, со специфическими требованиями к изоляции и валидации.

|   #   | Описание                                                                                                                                                                                                                                                           | Уровень | Роль |
| :---: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :-----: | :--: |
| 8.6.1 | Убедитесь, что различные типы памяти (эпизодическая, семантическая, рабочая) имеют изолированные контексты безопасности с контролем доступа на основе ролей, отдельными ключами шифрования и задокументированными моделями доступа для каждого типа памяти.        |    1    | D/V  |
| 8.6.2 | Убедитесь, что процессы консолидации памяти включают проверку безопасности для предотвращения внедрения вредоносных воспоминаний через очистку содержимого, проверку источника и проверку целостности перед сохранением.                                           |    2    | D/V  |
| 8.6.3 | Проверьте, что запросы на извлечение памяти проходят валидацию и очистку, чтобы предотвратить извлечение несанкционированной информации посредством анализа шаблонов запросов, обеспечения контроля доступа и фильтрации результатов.                              |    2    | D/V  |
| 8.6.4 | Убедитесь, что механизмы стирания памяти безопасно удаляют чувствительную информацию с гарантиями криптографического стирания, используя удаление ключей, многопроходное перезаписывание или аппаратное безопасное удаление с сертификатами проверки.              |    3    | D/V  |
| 8.6.5 | Убедитесь, что целостность системы памяти постоянно контролируется на предмет несанкционированных изменений или порчи с использованием контрольных сумм, журналов аудита и автоматических оповещений при изменении содержимого памяти вне нормальной эксплуатации. |    3    | D/V  |

---

## Список литературы

* [Vector database security: Pinecone – IronCore Labs](https://ironcorelabs.com/vectordbs/pinecone-security/)
* [Securing the Backbone of AI: Safeguarding Vector Databases and Embeddings – Privacera](https://privacera.com/blog/securing-the-backbone-of-ai-safeguarding-vector-databases-and-embeddings/)
* [Enhancing Data Security with RBAC of Qdrant Vector Database – AI Advances](https://ai.gopubby.com/enhancing-data-security-with-role-based-access-control-of-qdrant-vector-database-3878769bec83)
* [Mitigating Privacy Risks in LLM Embeddings from Embedding Inversion – arXiv](https://arxiv.org/html/2411.05034v1)
* [DPPN: Detecting and Perturbing Privacy-Sensitive Neurons – OpenReview](https://openreview.net/forum?id=DF5TVzpTW0)
* [Art. 17 GDPR – Right to Erasure](https://gdpr-info.eu/art-17-gdpr/)
* [Sensitive Data in Text Embeddings Is Recoverable – Tonic.ai](https://www.tonic.ai/blog/sensitive-data-in-text-embeddings-is-recoverable)
* [PII Identification and Removal – NVIDIA NeMo Docs](https://docs.nvidia.com/nemo-framework/user-guide/latest/datacuration/personalidentifiableinformationidentificationandremoval.html)
* [De-identifying Sensitive Data – Google Cloud DLP](https://cloud.google.com/sensitive-data-protection/docs/deidentify-sensitive-data)
* [Remove PII from Conversations Using Sensitive Information Filters – AWS Bedrock Guardrails](https://docs.aws.amazon.com/bedrock/latest/userguide/guardrails-sensitive-filters.html)
* [Think Your RAG Is Secure? Think Again – Medium](https://medium.com/%40vijay.poudel1/think-your-rag-is-secure-think-again-heres-how-to-actually-lock-it-down-c4c30e3864e7)
* [Design a Secure Multitenant RAG Inferencing Solution – Microsoft Learn](https://learn.microsoft.com/en-us/azure/architecture/ai-ml/guide/secure-multitenant-rag)
* [Best Practices for Multi-Tenancy RAG with Milvus – Milvus Blog](https://milvus.io/blog/build-multi-tenancy-rag-with-milvus-best-practices-part-one.md)

