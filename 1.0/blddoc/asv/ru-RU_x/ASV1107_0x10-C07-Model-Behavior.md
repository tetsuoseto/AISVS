# C7 Поведение модели, контроль вывода и обеспечение безопасности

## Контрольная цель

Выходы модели должны быть структурированными, надёжными, безопасными, объяснимыми и непрерывно мониторируемыми в продакшене. Это снижает галлюцинации, утечки конфиденциальной информации, вредоносное содержимое и неконтролируемые действия, при этом повышая доверие пользователей и соответствие нормативным требованиям.

---

## C7.1 Обеспечение соблюдения формата вывода

Строгие схемы, ограниченное декодирование и последующая валидация останавливают некорректный или вредоносный контент до того, как он распространяется.

|   #   | Описание                                                                                                                                                                                          | Уровень | Роль |
| :---: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 7.1.1 | Проверьте, что схемы ответов (например, JSON-схема) заданы в системном промпте, и каждый вывод автоматически валидируется; несоответствующие выводы приводят к исправлению или отклонению.        |    1    | D/V  |
| 7.1.2 | Убедитесь, что ограниченное декодирование (стоп-токены, регулярные выражения, максимальное количество токенов) включено, чтобы предотвратить переполнение или побочные каналы инъекции подсказок. |    1    | D/V  |
| 7.1.3 | Убедитесь, что компоненты последующего этапа считают выходные данные ненадежными и валидируют их по схемам или с помощью десериализаторов, устойчивых к инъекциям.                                |    2    | D/V  |
| 7.1.4 | Убедитесь, что события некорректного вывода логируются, ограничиваются по скорости и поступают в систему мониторинга.                                                                             |    3    |  V   |

---

## C7.2 Обнаружение и устранение галлюцинаций

Оценка неопределенности и стратегии отката снижают вероятность выдуманных ответов.

|   #   | Описание                                                                                                                                                                                  | Уровень | Роль |
| :---: | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 7.2.1 | Проверьте, что логарифмы вероятностей на уровне токенов, самосогласованность ансамбля или дообученные детекторы галлюцинаций присваивают каждому ответу оценку уверенности.               |    1    | D/V  |
| 7.2.2 | Убедитесь, что ответы ниже настраиваемого порога доверия запускают резервные рабочие процессы (например, генерация, дополненная извлечением, вторичная модель или человеческая проверка). |    1    | D/V  |
| 7.2.3 | Убедитесь, что инциденты галлюцинаций помечаются метаданными корневой причины и подаются в конвейеры постмортема и дообучения.                                                            |    2    | D/V  |
| 7.2.4 | Убедитесь, что пороги и детекторы повторно откалиброваны после крупных обновлений модели или базы знаний.                                                                                 |    3    | D/V  |
| 7.2.5 | Убедитесь, что визуализации панели мониторинга отслеживают частоту галлюцинаций.                                                                                                          |    3    |  V   |

---

## C7.3 Фильтрация вывода безопасности & конфиденциальности

Фильтры политики и охват красной команды защищают пользователей и конфиденциальные данные.

|   #   | Описание                                                                                                                                                                                                          | Уровень | Роль |
| :---: | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 7.3.1 | Проверьте, что классификаторы до- и постгенерационные блокируют контент, связанный с ненавистью, домогательством, самоповреждением, экстремизмом и откровенно сексуальным содержанием в соответствии с политикой. |    1    | D/V  |
| 7.3.2 | Убедитесь, что обнаружение PII/PCI и автоматическое маскирование выполняются на каждом ответе; нарушения приводят к инциденту конфиденциальности.                                                                 |    1    | D/V  |
| 7.3.3 | Убедитесь, что теги конфиденциальности (например, торговые секреты) распространяются между модальностями, чтобы предотвратить утечку в тексте, изображениях или коде.                                             |    2    |  D   |
| 7.3.4 | Проверьте, что попытки обхода фильтра или классификации высокого риска требуют вторичного одобрения или повторной аутентификации пользователя.                                                                    |    3    | D/V  |
| 7.3.5 | Проверьте, что пороги фильтрации соответствуют правовым юрисдикциям и контексту возраста и роли пользователя.                                                                                                     |    3    | D/V  |

---

## C7.4 Вывод и ограничение действий

Ограничения скорости запросов и этапы утверждения предотвращают злоупотребления и чрезмерную автономность.

|   #   | Описание                                                                                                                                                                                                                      | Уровень | Роль |
| :---: | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 7.4.1 | Убедитесь, что квоты на каждого пользователя и квоты на API-ключ ограничивают количество запросов, токенов и стоимость с экспоненциальной задержкой повторных попыток при ошибках 429.                                        |    1    |  D   |
| 7.4.2 | Убедитесь, что привилегированные действия (запись файлов, выполнение кода, сетевые вызовы) требуют одобрения на основе политики или участия человека в процессе принятия решений.                                             |    1    | D/V  |
| 7.4.3 | Проверьте, что проверки кросс-модальной согласованности обеспечивают, что изображения, код и текст, сгенерированные для одного и того же запроса, не могут использоваться для скрытого распространения вредоносного контента. |    2    | D/V  |
| 7.4.4 | Убедитесь, что глубина делегирования агенту, пределы рекурсии и списки разрешённых инструментов явно сконфигурированы.                                                                                                        |    2    |  D   |
| 7.4.5 | Убедитесь, что нарушение лимитов генерирует структурированные события безопасности для загрузки в SIEM.                                                                                                                       |    3    |  V   |

---

## C7.5 Объяснимость вывода

Прозрачные сигналы повышают доверие пользователей и облегчают внутреннюю отладку.

|   #   | Описание                                                                                                                                             | Уровень | Роль |
| :---: | ---------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 7.5.1 | Убедитесь, что коэффициенты уверенности, видимые пользователю, или краткие резюме рассуждений отображаются, когда оценка риска считает это уместным. |    2    | D/V  |
| 7.5.2 | Убедитесь, что сгенерированные объяснения не раскрывают чувствительные системные подсказки или конфиденциальные данные.                              |    2    | D/V  |
| 7.5.3 | Проверьте, что система фиксирует логарифмические вероятности на уровне токенов или карты внимания и сохраняет их для авторизованной проверки.        |    3    |  D   |
| 7.5.4 | Проверьте, что артефакты объяснимости находятся под контролем версий наряду с релизами моделей для обеспечения аудита.                               |    3    |  V   |

---

## C7.6 Мониторинг интеграции

Наблюдаемость в реальном времени замыкает цикл между разработкой и эксплуатацией.

|   #   | Описание                                                                                                                                                      | Уровень | Роль |
| :---: | ------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 7.6.1 | Проверьте, что метрики (нарушения схемы, уровень галлюцинаций, токсичность, утечки PII, задержка, стоимость) передаются на центральную платформу мониторинга. |    1    |  D   |
| 7.6.2 | Убедитесь, что пороги оповещений определены для каждой метрики безопасности, с процедурами эскалации для дежурного персонала.                                 |    1    |  V   |
| 7.6.3 | Проверьте, что дашборды устанавливают связь между выходными аномалиями и моделью/версией, флагом функциональности и изменениями данных на стороне источника.  |    2    |  V   |
| 7.6.4 | Убедитесь, что данные мониторинга возвращаются к повторному обучению, тонкой настройке или обновлениям правил в рамках документированного процесса MLOps.     |    2    | D/V  |
| 7.6.5 | Проверьте, что конвейеры мониторинга проходят пентестирование и обеспечивают контроль доступа, чтобы предотвратить утечку чувствительных логов.               |    3    |  V   |

---

## 7.7 Меры защиты генеративных медиа

Убедитесь, что системы ИИ не генерируют незаконный, вредный или несанкционированный медиа-контент, обеспечивая соблюдение ограничений политики, проверку выходных данных и обеспечение прослеживаемости.

|   #   | Описание                                                                                                                                                                                                               | Уровень | Роль |
| :---: | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 7.7.1 | Проверьте, что системные подсказки и инструкции пользователя явно запрещают генерацию незаконных, вредоносных или несанкционированных материалов глубоких подделок (например, изображений, видео, аудио).              |    1    | D/V  |
| 7.7.2 | Убедитесь, что запросы фильтруются на предмет попыток подмены личности, сексуально откровенных дипфейков или материалов, изображающих реальных людей без их согласия.                                                  |    2    | D/V  |
| 7.7.3 | Проверьте, что система использует перцептивное хеширование, обнаружение водяных знаков или фингерпринтинг для предотвращения несанкционированного воспроизведения материалов, охраняемых авторским правом.             |    2    |  V   |
| 7.7.4 | Убедитесь, что все сгенерированные медиафайлы криптографически подписаны, помечены водяными знаками или встроены с защитой от подделки метаданными происхождения для дальнейшей прослеживаемости.                      |    3    | D/V  |
| 7.7.5 | Убедитесь, что попытки обхода (например, обфускация запросов, сленг, агрессивная формулировка) обнаруживаются, регистрируются и ограничиваются по частоте; повторное злоупотребление передается в системы мониторинга. |    3    |  V   |

## Список литературы

* [NIST AI Risk Management Framework](https://www.nist.gov/itl/ai-risk-management-framework)
* [ISO/IEC 42001:2023 – AI Management System](https://www.iso.org/obp/ui/en/)
* [OWASP Top-10 for Large Language Model Applications (2025)](https://owasp.org/www-project-top-10-for-large-language-model-applications/)
* [Improper Output Handling – OWASP LLM05:2025](https://genai.owasp.org/llmrisk/llm052025-improper-output-handling/)
* [Practical Techniques to Constrain LLM Output](https://mychen76.medium.com/practical-techniques-to-constraint-llm-output-in-json-format-e3e72396c670)
* [Dataiku – Structured Text Generation Guide](https://blog.dataiku.com/your-guide-to-structured-text-generation)
* [VL-Uncertainty: Detecting Hallucinations](https://arxiv.org/abs/2411.11919)
* [HaDeMiF: Hallucination Detection & Mitigation](https://openreview.net/forum?id=VwOYxPScxB)
* [Building Confidence in LLM Outputs](https://www.alkymi.io/data-science-room/building-confidence-in-llm-outputs)
* [Explainable AI & LLMs](https://duncsand.medium.com/explainable-ai-140912d31b3b)
* [LLM Red-Teaming Guide](https://www.confident-ai.com/blog/red-teaming-llms-a-step-by-step-guide)
* [Sensitive Information Disclosure in LLMs](https://virtualcyberlabs.com/llm-sensitive-information-disclosure/)
* [LangChain – Chat Model Rate Limiting](https://python.langchain.com/docs/how_to/chat_model_rate_limiting/)
* [OpenAI Rate-Limit & Exponential Back-off](https://hackernoon.com/openais-rate-limit-a-guide-to-exponential-backoff-for-llm-evaluation)
* [Arize AI – LLM Observability Platform](https://arize.com/)

