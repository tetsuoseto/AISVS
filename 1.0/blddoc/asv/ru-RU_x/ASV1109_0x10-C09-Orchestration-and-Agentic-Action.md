# 9 Автономная оркестрация и безопасность агентных действий

## Контрольная цель

Обеспечьте, чтобы автономные или многоагентные системы ИИ могли выполнять только те действия, которые явно заданы, аутентифицированы, подлежат аудиту и находятся в пределах ограниченных порогов затрат и риска. Это защищает от угроз, таких как компрометация автономной системы, злоупотребление инструментами, обнаружение петли агента, перехват управления коммуникациями, подмена идентичности, манипулирование роем и манипулирование намерениями.

---

## 9.1 Планирование задач агента и бюджеты рекурсии

Замедляйте рекурсивные планы и устанавливайте человеческие контрольные точки для действий с повышенными привилегиями.

|   #   | Описание                                                                                                                                                                                                         | Уровень | Роль |
| :---: | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 9.1.1 | Убедитесь, что максимальная глубина рекурсии, ширина поиска, реальное время выполнения, токены и денежная стоимость за выполнение агентом централизованно сконфигурированы и находятся под версионным контролем. |    1    | D/V  |
| 9.1.2 | Убедитесь, что привилегированные или необратимые действия (например, коммиты кода, финансовые переводы) требуют явного человеческого одобрения через аудируемый канал до выполнения.                             |    1    | D/V  |
| 9.1.3 | Проверьте, что мониторы ресурсов в реальном времени вызывают прерывание circuit-breaker, когда превышается любой порог бюджета, и тем самым останавливают дальнейшее масштабирование задач.                      |    2    |  D   |
| 9.1.4 | Убедитесь, что события circuit-breaker регистрируются с идентификатором агента, условием срабатывания и зафиксированным состоянием плана для судебной экспертизы.                                                |    2    | D/V  |
| 9.1.5 | Убедитесь, что тесты безопасности охватывают сценарии истощения бюджета и неуправляемого выполнения плана, подтверждая безопасную остановку без потери данных.                                                   |    3    |  V   |
| 9.1.6 | Проверьте, что политики бюджета заданы как политика в виде кода и применяются в CI/CD, чтобы предотвратить дрейф конфигурации.                                                                                   |    3    |  D   |

---

## 9.2 Песочничение плагинов инструментов

Изолируйте взаимодействия с инструментами, чтобы предотвратить несанкционированный доступ к системе или выполнение кода.

|   #   | Описание                                                                                                                                                                                    | Уровень | Роль |
| :---: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 9.2.1 | Убедитесь, что каждый инструмент или плагин выполняется внутри песочницы уровня OS, контейнера или WASM с политиками минимальных привилегий для файловой системы, сети и системных вызовов. |    1    | D/V  |
| 9.2.2 | Убедитесь, что квоты ресурсов песочницы (CPU, память, диск, исходящий сетевой трафик) и тайм-ауты выполнения применяются и регистрируются.                                                  |    1    | D/V  |
| 9.2.3 | Проверьте, что двоичные файлы инструментов или дескрипторы подписаны цифровой подписью; подписи проверяются перед загрузкой.                                                                |    2    | D/V  |
| 9.2.4 | Проверьте, что телеметрия песочницы поступает в SIEM; аномалии (например, попытки исходящих соединений) генерируют оповещения.                                                              |    2    |  V   |
| 9.2.5 | Убедитесь, что плагины высокого риска проходят обзор безопасности и тестирование на проникновение перед развертыванием в продакшн.                                                          |    3    |  V   |
| 9.2.6 | Убедитесь, что попытки обхода песочницы автоматически блокируются, а плагин, нарушающий требования безопасности, помещается в карантин до завершения расследования.                         |    3    | D/V  |

---

## 9.3 Автономный цикл и ограничение затрат

Обнаруживайте и прекращайте неконтролируемую межагентную рекурсию и резкий рост затрат.

|   #   | Описание                                                                                                                                                         | Уровень | Роль |
| :---: | ---------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 9.3.1 | Проверьте, что межагентные вызовы включают ограничение на число переходов (hop-limit) или TTL, которое среда выполнения уменьшает и обеспечивает его соблюдение. |    1    | D/V  |
| 9.3.2 | Проверьте, что агенты поддерживают уникальный идентификатор графа вызовов, чтобы обнаруживать самовызовы или циклические закономерности.                         |    2    |  D   |
| 9.3.3 | Убедитесь, что совокупные счетчики единиц вычисления и расходов отслеживаются для каждой цепочки запросов; превышение лимита приводит к прерыванию цепочки.      |    2    | D/V  |
| 9.3.4 | Убедитесь, что формальный анализ или проверка моделей демонстрируют отсутствие бесконечной рекурсии в агентских протоколах.                                      |    3    |  V   |
| 9.3.5 | Проверьте, что loop-abort events генерируют оповещения и обеспечивают данные для метрик непрерывного улучшения.                                                  |    3    |  D   |

---

## 9.4 Защита от злоупотребления на уровне протокола

Обеспечьте безопасные каналы связи между агентами и внешними системами, чтобы предотвратить перехват или манипуляцию.

|   #   | Описание                                                                                                                                                                                   | Уровень | Роль |
| :---: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :-----: | :--: |
| 9.4.1 | Убедитесь, что все сообщения между агентом и инструментом, а также между агентами, проходят аутентификацию (например, взаимная TLS или JWT) и имеют сквозное шифрование от конца до конца. |    1    | D/V  |
| 9.4.2 | Убедитесь, что схемы проходят строгую валидацию; неизвестные поля или некорректно сформированные сообщения отклоняются.                                                                    |    1    |  D   |
| 9.4.3 | Убедитесь, что проверки целостности (MAC-ы или цифровые подписи) охватывают всю полезную нагрузку сообщения, включая параметры инструмента.                                                |    2    | D/V  |
| 9.4.4 | Проверьте, что защита от повторной передачи (одноразовые значения или окна временных меток) обеспечивается на уровне протокола.                                                            |    2    |  D   |
| 9.4.5 | Убедитесь, что реализации протоколов проходят фаззинг и статический анализ на наличие ошибок инъекции или десериализации.                                                                  |    3    |  V   |

---

## 9.5 Идентификация агента и обнаружение вмешательства

Убедитесь, что действия атрибутируемы и изменения обнаружимы.

|   #   | Описание                                                                                                                                                      | Уровень | Роль |
| :---: | ------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 9.5.1 | Убедитесь, что у каждого экземпляра агента имеется уникальная криптографическая идентичность (пара ключей или аппаратно-укоренённое удостоверение).           |    1    | D/V  |
| 9.5.2 | Проверьте, что все действия агентов подписаны и имеют отметку времени; журналы содержат подпись для обеспечения неотказуемости.                               |    2    | D/V  |
| 9.5.3 | Проверьте, что журналы, устойчивые к подмене, хранятся на носителе, поддерживающем режим только добавления (append-only) или однократной записи (write-once). |    2    |  V   |
| 9.5.4 | Проверьте, что ключи идентификации проходят ротацию по заданному графику и при наличии индикаторов компрометации.                                             |    3    |  D   |
| 9.5.5 | Убедитесь, что попытки спуфинга или конфликта ключей приводят к немедленному карантину затронутого агента.                                                    |    3    | D/V  |

---

## 9.6 Снижение рисков в мультиагентных роевых системах

Снижайте риски коллективного поведения посредством изоляции и формального моделирования безопасности.

|   #   | Описание                                                                                                                                                                  | Уровень | Роль |
| :---: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 9.6.1 | Проверьте, что агенты, работающие в разных доменах безопасности, выполняются в изолированных песочницах рантайма или в сетевых сегментах.                                 |    1    | D/V  |
| 9.6.2 | Убедитесь, что поведение роя смоделировано и формально проверено на свойства живости и безопасности до развертывания.                                                     |    3    |  V   |
| 9.6.3 | Убедитесь, что мониторы времени выполнения обнаруживают возникающие небезопасные закономерности (например, колебания, взаимоблокировки) и инициируют корректирующие меры. |    3    |  D   |

---

## 9.7 Аутентификация пользователя и инструмента / Авторизация

Внедрите надежные механизмы контроля доступа для каждого действия, инициируемого агентом.

|   #   | Описание                                                                                                                                                             | Уровень | Роль |
| :---: | -------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 9.7.1 | Убедитесь, что агенты аутентифицируются как принципы первого класса в downstream‑системах, и никогда не повторно используют учетные данные конечного пользователя.   |    1    | D/V  |
| 9.7.2 | Проверьте, что детализированные политики авторизации ограничивают набор инструментов, которые агент может вызывать, и набор параметров, которые он может передавать. |    2    |  D   |
| 9.7.3 | Проверьте, что проверки привилегий повторно оцениваются при каждом вызове (непрерывная авторизация), а не только при старте сессии.                                  |    2    |  V   |
| 9.7.4 | Проверьте, что делегированные привилегии истекают автоматически и требуют повторного согласия после истечения срока действия или изменения области действия.         |    3    |  D   |

---

## 9.8 Безопасность межагентной коммуникации

Зашифруйте и обеспечьте целостность всех межагентских сообщений, чтобы предотвратить перехват и подмену.

|   #   | Описание                                                                                                                                                               | Уровень | Роль |
| :---: | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 9.8.1 | Убедитесь, что двусторонняя аутентификация и шифрование с использованием Perfect Forward Secrecy (PFS) (например, TLS 1.3) являются обязательными для каналов агентов. |    1    | D/V  |
| 9.8.2 | Убедитесь, что целостность сообщения и его источник проверяются до обработки; в случае неудачи генерируются оповещения и сообщение отбрасывается.                      |    1    |  D   |
| 9.8.3 | Убедитесь, что метаданные коммуникации (метки времени, номера последовательности) регистрируются в журналах для поддержки судебно-криминалистической реконструкции.    |    2    | D/V  |
| 9.8.4 | Убедитесь, что формальная верификация или проверка моделей подтверждают, что автоматы состояний протокола не могут перейти в небезопасные состояния.                   |    3    |  V   |

---

## 9.9 Проверка намерений и обеспечение соблюдения ограничений

Проверьте, что действия агента соответствуют заявленному пользователем намерению и ограничениям системы.

|   #   | Описание                                                                                                                                                                                      | Уровень | Роль |
| :---: | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 9.9.1 | Убедитесь, что перед выполнением решатели ограничений проверяют предлагаемые действия на соответствие жестко закодированным правилам безопасности и политики.                                 |    1    |  D   |
| 9.9.2 | Убедитесь, что действия с высоким воздействием (финансовые, разрушительные, затрагивающие конфиденциальность) требуют явного подтверждения намерения от инициирующего пользователя.           |    2    | D/V  |
| 9.9.3 | Проверьте, что проверки постусловий подтверждают, что выполненные действия достигли ожидаемых эффектов без побочных эффектов; расхождения приводят к откату.                                  |    2    |  V   |
| 9.9.4 | Проверьте, что формальные методы (например, проверка моделей, доказательство теорем) или тесты на основе свойств демонстрируют, что планы агентов удовлетворяют всем заявленным ограничениям. |    3    |  V   |
| 9.9.5 | Убедитесь, что инциденты несоответствия намерений или нарушения ограничений питают циклы непрерывного улучшения и обмен разведданными об угрозах.                                             |    3    |  D   |

---

## 9.10 Безопасность стратегии рассуждений агента

Обеспечение безопасного выбора и выполнения различных стратегий рассуждения, включая ReAct, Chain-of-Thought и Tree-of-Thoughts подходы.

|   #    | Описание                                                                                                                                                                                                                                                                  | Уровень | Роль |
| :----: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 9.10.1 | Проверьте, что выбор стратегии рассуждения основан на детерминированных критериях (сложность входных данных, тип задачи, контекст безопасности) и что идентичные входные данные приводят к идентичным выборам стратегий в рамках одного и того же контекста безопасности. |    1    | D/V  |
| 9.10.2 | Проверьте, что каждая стратегия рассуждения (ReAct, Chain-of-Thought, Tree-of-Thoughts) имеет специализированную валидацию входных данных, очистку выходных данных и ограничения по времени выполнения, специфичные для её когнитивного подхода.                          |    1    | D/V  |
| 9.10.3 | Убедитесь, что переходы между стратегиями рассуждений логируются с полным контекстом, включая характеристики входных данных, значения критериев отбора и метаданные выполнения для восстановления аудиторского следа.                                                     |    2    | D/V  |
| 9.10.4 | Убедитесь, что рассуждения по методу дерева мыслей включают механизмы обрезки ветвей, которые прекращают исследование, когда обнаруживаются нарушения политики, ограничения ресурсов или границы безопасности.                                                            |    2    | D/V  |
| 9.10.5 | Проверьте, что циклы ReAct (Reason-Act-Observe) включают контрольные точки в каждой фазе: проверку шага рассуждения, авторизацию действий и очистку наблюдений перед продолжением.                                                                                        |    2    | D/V  |
| 9.10.6 | Проверьте, что показатели производительности стратегии рассуждений (время выполнения, использование ресурсов, качество вывода) отслеживаются с автоматическими оповещениями, когда показатели выходят за заданные пороги.                                                 |    3    | D/V  |
| 9.10.7 | Убедитесь, что гибридные подходы к рассуждению, объединяющие несколько стратегий, обеспечивают валидацию входных данных и ограничения вывода всех составных стратегий, не обходя какие-либо меры безопасности.                                                            |    3    | D/V  |
| 9.10.8 | Убедитесь, что тестирование безопасности стратегий рассуждения включает фаззинг с некорректными входными данными, адверсариальные подсказки, разработанные для принуждения переключения стратегий, и тестирование предельных условий для каждого когнитивного подхода.    |    3    | D/V  |

---

## 9.11 Управление состоянием жизненного цикла агента и обеспечение безопасности

Инициализация безопасного агента, переходы состояний и завершение с криптографическими журналами аудита и определёнными процедурами восстановления.

|   #    | Описание                                                                                                                                                                                                                                                                                                 | Уровень | Роль |
| :----: | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 9.11.1 | Проверьте, что инициализация агента включает установление криптографической идентичности с аппаратно защищёнными учётными данными и неизменяемые журналы аудита запуска, содержащие идентификатор агента, временную метку, хэш конфигурации и параметры инициализации.                                   |    1    | D/V  |
| 9.11.2 | Проверьте, что переходы состояния агента криптографически подписаны, помечены временной меткой и зафиксированы с полным контекстом, включая инициирующие события, хэш предыдущего состояния, хэш нового состояния и проведенные проверки безопасности.                                                   |    2    | D/V  |
| 9.11.3 | Проверьте, что процедуры завершения работы агента включают безопасное стирание памяти с использованием криптографического стирания или многоразового перезаписывания, отзыв учетных данных с уведомлением центра сертификации и генерацию сертификатов завершения, защищённых от подделок.               |    2    | D/V  |
| 9.11.4 | Убедитесь, что механизмы восстановления агента проверяют целостность состояния с использованием криптографических контрольных сумм (минимум SHA-256) и выполняют откат к известным рабочим состояниям при обнаружении повреждений с автоматическими оповещениями и требованиями к ручному подтверждению. |    3    | D/V  |
| 9.11.5 | Проверьте, что механизмы сохранения состояния агента шифруют чувствительные данные состояния с использованием ключей AES-256, уникальных для каждого агента, и реализуют безопасную ротацию ключей по настраиваемым расписаниям (максимум 90 дней) с развертыванием без простоев.                        |    3    | D/V  |

---

## 9.12 Фреймворк безопасности интеграции инструментов

Контроль безопасности для динамической загрузки инструментов, их исполнение и проверка результатов с установленными процессами оценки риска и утверждения.

|   #    | Описание                                                                                                                                                                                                                                                                                          | Уровень | Роль |
| :----: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----: | :--: |
| 9.12.1 | Проверьте, что описания инструментов содержат метаданные безопасности, указывающие необходимые привилегии (чтение/запись/исполнение), уровни риска (низкий/средний/высокий), ограничения ресурсов (ЦПУ, память, сеть) и требования к валидации, задокументированные в манифестах инструментов.    |    1    | D/V  |
| 9.12.2 | Проверьте, что результаты выполнения инструментов проходят валидацию в соответствии с ожидаемыми схемами (JSON-схема, XML-схема) и политиками безопасности (очистка вывода, классификация данных) перед интеграцией с ограничениями по времени выполнения и процедурами обработки ошибок.         |    1    | D/V  |
| 9.12.3 | Убедитесь, что журналы взаимодействия инструментов содержат подробный контекст безопасности, включая использование привилегий, паттерны доступа к данным, время выполнения, потребление ресурсов и коды возврата, с использованием структурированного логирования для интеграции с SIEM.          |    2    | D/V  |
| 9.12.4 | Убедитесь, что механизмы динамической загрузки инструментов проверяют цифровые подписи с использованием инфраструктуры PKI и реализуют безопасные протоколы загрузки с изоляцией в песочнице и проверкой разрешений перед выполнением.                                                            |    2    | D/V  |
| 9.12.5 | Убедитесь, что оценки безопасности инструментов автоматически запускаются для новых версий с обязательными этапами утверждения, включающими статический анализ, динамическое тестирование и рассмотрение командой безопасности, с задокументированными критериями утверждения и требованиями SLA. |    3    | D/V  |

---

### Список литературы

* [MITRE ATLAS tactics ML09](https://atlas.mitre.org/)
* [Circuit-breaker research for AI agents — Zou et al., 2024](https://arxiv.org/abs/2406.04313)
* [Trend Micro analysis of sandbox escapes in AI agents — Park, 2025](https://www.trendmicro.com/vinfo/us/security/news/cybercrime-and-digital-threats/unveiling-ai-agent-vulnerabilities-code-execution)
* [Auth0 guidance on human-in-the-loop authorization for agents — Martinez, 2025](https://auth0.com/blog/secure-human-in-the-loop-interactions-for-ai-agents/)
* [Medium deep-dive on MCP & A2A protocol hijacking — ForAISec, 2025](https://medium.com/%40foraisec/security-analysis-potential-ai-agent-hijacking-via-mcp-and-a2a-protocol-insights-cd1ec5e6045f)
* [Rapid7 fundamentals on spoofing attack prevention — 2024](https://www.rapid7.com/fundamentals/spoofing-attacks/)
* [Imperial College verification of swarm systems — Lomuscio et al.](https://sail.doc.ic.ac.uk/projects/swarms/)
* [NIST AI Risk Management Framework 1.0, 2023](https://nvlpubs.nist.gov/nistpubs/ai/nist.ai.100-1.pdf)
* [WIRED security briefing on encryption best practices, 2024](https://www.wired.com/story/encryption-apps-chinese-telecom-hacking-hydra-russia-exxon)
* [OWASP Top 10 for LLM Applications, 2025](https://owasp.org/www-project-top-10-for-large-language-model-applications/)
* [Comprehensive Vulnerability Analysis is Necessary for Trustworthy LLM-MAS](https://arxiv.org/html/2506.01245v1)
* [How Is LLM Reasoning Distracted by Irrelevant Context?
  An Analysis Using a Controlled Benchmark](https://www.arxiv.org/pdf/2505.18761)
* [Large Language Model Sentinel: LLM Agent for Adversarial Purification](https://arxiv.org/pdf/2405.20770)
* [Securing Agentic AI: A Comprehensive Threat Model and Mitigation Framework for Generative AI Agents](https://arxiv.org/html/2504.19956v2)

