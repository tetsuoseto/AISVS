# 9 自主編排與代理行動安全

## 控制目標

確保自主或多代理人工智慧系統只能執行明確意圖、經過認證、可審計且在有限成本與風險門檻內的動作。此措施可防範自主系統入侵、工具誤用、代理循環偵測、通訊劫持、身份偽造、群體操控及意圖操縱等威脅。

---

## 9.1 代理任務規劃與遞歸預算

限制遞迴計劃並強制對特權操作設置人工檢查點。

|   #   | 描述                                              | 等級  | 角色  |
| :---: | ----------------------------------------------- | :-: | :-: |
| 9.1.1 | 確認最大遞歸深度、寬度、實際時間、令牌數量和每次代理執行的貨幣成本均由中央配置並受版本控制。  |  1  | D/V |
| 9.1.2 | 確認特權或不可逆操作（例如，程式碼提交、金融轉帳）在執行前需透過可審計管道取得明確的人為批准。 |  1  | D/V |
| 9.1.3 | 確認即時資源監控器在任何預算閾值被超過時會觸發斷路器中斷，從而停止進一步的任務擴展。      |  2  |  D  |
| 9.1.4 | 確認斷路器事件已記錄代理程式ID、觸發條件及捕獲的計劃狀態，以供取證審查。           |  2  | D/V |
| 9.1.5 | 確認安全測試涵蓋預算耗盡和計劃失控場景，並確保在無資料損失的情況下安全停止。          |  3  |  V  |
| 9.1.6 | 驗證預算政策以程式碼政策形式表達，並在 CI/CD 中強制執行，以阻止配置漂移。        |  3  |  D  |

---

## 9.2 工具插件沙盒化

隔離工具互動以防止未經授權的系統存取或程式碼執行。

|   #   | 描述                                                        | 等級  | 角色  |
| :---: | --------------------------------------------------------- | :-: | :-: |
| 9.2.1 | 確認每個工具/插件均在操作系統、容器或 WASM 級別的沙箱內執行，並具備最小權限的檔案系統、網路及系統呼叫政策。 |  1  | D/V |
| 9.2.2 | 確認沙箱資源配額（CPU、記憶體、磁碟、網路輸出）及執行逾時是否被強制執行並記錄。                 |  1  | D/V |
| 9.2.3 | 驗證工具二進位檔或描述檔是否經過數位簽章；在載入前先驗證簽章的有效性。                       |  2  | D/V |
| 9.2.4 | 驗證沙箱遙測資料流向 SIEM；異常（例如，嘗試的外發連線）會觸發警報。                      |  2  |  V  |
| 9.2.5 | 確認高風險插件在生產環境部署前進行安全審查與滲透測試。                               |  3  |  V  |
| 9.2.6 | 確認沙盒逃逸嘗試會自動被阻止，並且涉嫌的插件會被隔離以待調查。                           |  3  | D/V |

---

## 9.3 自主循環與成本界定

偵測並阻止失控的代理對代理遞歸和成本爆炸。

|   #   | 描述                                            | 等級  | 角色  |
| :---: | --------------------------------------------- | :-: | :-: |
| 9.3.1 | 驗證代理之間的呼叫是否包含跳數限制或存活時間（TTL），且執行環境會遞減並強制執行該限制。 |  1  | D/V |
| 9.3.2 | 驗證代理是否維持唯一的調用圖 ID 以識別自我調用或循環模式。               |  2  |  D  |
| 9.3.3 | 驗證累積計算單元與支出計數器是否按請求鏈路追蹤；超出限制將中止該鏈路。           |  2  | D/V |
| 9.3.4 | 驗證形式分析或模型檢查是否證明代理協議中不存在無界遞歸。                  |  3  |  V  |
| 9.3.5 | 驗證迴圈中止事件是否會產生警報並提供持續改進的指標。                    |  3  |  D  |

---

## 9.4 協議層級的誤用防護

在代理與外部系統之間建立安全的通訊通道，以防止劫持或操控。

|   #   | 描述                                                     | 等級  | 角色  |
| :---: | ------------------------------------------------------ | :-: | :-: |
| 9.4.1 | 驗證所有代理人與工具之間及代理人之間的訊息皆經過身份驗證（例如，相互 TLS 或 JWT）並進行端到端加密。 |  1  | D/V |
| 9.4.2 | 驗證架構是否嚴格被驗證；未知欄位或格式錯誤的訊息會被拒絕。                          |  1  |  D  |
| 9.4.3 | 確認完整性檢查（MAC 或數位簽章）涵蓋整個訊息有效負載，包括工具參數。                   |  2  | D/V |
| 9.4.4 | 確認在協議層強制執行重播防護（使用隨機數或時間戳窗口）。                           |  2  |  D  |
| 9.4.5 | 確認協議實作進行模糊測試和靜態分析，以檢測注入或反序列化漏洞。                        |  3  |  V  |

---

## 9.5 代理身份與防篡改證明

確保行為可被歸責且修改可被偵測。

|   #   | 描述                                 | 等級  | 角色  |
| :---: | ---------------------------------- | :-: | :-: |
| 9.5.1 | 驗證每個代理實例是否擁有唯一的加密身份（密鑰對或硬體根憑證）。    |  1  | D/V |
| 9.5.2 | 驗證所有代理操作均已簽名並帶有時間戳；日誌包含簽名以確保不可否認性。 |  2  | D/V |
| 9.5.3 | 確認防篡改日誌被存儲在僅可附加或一次寫入的媒介中。          |  2  |  V  |
| 9.5.4 | 驗證身分金鑰是否在定義的時間表和妥協指標下輪替。           |  3  |  D  |
| 9.5.5 | 驗證欺騙或金鑰衝突嘗試能立即觸發受影響代理的隔離。          |  3  | D/V |

---

## 9.6 多代理群集風險降低

透過隔離和正式安全建模來減輕集體行為危害。

|   #   | 描述                                      | 等級  | 角色  |
| :---: | --------------------------------------- | :-: | :-: |
| 9.6.1 | 驗證在不同安全領域中操作的代理是否在隔離的執行時沙盒或網絡區段中執行。     |  1  | D/V |
| 9.6.2 | 確認群集行為在部署前已被建模並正式驗證其活性和安全性。             |  3  |  V  |
| 9.6.3 | 驗證運行時監控器能檢測到新出現的不安全模式（例如，振盪、死鎖）並啟動糾正措施。 |  3  |  D  |

---

## 9.7 使用者與工具認證／授權

為每個代理觸發的操作實施強健的存取控制。

|   #   | 描述                                    | 等級  | 角色  |
| :---: | ------------------------------------- | :-: | :-: |
| 9.7.1 | 確認代理程式以一流主體身份驗證至下游系統，且絕不重複使用終端用戶憑證。   |  1  | D/V |
| 9.7.2 | 驗證細粒度授權策略是否限制代理程式可調用的工具以及其可提供的參數。     |  2  |  D  |
| 9.7.3 | 驗證特權檢查是否在每次呼叫時重新評估（持續授權），而不僅僅是在會話開始時。 |  2  |  V  |
| 9.7.4 | 驗證授權的權限是否會自動過期，並在超時或範圍更改後需要重新同意。      |  3  |  D  |

---

## 9.8 代理人間通訊安全

對所有代理之間的訊息進行加密和完整性保護，以防止竊聽和篡改。

|   #   | 描述                                        | 等級  | 角色  |
| :---: | ----------------------------------------- | :-: | :-: |
| 9.8.1 | 驗證代理通道必須具備相互認證和完美前向保密加密（例如 TLS 1.3）。      |  1  | D/V |
| 9.8.2 | 在處理之前，請確認訊息的完整性與來源已被驗證；如驗證失敗，將發出警報並丟棄該訊息。 |  1  |  D  |
| 9.8.3 | 驗證通訊元資料（時間戳記、序號）是否被記錄以支持取證還原。             |  2  | D/V |
| 9.8.4 | 驗證形式驗證或模型檢查確認協議狀態機無法被驅動進入不安全狀態。           |  3  |  V  |

---

## 9.9 意圖驗證與約束強制執行

驗證代理操作是否符合用戶的明確意圖及系統限制。

|   #   | 描述                                              | 等級  | 角色  |
| :---: | ----------------------------------------------- | :-: | :-: |
| 9.9.1 | 驗證預執行限制解算器是否依據硬編碼的安全性和政策規則檢查建議的行動。              |  1  |  D  |
| 9.9.2 | 確認高影響力操作（財務、破壞性、隱私敏感）需要來自發起使用者的明確意圖確認。          |  2  | D/V |
| 9.9.3 | 驗證後置條件檢查確保已完成的動作達成預期效果且無副作用；若有差異則觸發回滾。          |  2  |  V  |
| 9.9.4 | 驗證正式方法（例如，模型檢查、定理證明）或基於屬性的測試已證明代理計劃滿足所有宣告的約束條件。 |  3  |  V  |
| 9.9.5 | 確認意圖不匹配或約束違規事件是否促進持續改進循環及威脅情報共享。                |  3  |  D  |

---

## 9.10 代理推理策略安全性

安全選擇與執行不同的推理策略，包括 ReAct、Chain-of-Thought 及 Tree-of-Thoughts 方法。

|   #    | 描述                                                                                      | 等級  | 角色  |
| :----: | --------------------------------------------------------------------------------------- | :-: | :-: |
| 9.10.1 | 驗證推理策略選擇是否使用確定性標準（輸入複雜度、任務類型、安全性上下文），並且在相同的安全性上下文中，相同的輸入是否產生相同的策略選擇。                    |  1  | D/V |
| 9.10.2 | 確認每種推理策略（ReAct、思維鏈 Chain-of-Thought、思維樹 Tree-of-Thoughts）皆具備針對其認知方法的專屬輸入驗證、輸出淨化及執行時間限制。 |  1  | D/V |
| 9.10.3 | 驗證推理策略轉換是否已記錄完整的上下文，包括輸入特徵、選擇標準值及執行元資料，用以重建審計追蹤。                                        |  2  | D/V |
| 9.10.4 | 請確認思維樹推理包含分支修剪機制，當發現策略違規、資源限制或安全界限時，能終止探索。                                              |  2  | D/V |
| 9.10.5 | 確認 ReAct（推理-行動-觀察）循環在每個階段包含驗證檢查點：推理步驟驗證、行動授權以及在繼續前進行觀察淨化。                               |  2  | D/V |
| 9.10.6 | 驗證推理策略的性能指標（執行時間、資源使用、輸出品質）是否在指標超出設定閾值時，通過自動警報進行監控。                                     |  3  | D/V |
| 9.10.7 | 驗證結合多種策略的混合推理方法是否維持所有組成策略的輸入驗證和輸出限制，且不繞過任何安全控制。                                         |  3  | D/V |
| 9.10.8 | 驗證推理策略安全測試是否包含使用格式錯誤的輸入進行模糊測試、設計用於強制策略切換的對抗性提示，以及針對每種認知方法的邊界條件測試。                       |  3  | D/V |

---

## 9.11 代理生命周期狀態管理與安全性

使用加密審計追蹤和明確的恢復程序，確保代理初始化、狀態轉換和終止的安全性。

|   #    | 描述                                                                              | 等級  | 角色  |
| :----: | ------------------------------------------------------------------------------- | :-: | :-: |
| 9.11.1 | 驗證代理初始化是否包含使用硬體支援的憑證建立密碼學身份，以及包含代理 ID、時間戳記、配置雜湊和初始化參數的不可變啟動審計日誌。                |  1  | D/V |
| 9.11.2 | 驗證代理狀態轉換是否經過密碼學簽名、帶有時間戳記，並且完整記錄上下文，包括觸發事件、先前狀態雜湊、新狀態雜湊以及執行的安全性驗證。               |  2  | D/V |
| 9.11.3 | 確認代理程式關閉程序包含使用加密抹除或多次覆寫的安全記憶體清除、透過憑證授權中心通知進行憑證撤銷，以及產生防篡改的終止證書。                  |  2  | D/V |
| 9.11.4 | 驗證代理恢復機制是否使用密碼學校驗和（至少為 SHA-256）來驗證狀態完整性，並在檢測到損壞時自動回滾至已知良好狀態，同時伴隨自動警報和手動批准要求。    |  3  | D/V |
| 9.11.5 | 驗證代理持久化機制是否使用每個代理的 AES-256 金鑰加密敏感狀態數據，並在可配置的時間表（最多 90 天）上實施安全的金鑰輪換，且部署過程中無停機時間。 |  3  | D/V |

---

## 9.12 工具整合安全框架

針對動態工具載入、執行及結果驗證所設計的安全控管，並附有明確的風險評估及審批流程。

|   #    | 描述                                                                              | 等級  | 角色  |
| :----: | ------------------------------------------------------------------------------- | :-: | :-: |
| 9.12.1 | 驗證工具描述符是否包含指定所需權限（讀取/寫入/執行）、風險等級（低/中/高）、資源限制（CPU、記憶體、網路）以及工具清單中記錄的驗證需求的安全元資料。   |  1  | D/V |
| 9.12.2 | 在整合前，確認工具執行結果已依預期結構（JSON Schema、XML Schema）及安全政策（輸出淨化、資料分類）進行驗證，並設定逾時限制及錯誤處理程序。 |  1  | D/V |
| 9.12.3 | 驗證工具互動日誌是否包含詳細的安全上下文，包括權限使用情況、資料存取模式、執行時間、資源消耗及返回代碼，並使用結構化日誌以利 SIEM 整合。         |  2  | D/V |
| 9.12.4 | 驗證動態工具加載機制是否使用 PKI 基礎設施進行數字簽名驗證，並在執行前實施具有沙箱隔離和權限驗證的安全加載協議。                      |  2  | D/V |
| 9.12.5 | 驗證工具安全評估是否會自動觸發於新版本，並搭配強制的批准門檻，包括靜態分析、動態測試及安全團隊審查，且具有文件化的批准標準及服務等級協議（SLA）要求。    |  3  | D/V |

---

### 參考文獻

* [MITRE ATLAS tactics ML09](https://atlas.mitre.org/)
* [Circuit-breaker research for AI agents — Zou et al., 2024](https://arxiv.org/abs/2406.04313)
* [Trend Micro analysis of sandbox escapes in AI agents — Park, 2025](https://www.trendmicro.com/vinfo/us/security/news/cybercrime-and-digital-threats/unveiling-ai-agent-vulnerabilities-code-execution)
* [Auth0 guidance on human-in-the-loop authorization for agents — Martinez, 2025](https://auth0.com/blog/secure-human-in-the-loop-interactions-for-ai-agents/)
* [Medium deep-dive on MCP & A2A protocol hijacking — ForAISec, 2025](https://medium.com/%40foraisec/security-analysis-potential-ai-agent-hijacking-via-mcp-and-a2a-protocol-insights-cd1ec5e6045f)
* [Rapid7 fundamentals on spoofing attack prevention — 2024](https://www.rapid7.com/fundamentals/spoofing-attacks/)
* [Imperial College verification of swarm systems — Lomuscio et al.](https://sail.doc.ic.ac.uk/projects/swarms/)
* [NIST AI Risk Management Framework 1.0, 2023](https://nvlpubs.nist.gov/nistpubs/ai/nist.ai.100-1.pdf)
* [WIRED security briefing on encryption best practices, 2024](https://www.wired.com/story/encryption-apps-chinese-telecom-hacking-hydra-russia-exxon)
* [OWASP Top 10 for LLM Applications, 2025](https://owasp.org/www-project-top-10-for-large-language-model-applications/)
* [Comprehensive Vulnerability Analysis is Necessary for Trustworthy LLM-MAS](https://arxiv.org/html/2506.01245v1)
* [How Is LLM Reasoning Distracted by Irrelevant Context?
  An Analysis Using a Controlled Benchmark](https://www.arxiv.org/pdf/2505.18761)
* [Large Language Model Sentinel: LLM Agent for Adversarial Purification](https://arxiv.org/pdf/2405.20770)
* [Securing Agentic AI: A Comprehensive Threat Model and Mitigation Framework for Generative AI Agents](https://arxiv.org/html/2504.19956v2)

