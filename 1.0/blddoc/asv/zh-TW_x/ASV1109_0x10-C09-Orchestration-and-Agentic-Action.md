# 9 自主編排與代理行動安全

## 控制目標

確保自主或多代理人工智慧系統只能執行明確預期、經過身份驗證、可審計且在有限成本及風險門檻內的行動。這可防範自主系統遭入侵、工具誤用、代理循環偵測、通訊劫持、身份偽造、蜂群操控及意圖操縱等威脅。

---

## 9.1 代理任務規劃與遞迴預算

限制遞歸計劃並強制對特權操作設置人工檢查點。

|   #   | 描述                                                      | 層級  | 角色  |
| :---: | ------------------------------------------------------- | :-: | :-: |
| 9.1.1 | 確認每次代理執行的最大遞迴深度、廣度、實際時間、代幣數量和貨幣成本皆由中央配置並進行版本控制。         |  1  | D/V |
| 9.1.2 | 確認特權或不可逆操作（例如，代碼提交、財務轉賬）在執行前需通過可審計的渠道獲得明確的人為批准。         |  1  | D/V |
| 9.1.3 | 驗證即時資源監控器在任一預算閾值被超過時是否會觸發斷路器中斷，從而停止進一步的任務擴展。            |  2  |  D  |
| 9.1.4 | 驗證斷路器事件是否已使用代理程式 ID、觸發條件及擷取的計劃狀態進行記錄，以便進行鑑識審查。          |  2  | D/V |
| 9.1.5 | 驗證安全測試涵蓋預算耗盡和失控計劃場景，確認安全停止且無資料損失。                       |  3  |  V  |
| 9.1.6 | 驗證預算政策已以政策即程式碼（policy-as-code）方式表達，並在 CI/CD 中執行以阻止配置漂移。 |  3  |  D  |

---

## 9.2 工具插件沙箱化

隔離工具互動以防止未經授權的系統存取或程式碼執行。

|   #   | 描述                                                         | 層級  | 角色  |
| :---: | ---------------------------------------------------------- | :-: | :-: |
| 9.2.1 | 驗證每個工具/外掛程式是否在作業系統、容器或 WASM 級沙箱內執行，並採用最小權限的檔案系統、網路和系統呼叫策略。 |  1  | D/V |
| 9.2.2 | 驗證沙盒資源配額（CPU、記憶體、磁碟、網路出口流量）及執行逾時是否被強制執行並記錄。                |  1  | D/V |
| 9.2.3 | 驗證工具二進位檔或描述檔是否具有數位簽章；在載入之前驗證簽章的有效性。                        |  2  | D/V |
| 9.2.4 | 驗證沙盒遙測數據是否流向 SIEM；異常情況（例如嘗試的出站連線）會觸發警報。                    |  2  |  V  |
| 9.2.5 | 確認高風險插件在投入生產部署前經過安全審查和滲透測試。                                |  3  |  V  |
| 9.2.6 | 確認沙盒逃逸嘗試會自動被阻擋，並且違規外掛會被隔離以待調查。                             |  3  | D/V |

---

## 9.3 自主迴圈與成本界定

檢測並阻止無控制的代理對代理遞歸及成本爆炸。

|   #   | 描述                                       | 層級  | 角色  |
| :---: | ---------------------------------------- | :-: | :-: |
| 9.3.1 | 驗證代理之間的呼叫是否包含跳數限制或 TTL，且由執行時環境進行遞減和強制執行。 |  1  | D/V |
| 9.3.2 | 驗證代理維持唯一的調用圖ID以識別自我調用或循環模式。              |  2  |  D  |
| 9.3.3 | 確認累積運算單元和支出計數器是否依請求鏈追蹤；超出限制會中止該鏈。        |  2  | D/V |
| 9.3.4 | 驗證形式分析或模型檢查能證明代理協議中不存在無界遞迴。              |  3  |  V  |
| 9.3.5 | 驗證迴圈中止事件是否產生警報並提供持續改進的度量指標。              |  3  |  D  |

---

## 9.4 協議層級濫用防護

在代理與外部系統之間建立安全的通信通道，以防止劫持或操控。

|   #   | 描述                                              | 層級  | 角色  |
| :---: | ----------------------------------------------- | :-: | :-: |
| 9.4.1 | 驗證所有代理到工具及代理到代理的訊息皆經過驗證（例如，雙向 TLS 或 JWT）且端對端加密。 |  1  | D/V |
| 9.4.2 | 驗證架構是否嚴格驗證；未知欄位或格式錯誤的訊息必須被拒絕。                   |  1  |  D  |
| 9.4.3 | 驗證完整性檢查（MAC 或數位簽章）是否涵蓋包含工具參數的整個訊息負載。            |  2  | D/V |
| 9.4.4 | 確認在協議層強制執行重播保護（隨機數或時間戳窗口）。                      |  2  |  D  |
| 9.4.5 | 驗證協議實現是否經過模糊測試和靜態分析，以檢測注入或反序列化漏洞。               |  3  |  V  |

---

## 9.5 代理身份與防篡改證明

確保行為可歸屬且修改可被檢測。

|   #   | 描述                              | 層級  | 角色  |
| :---: | ------------------------------- | :-: | :-: |
| 9.5.1 | 驗證每個代理實例是否擁有唯一的加密身份（密鑰對或硬體根憑證）。 |  1  | D/V |
| 9.5.2 | 驗證所有代理操作均已簽名並帶有時間戳；日誌包含簽名以防抵賴。  |  2  | D/V |
| 9.5.3 | 確認防篡改日誌存儲在僅可追加或一次性寫入的媒介中。       |  2  |  V  |
| 9.5.4 | 驗證身份金鑰是否按照既定的排程以及在受損指標出現時進行輪替。  |  3  |  D  |
| 9.5.5 | 確認欺騙或金鑰衝突嘗試會立即觸發受影響代理的隔離。       |  3  | D/V |

---

## 9.6 多智能體群體風險降低

透過隔離與正式安全建模來減輕集體行為危害。

|   #   | 描述                                      | 層級  | 角色  |
| :---: | --------------------------------------- | :-: | :-: |
| 9.6.1 | 驗證在不同安全域中運行的代理是否在隔離的執行時沙盒或網絡分段中執行。      |  1  | D/V |
| 9.6.2 | 確認群體行為在部署前已被建模並正式驗證其活性與安全性。             |  3  |  V  |
| 9.6.3 | 驗證運行時監控器能夠偵測出新興的不安全模式（例如，振盪、死鎖）並啟動矯正措施。 |  3  |  D  |

---

## 9.7 使用者與工具驗證／授權

為每個代理觸發的操作實施強健的存取控制。

|   #   | 描述                                      | 層級  | 角色  |
| :---: | --------------------------------------- | :-: | :-: |
| 9.7.1 | 驗證代理程式以一級主體身份向下游系統進行身份驗證，且絕不重複使用最終用戶憑證。 |  1  | D/V |
| 9.7.2 | 驗證細粒度授權政策是否限制代理可以調用的工具以及可提供的參數。         |  2  |  D  |
| 9.7.3 | 確認權限檢查在每次呼叫時都會重新評估（持續授權），而不僅僅是在會話開始時。   |  2  |  V  |
| 9.7.4 | 驗證委派權限會自動過期，並且在超時或範圍變更後需要重新同意。          |  3  |  D  |

---

## 9.8 代理人間通訊安全

加密並完整性保護所有代理之間的訊息，以防止竊聽和篡改。

|   #   | 描述                                     | 層級  | 角色  |
| :---: | -------------------------------------- | :-: | :-: |
| 9.8.1 | 確認代理通道必須使用雙向身份驗證和完美前向保密加密（例如 TLS 1.3）。 |  1  | D/V |
| 9.8.2 | 在處理之前，請驗證訊息的完整性和來源；若驗證失敗，則發出警報並丟棄該訊息。  |  1  |  D  |
| 9.8.3 | 驗證通訊元資料（時間戳記、序列號）是否有被記錄，以支持取證重建。       |  2  | D/V |
| 9.8.4 | 確認形式驗證或模型檢查能證實協議狀態機無法被驅動進入不安全狀態。       |  3  |  V  |

---

## 9.9 意圖驗證與約束執行

驗證代理行為是否符合使用者的明確意圖及系統限制。

|   #   | 描述                                             | 層級  | 角色  |
| :---: | ---------------------------------------------- | :-: | :-: |
| 9.9.1 | 驗證預執行約束求解器是否根據硬編碼的安全和政策規則來檢查建議的行動。             |  1  |  D  |
| 9.9.2 | 確認高影響行為（財務、破壞性、隱私敏感）需要來自發起用戶的明確意圖確認。           |  2  | D/V |
| 9.9.3 | 驗證後置條件檢查是否確認已完成的動作達成預期效果且無副作用；若有差異則觸發回滾。       |  2  |  V  |
| 9.9.4 | 驗證形式方法（例如，模型檢查、定理證明）或基於性質的測試是否證明代理計劃滿足所有聲明的約束。 |  3  |  V  |
| 9.9.5 | 確認意圖不匹配或約束違規事件能夠推動持續改進循環和威脅情報共享。               |  3  |  D  |

---

## 9.10 代理推理策略安全性

安全選擇與執行不同的推理策略，包括 ReAct、Chain-of-Thought 和 Tree-of-Thoughts 方法。

|   #    | 描述                                                                              | 層級  | 角色  |
| :----: | ------------------------------------------------------------------------------- | :-: | :-: |
| 9.10.1 | 驗證推理策略選擇是否使用確定性標準（輸入複雜度、任務類型、安全上下文），並且在相同安全上下文中，相同輸入是否產生相同的策略選擇。                |  1  | D/V |
| 9.10.2 | 確認每種推理策略（ReAct、Chain-of-Thought、Tree-of-Thoughts）皆具備專門針對其認知方法的輸入驗證、輸出淨化及執行時間限制。 |  1  | D/V |
| 9.10.3 | 確認推理策略轉換已記錄完整上下文，包括輸入特性、選擇標準值以及執行元資料，以便進行審計軌跡重建。                                |  2  | D/V |
| 9.10.4 | 驗證思維樹推理是否包含分支剪枝機制，在偵測到策略違規、資源限制或安全邊界時終止探索。                                      |  2  | D/V |
| 9.10.5 | 驗證 ReAct（Reason-Act-Observe）循環在每個階段包含驗證檢查點：推理步驟驗證、行動授權，以及在繼續之前的觀察淨化。            |  2  | D/V |
| 9.10.6 | 驗證當推理策略績效指標（執行時間、資源使用量、輸出品質）偏離設定閾值時，是否通過自動警報進行監控。                               |  3  | D/V |
| 9.10.7 | 驗證結合多種策略的混合推理方法是否維持所有組成策略的輸入驗證和輸出限制，且不繞過任何安全控制措施。                               |  3  | D/V |
| 9.10.8 | 驗證推理策略的安全測試包括使用畸形輸入進行模糊測試、設計敵對提示以強制策略切換，以及針對每種認知方法進行邊界條件測試。                     |  3  | D/V |

---

## 9.11 代理程式生命週期狀態管理與安全性

安全代理初始化、狀態轉換與終止，並具備密碼學審計追蹤及明確的恢復程序。

|   #    | 描述                                                                             | 層級  | 角色  |
| :----: | ------------------------------------------------------------------------------ | :-: | :-: |
| 9.11.1 | 驗證代理初始化是否包含使用硬體支援憑證建立密碼學身份，並且具有包含代理ID、時間戳記、配置哈希和初始化參數的不可變啟動審計日誌。               |  1  | D/V |
| 9.11.2 | 驗證代理狀態轉換是否經過密碼學簽名、時間戳記，並以完整上下文記錄，包括觸發事件、先前狀態雜湊、新狀態雜湊以及執行的安全驗證。                 |  2  | D/V |
| 9.11.3 | 確認代理程式關閉程序包括使用加密抹除或多重覆寫進行安全記憶體清除、透過通知憑證授權機構進行憑證撤銷，以及生成防篡改終止憑證。                 |  2  | D/V |
| 9.11.4 | 驗證代理恢復機制是否使用密碼學校驗和（至少SHA-256）來驗證狀態完整性，並在檢測到損壞時回滾到已知良好狀態，同時配備自動警報和手動批准要求。       |  3  | D/V |
| 9.11.5 | 驗證代理持久化機制是否使用每個代理專用的 AES-256 密鑰加密敏感狀態數據，並在可配置的排程（最長 90 天）上實施安全的密鑰輪換，且能實現零停機部署。 |  3  | D/V |

---

## 9.12 工具整合安全框架

具有定義風險評估和批准流程的動態工具加載、執行及結果驗證的安全控制。

|   #    | 描述                                                                               | 層級  | 角色  |
| :----: | -------------------------------------------------------------------------------- | :-: | :-: |
| 9.12.1 | 驗證工具描述符是否包含安全元數據，說明所需的權限（讀取/寫入/執行）、風險等級（低/中/高）、資源限制（CPU、記憶體、網路）及工具清單中記錄的驗證要求。    |  1  | D/V |
| 9.12.2 | 驗證工具執行結果是否依預期的結構（JSON Schema、XML Schema）及安全政策（輸出清理、資料分類）進行驗證，並在整合前遵循逾時限制及錯誤處理程序。 |  1  | D/V |
| 9.12.3 | 驗證工具交互日誌是否包含詳細的安全上下文，包括權限使用、數據訪問模式、執行時間、資源消耗和返回代碼，並採用結構化日誌以便於SIEM集成。             |  2  | D/V |
| 9.12.4 | 驗證動態工具加載機制是否使用公鑰基礎設施（PKI）驗證數位簽名，並在執行前實施具有沙箱隔離和權限驗證的安全加載協議。                       |  2  | D/V |
| 9.12.5 | 驗證工具安全評估是否會自動觸發於新版本，並包含強制性的審核門檻，包括靜態分析、動態測試及安全團隊審核，且具備文件化的審核標準及服務等級協議（SLA）要求。    |  3  | D/V |

---

### 參考文獻

* [MITRE ATLAS tactics ML09](https://atlas.mitre.org/)
* [Circuit-breaker research for AI agents — Zou et al., 2024](https://arxiv.org/abs/2406.04313)
* [Trend Micro analysis of sandbox escapes in AI agents — Park, 2025](https://www.trendmicro.com/vinfo/us/security/news/cybercrime-and-digital-threats/unveiling-ai-agent-vulnerabilities-code-execution)
* [Auth0 guidance on human-in-the-loop authorization for agents — Martinez, 2025](https://auth0.com/blog/secure-human-in-the-loop-interactions-for-ai-agents/)
* [Medium deep-dive on MCP & A2A protocol hijacking — ForAISec, 2025](https://medium.com/%40foraisec/security-analysis-potential-ai-agent-hijacking-via-mcp-and-a2a-protocol-insights-cd1ec5e6045f)
* [Rapid7 fundamentals on spoofing attack prevention — 2024](https://www.rapid7.com/fundamentals/spoofing-attacks/)
* [Imperial College verification of swarm systems — Lomuscio et al.](https://sail.doc.ic.ac.uk/projects/swarms/)
* [NIST AI Risk Management Framework 1.0, 2023](https://nvlpubs.nist.gov/nistpubs/ai/nist.ai.100-1.pdf)
* [WIRED security briefing on encryption best practices, 2024](https://www.wired.com/story/encryption-apps-chinese-telecom-hacking-hydra-russia-exxon)
* [OWASP Top 10 for LLM Applications, 2025](https://owasp.org/www-project-top-10-for-large-language-model-applications/)
* [Comprehensive Vulnerability Analysis is Necessary for Trustworthy LLM-MAS](https://arxiv.org/html/2506.01245v1)
* [How Is LLM Reasoning Distracted by Irrelevant Context?
  An Analysis Using a Controlled Benchmark](https://www.arxiv.org/pdf/2505.18761)
* [Large Language Model Sentinel: LLM Agent for Adversarial Purification](https://arxiv.org/pdf/2405.20770)
* [Securing Agentic AI: A Comprehensive Threat Model and Mitigation Framework for Generative AI Agents](https://arxiv.org/html/2504.19956v2)

