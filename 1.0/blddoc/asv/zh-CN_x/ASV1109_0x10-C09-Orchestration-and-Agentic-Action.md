# 9 自主编排与代理行动安全

## 控制目标

确保自治或多智能体 AI 系统仅能执行那些明确、经认证、可审计且在受限成本和风险阈值内的操作。这有助于防范以下威胁：自治系统妥协、工具滥用、智能体循环检测、通信劫持、身份伪造、群体操控以及意图操纵。

---

## 9.1 智能体任务规划与递归预算

对递归计划进行节流，并在特权操作时强制设立人工审查点。

|   #   | 描述                                                | 等级  | 角色  |
| :---: | ------------------------------------------------- | :-: | :-: |
| 9.1.1 | 验证最大递归深度、广度、实际用时、令牌以及每次代理执行的货币成本是否集中配置并受版本控制。     |  1  | D/V |
| 9.1.2 | 验证特权或不可逆操作（例如代码提交、资金转账）在执行前是否需要通过可审计的渠道获得明确的人类批准。 |  1  | D/V |
| 9.1.3 | 验证实时资源监控在任意预算阈值被超出时，是否会触发断路器中断，从而停止进一步的任务扩展。      |  2  |  D  |
| 9.1.4 | 验证断路器事件是否已被记录，包含代理ID、触发条件和捕获的计划状态，以供取证审查。         |  2  | D/V |
| 9.1.5 | 验证安全测试覆盖预算耗尽场景和失控计划场景，并确认在不丢失数据的前提下实现安全中止。        |  3  |  V  |
| 9.1.6 | 验证预算策略是否以策略即代码的形式表达，并在 CI/CD 中强制执行，以阻止配置漂移。       |  3  |  D  |

---

## 9.2 工具插件沙箱化

将工具交互隔离，以防止未授权的系统访问或代码执行。

|   #   | 描述                                                         | 等级  | 角色  |
| :---: | ---------------------------------------------------------- | :-: | :-: |
| 9.2.1 | 验证每个工具/插件是否在操作系统级、容器级或 WASM 级沙箱中执行，并具备最小权限的文件系统、网络和系统调用策略。 |  1  | D/V |
| 9.2.2 | 验证沙箱资源配额（CPU、内存、磁盘、网络出站流量）以及执行超时是否被强制执行并被记录。               |  1  | D/V |
| 9.2.3 | 验证工具二进制文件或描述符是否已数字签名；在加载之前对签名进行验证。                         |  2  | D/V |
| 9.2.4 | 验证沙箱遥测是否流向 SIEM；异常（例如，尝试的出站连接）会触发告警。                       |  2  |  V  |
| 9.2.5 | 请确保高风险插件在生产部署之前经过安全评审和渗透测试。                                |  3  |  V  |
| 9.2.6 | 请确保沙箱逃逸尝试会被自动阻止，且有问题的插件在调查期间被隔离。                           |  3  | D/V |

---

## 9.3 自主循环与成本界限

检测并阻止失控的代理之间的递归以及成本暴涨。

|   #   | 描述                                                         | 等级  | 角色  |
| :---: | ---------------------------------------------------------- | :-: | :-: |
| 9.3.1 | 验证 代理之间的调用 是否 包含 跳数限制（hop-limit）或 TTL，运行时 会 对其 递减 并 强制 执行。 |  1  | D/V |
| 9.3.2 | 验证智能体是否维护唯一的调用图 ID，以便检测自调用或循环模式。                           |  2  |  D  |
| 9.3.3 | 验证对每个请求链是否跟踪累计的计算单元和消耗计数器；超过上限将中止该链。                       |  2  | D/V |
| 9.3.4 | 验证形式化分析或模型检测是否证明了智能体协议中不存在无界递归。                            |  3  |  V  |
| 9.3.5 | 验证循环中止事件是否会生成警报，并将数据用于持续改进的度量指标。                           |  3  |  D  |

---

## 9.4 协议级滥用防护

在代理与外部系统之间建立安全通信通道，以防止劫持或篡改。

|   #   | 描述                                                                             | 等级  | 角色  |
| :---: | ------------------------------------------------------------------------------ | :-: | :-: |
| 9.4.1 | 请验证所有 agent-to-tool 和 agent-to-agent 消息是否经过身份验证（例如，双向 TLS 或 JWT），并且是否已实现端到端加密。 |  1  | D/V |
| 9.4.2 | 请确保模式被严格验证；未知字段或格式错误的消息将被拒绝。                                                   |  1  |  D  |
| 9.4.3 | 请确保完整性校验（MACs 或数字签名）覆盖整个消息有效载荷，包括工具参数。                                         |  2  | D/V |
| 9.4.4 | 验证在协议层是否实现了防重放（nonce 或时间戳窗口）。                                                  |  2  |  D  |
| 9.4.5 | 验证协议实现是否经过模糊测试和静态分析，以发现注入或反序列化漏洞。                                              |  3  |  V  |

---

## 9.5 代理身份 & 篡改证据

确保行动可追溯且修改可检测。

|   #   | 描述                                     | 等级  | 角色  |
| :---: | -------------------------------------- | :-: | :-: |
| 9.5.1 | 验证每个代理实例是否具备唯一的密码学身份（密钥对或硬件-rooted凭证）。 |  1  | D/V |
| 9.5.2 | 验证所有代理操作均已签名并带有时间戳；日志应包含用于不可抵赖性的签名。    |  2  | D/V |
| 9.5.3 | 验证防篡改日志是否存储在追加写入介质或一次性写入介质上。           |  2  |  V  |
| 9.5.4 | 验证身份密钥是否按既定时间表轮换，以及在出现妥协迹象时轮换。         |  3  |  D  |
| 9.5.5 | 验证伪装攻击或密钥冲突尝试是否会触发对受影响代理的立即隔离。         |  3  | D/V |

---

## 9.6 多智能体蜂群风险降低

通过隔离和形式化安全建模来缓解集体行为风险。

|   #   | 描述                                       | 等级  | 角色  |
| :---: | ---------------------------------------- | :-: | :-: |
| 9.6.1 | 验证在不同安全域中运行的代理是否在隔离的运行时沙箱或网络分段中执行。       |  1  | D/V |
| 9.6.2 | 在部署之前，确保对群体行为进行了建模并经过形式化验证，以确保其具备活性和安全性。 |  3  |  V  |
| 9.6.3 | 验证运行时监控是否能够检测到涌现的不安全模式（例如振荡、死锁），并启动纠正措施。 |  3  |  D  |

---

## 9.7 用户 & 工具 身份验证 / 授权

为每个代理触发的操作实现健壮的访问控制。

|   #   | 描述                                     | 等级  | 角色  |
| :---: | -------------------------------------- | :-: | :-: |
| 9.7.1 | 验证代理是否以一级主体身份对下游系统进行身份验证，并且从不重用终端用户凭据。 |  1  | D/V |
| 9.7.2 | 验证细粒度授权策略是否限制代理可以调用哪些工具，以及可以提供哪些参数。    |  2  |  D  |
| 9.7.3 | 验证权限检查在每次调用时都会重新评估（持续授权），而不仅在会话开始时。    |  2  |  V  |
| 9.7.4 | 验证委派权限是否会自动过期，并在超时或作用域变更后需要重新授权。       |  3  |  D  |

---

## 9.8 代理-代理之间的通信安全

对所有代理之间的消息进行加密并进行完整性保护，以防止窃听和篡改。

|   #   | 描述                                         | 等级  | 角色  |
| :---: | ------------------------------------------ | :-: | :-: |
| 9.8.1 | 验证代理通道是否必须使用双向认证和具备完美前向保密性的加密（例如 TLS 1.3）。 |  1  | D/V |
| 9.8.2 | 在处理之前，确保消息的完整性和来源已被验证；若验证失败，将触发警报并丢弃该消息。   |  1  |  D  |
| 9.8.3 | 验证通信元数据（时间戳、序列号）是否被记录，以支持取证重建。             |  2  | D/V |
| 9.8.4 | 验证形式化验证或模型检查是否能够确认协议状态机不会被驱动进入不安全状态。       |  3  |  V  |

---

## 9.9 意图验证 与 约束执行

验证代理行动是否与用户所述的意图和系统约束一致。

|   #   | 描述                                                | 等级  | 角色  |
| :---: | ------------------------------------------------- | :-: | :-: |
| 9.9.1 | 验证执行前的约束求解器是否将拟议的行动与硬编码的安全与策略规则进行核对。              |  1  |  D  |
| 9.9.2 | 请确认高影响操作（金融相关、具备破坏性、隐私敏感）是否需要来自发起用户的明确意图确认。       |  2  | D/V |
| 9.9.3 | 验证后置条件以确保已完成的操作实现了预期效果且无副作用；若存在差异，则触发回滚。          |  2  |  V  |
| 9.9.4 | 验证形式化方法（例如模型检查、定理证明）或基于属性的测试是否能够证明智能体计划满足所有声明的约束。 |  3  |  V  |
| 9.9.5 | 验证意图不匹配或约束违规事件是否推动持续改进循环与威胁情报共享。                  |  3  |  D  |

---

## 9.10 智能体 推理 策略 安全

安全地选择并执行包括 ReAct、Chain-of-Thought 和 Tree-of-Thoughts 在内的不同推理策略。

|   #    | 描述                                                                                   | 等级  | 角色  |
| :----: | ------------------------------------------------------------------------------------ | :-: | :-: |
| 9.10.1 | 验证推理策略选择是否使用确定性标准（输入复杂度、任务类型、安全上下文），并且在相同安全上下文中，相同输入会产生相同的策略选择。                      |  1  | D/V |
| 9.10.2 | 请验证每种推理策略（ReAct、Chain-of-Thought、Tree-of-Thoughts）是否具备专用的输入验证、输出净化，以及针对其认知方法的执行时间限制。 |  1  | D/V |
| 9.10.3 | 验证推理策略转换是否被完整记录，包含输入特征、选择标准取值和执行元数据，以便进行审计轨迹重建。                                      |  2  | D/V |
| 9.10.4 | 请验证树状推理是否包含在检测到策略违规、资源限制或安全边界时终止探索的分支剪枝机制。                                           |  2  | D/V |
| 9.10.5 | 验证 ReAct（Reason-Act-Observe）循环在每个阶段是否包含验证检查点：推理步骤验证、行动授权，以及在继续之前进行的观测净化。             |  2  | D/V |
| 9.10.6 | 验证推理策略的性能指标（执行时间、资源使用、输出质量）在偏离配置阈值时，是否通过自动化警报进行监控。                                   |  3  | D/V |
| 9.10.7 | 验证将多种策略结合在一起的混合推理方法在不绕过任何安全控制的前提下，是否能够保持所有组成策略的输入验证和输出约束。                            |  3  | D/V |
| 9.10.8 | 验证推理策略的安全性测试是否包括对格式错误输入的模糊测试、旨在强制策略切换的对抗性提示，以及对每种认知方法的边界条件测试。                        |  3  | D/V |

---

## 9.11 代理生命周期状态管理 与 安全

具备加密审计跟踪和明确定义的恢复程序的安全代理初始化、状态转换和终止。

|   #    | 描述                                                                              | 等级  | 角色  |
| :----: | ------------------------------------------------------------------------------- | :-: | :-: |
| 9.11.1 | 验证代理初始化是否包含基于硬件的凭证进行的加密身份建立，以及包含代理 ID、时间戳、配置哈希值和初始化参数的不可变启动审计日志。                |  1  | D/V |
| 9.11.2 | 验证代理状态转换是否经过密码学签名、带有时间戳，并记录完整的上下文信息，包括触发事件、前一状态哈希、新状态哈希，以及所执行的安全性验证。            |  2  | D/V |
| 9.11.3 | 核实代理关停程序是否包括通过密码擦除或多次覆写进行的安全内存擦除、凭据吊销并通知证书颁发机构，以及生成防篡改的终止证书。                    |  2  | D/V |
| 9.11.4 | 验证代理恢复机制是否通过使用加密校验和（至少为 SHA-256）来验证状态完整性，并在检测到损坏时回滚到已知良好状态，同时具备自动警报和人工审批要求。     |  3  | D/V |
| 9.11.5 | 验证代理持久化机制是否使用对每个代理的 AES-256 密钥对敏感状态数据进行加密，并在可配置的时间表上实现安全密钥轮换（最大 90 天），且实现零停机部署。 |  3  | D/V |

---

## 9.12 工具集成安全框架

针对动态工具加载、执行与结果验证的安全控制，包含已定义的风险评估与批准流程。

|   #    | 描述                                                                                    | 等级  | 角色  |
| :----: | ------------------------------------------------------------------------------------- | :-: | :-: |
| 9.12.1 | 请验证工具描述符是否包含安全元数据，这些元数据应指定所需权限（读取/写入/执行）、风险等级（低/中/高）、资源限制（CPU、内存、网络），以及在工具清单中记录的验证要求。 |  1  | D/V |
| 9.12.2 | 在与超时限制和错误处理流程集成之前，请验证工具执行结果是否符合预期的模式（JSON Schema、XML Schema）及安全策略（输出净化、数据分类）。         |  1  | D/V |
| 9.12.3 | 验证工具交互日志是否包含详细的安全上下文信息，包括特权使用、数据访问模式、执行时间、资源消耗和返回码，并实现用于 SIEM 集成的结构化日志记录。             |  2  | D/V |
| 9.12.4 | 验证动态工具加载机制是否使用公钥基础设施验证数字签名，并实现具备沙箱隔离和执行前权限验证的安全加载协议。                                  |  2  | D/V |
| 9.12.5 | 验证新版本是否会自动触发工具安全评估，且包含静态分析、动态测试，以及安全团队评审等强制性审批环节，并提供已文档化的批准标准和 SLA 要求。                |  3  | D/V |

---

### 参考文献

* [MITRE ATLAS tactics ML09](https://atlas.mitre.org/)
* [Circuit-breaker research for AI agents — Zou et al., 2024](https://arxiv.org/abs/2406.04313)
* [Trend Micro analysis of sandbox escapes in AI agents — Park, 2025](https://www.trendmicro.com/vinfo/us/security/news/cybercrime-and-digital-threats/unveiling-ai-agent-vulnerabilities-code-execution)
* [Auth0 guidance on human-in-the-loop authorization for agents — Martinez, 2025](https://auth0.com/blog/secure-human-in-the-loop-interactions-for-ai-agents/)
* [Medium deep-dive on MCP & A2A protocol hijacking — ForAISec, 2025](https://medium.com/%40foraisec/security-analysis-potential-ai-agent-hijacking-via-mcp-and-a2a-protocol-insights-cd1ec5e6045f)
* [Rapid7 fundamentals on spoofing attack prevention — 2024](https://www.rapid7.com/fundamentals/spoofing-attacks/)
* [Imperial College verification of swarm systems — Lomuscio et al.](https://sail.doc.ic.ac.uk/projects/swarms/)
* [NIST AI Risk Management Framework 1.0, 2023](https://nvlpubs.nist.gov/nistpubs/ai/nist.ai.100-1.pdf)
* [WIRED security briefing on encryption best practices, 2024](https://www.wired.com/story/encryption-apps-chinese-telecom-hacking-hydra-russia-exxon)
* [OWASP Top 10 for LLM Applications, 2025](https://owasp.org/www-project-top-10-for-large-language-model-applications/)
* [Comprehensive Vulnerability Analysis is Necessary for Trustworthy LLM-MAS](https://arxiv.org/html/2506.01245v1)
* [How Is LLM Reasoning Distracted by Irrelevant Context?
  An Analysis Using a Controlled Benchmark](https://www.arxiv.org/pdf/2505.18761)
* [Large Language Model Sentinel: LLM Agent for Adversarial Purification](https://arxiv.org/pdf/2405.20770)
* [Securing Agentic AI: A Comprehensive Threat Model and Mitigation Framework for Generative AI Agents](https://arxiv.org/html/2504.19956v2)

