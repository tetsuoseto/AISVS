# 9 自主编排与代理行为安全

## 控制目标

确保自主或多智能体人工智能系统只能执行明确意图、经过认证、可审计且在成本和风险边界内的操作。这可以防范诸如自主系统被攻陷、工具误用、智能体循环检测、通信劫持、身份伪造、群体操控和意图操纵等威胁。

---

## 9.1 代理任务规划与递归预算

限制递归计划的执行速度，并对特权操作强制设置人工检查点。

|   #   | 描述                                              | 级别  | 角色  |
| :---: | ----------------------------------------------- | :-: | :-: |
| 9.1.1 | 验证每个代理执行的最大递归深度、广度、实时时间、令牌数和货币成本是否已集中配置并受版本控制。  |  1  | D/V |
| 9.1.2 | 验证特权或不可逆操作（例如，代码提交、资金转账）在执行前需要通过可审计渠道获得明确的人类批准。 |  1  | D/V |
| 9.1.3 | 验证实时资源监控器在任何预算阈值被超过时触发断路器中断，停止进一步的任务扩展。         |  2  |  D  |
| 9.1.4 | 验证电路断路器事件是否记录了代理 ID、触发条件和捕获的计划状态，以供取证审查。        |  2  | D/V |
| 9.1.5 | 验证安全测试涵盖预算耗尽和失控方案情景，确保在无数据丢失的情况下安全停止。           |  3  |  V  |
| 9.1.6 | 验证预算策略以策略即代码的形式表达，并在CI/CD中强制执行，以阻止配置漂移。         |  3  |  D  |

---

## 9.2 工具插件沙箱化

隔离工具交互以防止未经授权的系统访问或代码执行。

|   #   | 描述                                                          | 级别  | 角色  |
| :---: | ----------------------------------------------------------- | :-: | :-: |
| 9.2.1 | 验证每个工具/插件是否都在操作系统、容器或 WASM 级别的沙箱中执行，并具备最小权限的文件系统、网络和系统调用策略。 |  1  | D/V |
| 9.2.2 | 验证沙箱资源配额（CPU、内存、磁盘、网络出口）和执行超时是否被强制执行并记录。                    |  1  | D/V |
| 9.2.3 | 验证工具二进制文件或描述符是否经过数字签名；在加载前验证签名。                             |  2  | D/V |
| 9.2.4 | 验证沙箱遥测是否流向 SIEM；异常情况（例如，尝试的出站连接）会触发警报。                      |  2  |  V  |
| 9.2.5 | 确保高风险插件在生产部署前经过安全审查和渗透测试。                                   |  3  |  V  |
| 9.2.6 | 验证沙箱逃逸尝试是否被自动阻止，并且违规插件是否被隔离以待调查。                            |  3  | D/V |

---

## 9.3 自主循环与成本界限

检测并阻止失控的代理间递归和成本激增。

|   #   | 描述                                  | 级别  | 角色  |
| :---: | ----------------------------------- | :-: | :-: |
| 9.3.1 | 验证代理间调用是否包含由运行时递减和执行的跳数限制或TTL。      |  1  | D/V |
| 9.3.2 | 验证代理是否保持唯一的调用图 ID，以识别自我调用或循环模式。     |  2  |  D  |
| 9.3.3 | 验证累计计算单元和支出计数器是否按请求链进行跟踪；超过限制将中止该链。 |  2  | D/V |
| 9.3.4 | 验证形式分析或模型检测证明代理协议中不存在无界递归。          |  3  |  V  |
| 9.3.5 | 验证循环中止事件是否生成警报并反馈持续改进指标。            |  3  |  D  |

---

## 9.4 协议级别误用防护

在代理和外部系统之间建立安全的通信渠道，以防止劫持或篡改。

|   #   | 描述                                                     | 级别  | 角色  |
| :---: | ------------------------------------------------------ | :-: | :-: |
| 9.4.1 | 验证所有代理到工具以及代理到代理的消息是否经过身份验证（例如，双向 TLS 或 JWT）并且实现端到端加密。 |  1  | D/V |
| 9.4.2 | 验证模式是否被严格校验；未知字段或格式错误的消息应被拒绝。                          |  1  |  D  |
| 9.4.3 | 验证完整性校验（MAC 或数字签名）是否涵盖了整个消息负载，包括工具参数。                  |  2  | D/V |
| 9.4.4 | 确保在协议层强制执行重放保护（随机数或时间戳窗口）。                             |  2  |  D  |
| 9.4.5 | 验证协议实现是否经过模糊测试和静态分析，以检测注入或反序列化漏洞。                      |  3  |  V  |

---

## 9.5 代理身份与防篡改证据

确保操作可追溯且修改可检测。

|   #   | 描述                                 | 级别  | 角色  |
| :---: | ---------------------------------- | :-: | :-: |
| 9.5.1 | 验证每个代理实例是否拥有唯一的加密身份（密钥对或硬件根凭证）。    |  1  | D/V |
| 9.5.2 | 验证所有代理操作均已签名并加盖时间戳；日志包含签名以确保不可否认性。 |  2  | D/V |
| 9.5.3 | 验证篡改证明日志是否存储在仅追加或一次写入介质中。          |  2  |  V  |
| 9.5.4 | 验证身份密钥是否按定义的计划以及在妥协指示时进行轮换。        |  3  |  D  |
| 9.5.5 | 验证欺骗或密钥冲突尝试是否会立即触发对受影响代理的隔离。       |  3  | D/V |

---

## 9.6 多智能体群体风险降低

通过隔离和正式的安全建模来缓解群体行为风险。

|   #   | 描述                                         | 级别  | 角色  |
| :---: | ------------------------------------------ | :-: | :-: |
| 9.6.1 | 验证在不同安全域中运行的代理是否在隔离的运行时沙箱或网络分段中执行。         |  1  | D/V |
| 9.6.2 | 在部署之前，确保群体行为已被建模并经过正式验证，以保证其活跃性和安全性。       |  3  |  V  |
| 9.6.3 | 验证运行时监视器是否能够检测到新出现的不安全模式（例如，振荡、死锁）并启动纠正措施。 |  3  |  D  |

---

## 9.7 用户与工具认证/授权

为每个代理触发的操作实施严格的访问控制。

|   #   | 描述                                    | 级别  | 角色  |
| :---: | ------------------------------------- | :-: | :-: |
| 9.7.1 | 确保代理作为一类主体对下游系统进行身份验证，且绝不重复使用终端用户凭据。  |  1  | D/V |
| 9.7.2 | 验证细粒度授权策略是否限制了代理可以调用哪些工具以及可以提供哪些参数。   |  2  |  D  |
| 9.7.3 | 验证权限检查是否在每次调用时重新评估（持续授权），而不仅仅是在会话开始时。 |  2  |  V  |
| 9.7.4 | 验证委托权限是否会自动过期，并在超时或范围变更后要求重新同意。       |  3  |  D  |

---

## 9.8 代理与代理之间的通信安全

加密并完整性保护所有代理间消息，以防止窃听和篡改。

|   #   | 描述                                   | 级别  | 角色  |
| :---: | ------------------------------------ | :-: | :-: |
| 9.8.1 | 验证代理通道必须使用双向认证和完美前向保密加密（例如 TLS 1.3）。 |  1  | D/V |
| 9.8.2 | 在处理之前，验证消息的完整性和来源；验证失败时触发警报并丢弃该消息。   |  1  |  D  |
| 9.8.3 | 验证通信元数据（时间戳，序列号）是否被记录以支持取证重建。        |  2  | D/V |
| 9.8.4 | 验证形式化验证或模型检查确认协议状态机无法进入不安全状态。        |  3  |  V  |

---

## 9.9 意图验证与约束执行

验证代理操作是否符合用户陈述的意图和系统约束。

|   #   | 描述                                                | 级别  | 角色  |
| :---: | ------------------------------------------------- | :-: | :-: |
| 9.9.1 | 验证预执行约束求解器是否根据硬编码的安全和策略规则检查所提议的操作。                |  1  |  D  |
| 9.9.2 | 验证高影响操作（财务、破坏性、隐私敏感型）是否需要发起用户的明确意图确认。             |  2  | D/V |
| 9.9.3 | 验证后置条件检查，以确保已完成的操作实现预期效果且无副作用；若有不符，触发回滚。          |  2  |  V  |
| 9.9.4 | 验证形式方法（例如，模型检验、定理证明）或基于属性的测试能够证明智能体计划满足所有声明的约束条件。 |  3  |  V  |
| 9.9.5 | 验证意图不匹配或约束违规事件是否促进持续改进循环和威胁情报共享。                  |  3  |  D  |

---

## 9.10 代理推理策略安全

安全选择和执行包括ReAct、Chain-of-Thought和Tree-of-Thoughts方法在内的不同推理策略。

|   #    | 描述                                                                               | 级别  | 角色  |
| :----: | -------------------------------------------------------------------------------- | :-: | :-: |
| 9.10.1 | 验证推理策略选择使用确定性标准（输入复杂性、任务类型、安全上下文），并且在相同安全上下文中，相同输入产生相同的策略选择。                     |  1  | D/V |
| 9.10.2 | 验证每种推理策略（ReAct、Chain-of-Thought、Tree-of-Thoughts）是否具有针对其认知方法的专用输入验证、输出清理和执行时间限制。 |  1  | D/V |
| 9.10.3 | 验证推理策略转换是否记录了完整的上下文，包括输入特征、选择标准值和执行元数据，以便审计轨迹重建。                                 |  2  | D/V |
| 9.10.4 | 验证 Tree-of-Thoughts 推理是否包括分支剪枝机制，当检测到策略违规、资源限制或安全边界时终止探索。                        |  2  | D/V |
| 9.10.5 | 验证 ReAct（推理-行动-观察）循环在每个阶段包含验证检查点：推理步骤验证、行动授权以及观察净化，然后再继续。                        |  2  | D/V |
| 9.10.6 | 验证推理策略的性能指标（执行时间、资源使用、输出质量）是否被监控，并且当指标偏离配置的阈值时是否有自动警报。                           |  3  | D/V |
| 9.10.7 | 验证结合多种策略的混合推理方法是否保持所有组成策略的输入验证和输出约束，且不绕过任何安全控制。                                  |  3  | D/V |
| 9.10.8 | 验证推理策略安全测试包括使用格式错误的输入进行模糊测试、设计用于强制策略切换的对抗性提示，以及对每种认知方法进行边界条件测试。                  |  3  | D/V |

---

## 9.11 代理生命周期状态管理与安全

通过加密审计轨迹和定义的恢复程序实现安全的代理初始化、状态转换和终止。

|   #    | 描述                                                                          | 级别  | 角色  |
| :----: | --------------------------------------------------------------------------- | :-: | :-: |
| 9.11.1 | 验证代理初始化是否包括使用硬件支持的凭证建立加密身份，以及包含代理ID、时间戳、配置哈希和值初始化参数的不可变启动审计日志。              |  1  | D/V |
| 9.11.2 | 验证代理状态转换是否经过加密签名、时间戳标记，并且记录完整的上下文信息，包括触发事件、先前状态哈希、新状态哈希以及所执行的安全验证。          |  2  | D/V |
| 9.11.3 | 验证代理关闭程序是否包括使用加密擦除或多遍覆盖进行安全内存清除，凭证撤销并通知证书颁发机构，以及生成防篡改的终止证书。                 |  2  | D/V |
| 9.11.4 | 验证代理恢复机制通过使用加密校验和（至少为 SHA-256）来验证状态完整性，并在检测到损坏时回滚到已知良好状态，同时具备自动警报和人工审批要求。   |  3  | D/V |
| 9.11.5 | 验证代理持久化机制是否使用每个代理的 AES-256 密钥加密敏感状态数据，并在可配置的计划（最多 90 天）上实现安全的密钥轮换，且支持零停机部署。 |  3  | D/V |

---

## 9.12 工具集成安全框架

针对动态工具加载、执行和结果验证的安全控制，包含定义的风险评估和审批流程。

|   #    | 描述                                                                                   | 级别  | 角色  |
| :----: | ------------------------------------------------------------------------------------ | :-: | :-: |
| 9.12.1 | 验证工具描述符是否包含指定所需权限（读/写/执行）、风险级别（低/中/高）、资源限制（CPU、内存、网络）以及工具清单中记录的校验要求的安全元数据。           |  1  | D/V |
| 9.12.2 | 确认工具执行结果在与超时限制和错误处理程序集成之前，已根据预期的架构（JSON 架构、XML 架构）和安全策略（输出清理、数据分类）进行验证。              |  1  | D/V |
| 9.12.3 | 验证工具交互日志是否包含详细的安全上下文，包括权限使用情况、数据访问模式、执行时间、资源消耗和返回代码，并采用结构化日志记录以便集成安全信息和事件管理系统（SIEM）。 |  2  | D/V |
| 9.12.4 | 验证动态工具加载机制是否使用基于公钥基础设施（PKI）的数字签名进行验证，并在执行前实施具有沙箱隔离和权限验证的安全加载协议。                      |  2  | D/V |
| 9.12.5 | 验证工具安全评估是否会针对新版本自动触发，且包含强制审批关卡，包括静态分析、动态测试和安全团队审核，并具备有文档记录的审批标准和服务级别协议（SLA）要求。       |  3  | D/V |

---

### 参考文献

* [MITRE ATLAS tactics ML09](https://atlas.mitre.org/)
* [Circuit-breaker research for AI agents — Zou et al., 2024](https://arxiv.org/abs/2406.04313)
* [Trend Micro analysis of sandbox escapes in AI agents — Park, 2025](https://www.trendmicro.com/vinfo/us/security/news/cybercrime-and-digital-threats/unveiling-ai-agent-vulnerabilities-code-execution)
* [Auth0 guidance on human-in-the-loop authorization for agents — Martinez, 2025](https://auth0.com/blog/secure-human-in-the-loop-interactions-for-ai-agents/)
* [Medium deep-dive on MCP & A2A protocol hijacking — ForAISec, 2025](https://medium.com/%40foraisec/security-analysis-potential-ai-agent-hijacking-via-mcp-and-a2a-protocol-insights-cd1ec5e6045f)
* [Rapid7 fundamentals on spoofing attack prevention — 2024](https://www.rapid7.com/fundamentals/spoofing-attacks/)
* [Imperial College verification of swarm systems — Lomuscio et al.](https://sail.doc.ic.ac.uk/projects/swarms/)
* [NIST AI Risk Management Framework 1.0, 2023](https://nvlpubs.nist.gov/nistpubs/ai/nist.ai.100-1.pdf)
* [WIRED security briefing on encryption best practices, 2024](https://www.wired.com/story/encryption-apps-chinese-telecom-hacking-hydra-russia-exxon)
* [OWASP Top 10 for LLM Applications, 2025](https://owasp.org/www-project-top-10-for-large-language-model-applications/)
* [Comprehensive Vulnerability Analysis is Necessary for Trustworthy LLM-MAS](https://arxiv.org/html/2506.01245v1)
* [How Is LLM Reasoning Distracted by Irrelevant Context?
  An Analysis Using a Controlled Benchmark](https://www.arxiv.org/pdf/2505.18761)
* [Large Language Model Sentinel: LLM Agent for Adversarial Purification](https://arxiv.org/pdf/2405.20770)
* [Securing Agentic AI: A Comprehensive Threat Model and Mitigation Framework for Generative AI Agents](https://arxiv.org/html/2504.19956v2)

